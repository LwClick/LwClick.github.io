<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|consolas:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="change the world by code">
<meta property="og:type" content="website">
<meta property="og:title" content="绝对领域">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="绝对领域">
<meta property="og:description" content="change the world by code">
<meta property="article:author" content="xCoding">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>绝对领域</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">绝对领域</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">lwclick</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/%E9%9B%86%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/%E9%9B%86%E5%90%88/" itemprop="url">集合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T21:00:09+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/%E9%9B%86%E5%90%88/" class="leancloud_visitors" data-flag-title="集合">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  32
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、学习指南"><a href="#一、学习指南" class="headerlink" title="一、学习指南"></a>一、学习指南</h3><h4 id="1-为什么要用集合"><a href="#1-为什么要用集合" class="headerlink" title="1. 为什么要用集合"></a>1. 为什么要用集合</h4><p>为了⽅便操作多个对象，那么我们就得把这多个对象存储起来，想要存储多个对象(变量)，很容易就能想到⼀个容器(集合)来装载</p>
<p><strong>Java给我们提供了工具方便我们去操作多个Java对象。</strong></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200419192821.png" alt="TIM截图20200419192821"></p>
<p><strong>需要了解的数据结构</strong>：数组，链表，散列表，红黑树</p>
<h4 id="2-结论"><a href="#2-结论" class="headerlink" title="2. 结论"></a>2. 结论</h4><ul>
<li>如果是集合类型，有List和Set可供选择<ul>
<li>List：插入有序的，元素是可重复的。一般用子类ArrayList或者LinkedList</li>
<li>Set：插入无序的，元素不可重复。一般用HashSet或者TreeSet</li>
</ul>
</li>
<li>如果是Key - Value型，选择map<ul>
<li>LinkedHashMap：保持插入顺序</li>
<li>HashMap：不保持插入顺序</li>
<li>TreeMap：可以排序</li>
</ul>
</li>
</ul>
<h4 id="3-面试前一定要看回顾和阅读源码"><a href="#3-面试前一定要看回顾和阅读源码" class="headerlink" title="3. 面试前一定要看回顾和阅读源码"></a>3. 面试前一定要看回顾和阅读源码</h4><hr>
<h3 id="二、Collection"><a href="#二、Collection" class="headerlink" title="二、Collection"></a>二、Collection</h3><h4 id="1-集合（Collection）介绍"><a href="#1-集合（Collection）介绍" class="headerlink" title="1. 集合（Collection）介绍"></a>1. 集合（Collection）介绍</h4><h5 id="1-1-为什么需要Collection"><a href="#1-1-为什么需要Collection" class="headerlink" title="1.1 为什么需要Collection"></a>1.1 为什么需要Collection</h5><ul>
<li><p>Java是⼀⻔⾯向对象的语⾔，就免不了处理对象</p>
</li>
<li><p>为了⽅便操作多个对象，那么我们就得把这多个对象存储起来      <strong>容器</strong></p>
</li>
<li><p>常用的容器有：StringBuffer，数组</p>
</li>
</ul>
<h5 id="1-2-StringBuffer-和-StringBuiler类"><a href="#1-2-StringBuffer-和-StringBuiler类" class="headerlink" title="1.2 StringBuffer 和 StringBuiler类"></a>1.2 StringBuffer 和 StringBuiler类</h5><ul>
<li><p>String 类是不可改变的，所以一旦创建了 String 对象，那它的值就无法改变了</p>
</li>
<li><p>当对字符串进行修改的时候，需要使用 StringBuffer 和 StringBuilder 类。和 String 类不同的是，StringBuffer 和 StringBuilder 类的对象能够被多次的修改，并且不产生新的未使用对象。</p>
</li>
<li><p>StringBuffer ：线程安全的</p>
</li>
<li><p>StringBuilder ：有速度优势，线程不安全</p>
</li>
</ul>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200419202741.png" alt="TIM截图20200419202741" style="zoom:65%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">    StringBuffer sBuffer = <span class="keyword">new</span> StringBuffer(<span class="string">"菜鸟教程官网："</span>);</span><br><span class="line">    sBuffer.append(<span class="string">"www"</span>);</span><br><span class="line">    sBuffer.append(<span class="string">".lwclick"</span>);</span><br><span class="line">    sBuffer.append(<span class="string">".com"</span>);</span><br><span class="line">    System.out.println(sBuffer);   【www.lwclick.com】</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>面试题</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String s1 = <span class="string">"abc"</span>;                 <span class="comment">// 常量池</span></span><br><span class="line">String s2 = <span class="keyword">new</span> String(<span class="string">"abc"</span>);     <span class="comment">// 堆内存中</span></span><br><span class="line">System.out.println(s1==s2);        <span class="comment">// false两个对象的地址值不一样。</span></span><br><span class="line">System.out.println(s1.equals(s2)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>



<h5 id="1-3-数组和集合的区别"><a href="#1-3-数组和集合的区别" class="headerlink" title="1.3 数组和集合的区别"></a>1.3 数组和集合的区别</h5><ul>
<li>数组<ul>
<li>长度固定</li>
<li>存储基本数据类型，也可以存储引用类型</li>
</ul>
</li>
<li>集合<ul>
<li>长度可变</li>
<li>只能存储引用类型（存储int，会自动装箱成Integer）</li>
</ul>
</li>
</ul>
<h5 id="1-4-Collection主要学习内容"><a href="#1-4-Collection主要学习内容" class="headerlink" title="1.4 Collection主要学习内容"></a>1.4 Collection主要学习内容</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Collection</span><br><span class="line">	--List</span><br><span class="line">		---ArrayList</span><br><span class="line">		---Vector</span><br><span class="line">		---LinkedList</span><br><span class="line">	--Set</span><br><span class="line">		---HashSet</span><br><span class="line">		---TreeSet</span><br></pre></td></tr></table></figure>



<h5 id="1-5-Collection的功能"><a href="#1-5-Collection的功能" class="headerlink" title="1.5 Collection的功能"></a>1.5 Collection的功能</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">添加：</span><br><span class="line">	boolean add(Object obj)：添加一个元素</span><br><span class="line">	boolean addAll(Collection c)：添加一个集合的元素</span><br><span class="line">	</span><br><span class="line">删除：</span><br><span class="line">	void clear()：移除所有元素</span><br><span class="line">	boolean remove(Object)：移除一个元素</span><br><span class="line">	boolean removeAll(Collection c)：移除一个集合的元素，只要有一个元素被移除了，就返回true</span><br><span class="line">	</span><br><span class="line">判断：</span><br><span class="line">	boolean contains(Object o)：判断集合是否包含该元素</span><br><span class="line">	boolean containsAll(Collection c)：判断集合中是否包含指定集合元素，只有包含所有才叫包含</span><br><span class="line">	boolean isEmpty()：判断集合是否为空</span><br><span class="line">	</span><br><span class="line">获取：</span><br><span class="line">	Iterator&lt;E&gt; iterator()：迭代器</span><br><span class="line">	</span><br><span class="line">长度：</span><br><span class="line">	int size()：元素个数</span><br><span class="line">	</span><br><span class="line">交集：</span><br><span class="line">	boolean retainAll(Collection c)：移除此集合中未包含在指定集合中的所有元素</span><br><span class="line">		A和B做交集，最终结果保存在A中，返回值表示A是否发生过变化</span><br></pre></td></tr></table></figure>



<h4 id="2-迭代器（Iterator）"><a href="#2-迭代器（Iterator）" class="headerlink" title="2. 迭代器（Iterator）"></a>2. 迭代器（Iterator）</h4><p>遍历集合中的元素，具体实现是在ArrayList以内部类的方式</p>
<ul>
<li>Collection的源码中继承了Iterable，Iterable是⼀个接⼝，有iterator()这个⽅法，返回的是Iterator</li>
<li>Iterator也是⼀个接⼝，它只有三个⽅法：hasNext()，next()，remove()</li>
</ul>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200419205757.png" alt="TIM截图20200419205757"></p>
<h4 id="3-List（interface）集合介绍"><a href="#3-List（interface）集合介绍" class="headerlink" title="3. List（interface）集合介绍"></a>3. List（interface）集合介绍</h4><ul>
<li><strong>特点</strong>：有序（存储顺序和取出顺序一致），可重复，返回的是ListIterator接⼝</li>
<li>常用的子类：<ul>
<li>ArrayList：底层使用数组，线程不安全</li>
<li>LinkedList：链表，线程不安全</li>
<li>Vector：数组，线程安全</li>
</ul>
</li>
</ul>
<h4 id="4-Set集合介绍"><a href="#4-Set集合介绍" class="headerlink" title="4. Set集合介绍"></a>4. Set集合介绍</h4><ul>
<li><strong>特点</strong>：元素不可重复</li>
<li>常用子类：<ul>
<li>HashSet：哈希表（是一个元素为链表的数组）</li>
<li>TreeSet：红黑树（自平衡的二叉树），保证了元素的排序方式</li>
<li>LinkedHashSet：哈希表和链表</li>
</ul>
</li>
</ul>
<hr>
<h3 id="三、List集合"><a href="#三、List集合" class="headerlink" title="三、List集合"></a>三、List集合</h3><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420131320.png" alt="TIM截图20200420131320" style="zoom:50%;" />

<h4 id="1-ArrayList解析"><a href="#1-ArrayList解析" class="headerlink" title="1. ArrayList解析"></a>1. ArrayList解析</h4><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420131523.png" alt="TIM截图20200420131523" style="zoom:50%;" />

<h5 id="1-1-属性"><a href="#1-1-属性" class="headerlink" title="1.1 属性"></a>1.1 属性</h5><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420131745.png" alt="TIM截图20200420131745" style="zoom:80%;" />

<p><strong>ArrayList底层其实就是⼀个数组</strong></p>
<h5 id="1-2-构造方法"><a href="#1-2-构造方法" class="headerlink" title="1.2 构造方法"></a>1.2 构造方法</h5><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420131959.png" alt="TIM截图20200420131959" style="zoom:80%;" />



<h5 id="1-3-Add方法"><a href="#1-3-Add方法" class="headerlink" title="1.3 Add方法"></a>1.3 Add方法</h5><h6 id="1-3-1-add-E-e"><a href="#1-3-1-add-E-e" class="headerlink" title="1.3.1 add(E e)"></a>1.3.1 add(E e)</h6><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420132103.png" alt="TIM截图20200420132103"></p>
<p>步骤：</p>
<ul>
<li>检查是否需要扩容，确认list容量，尝试容量加1，看有无必要</li>
<li>插⼊元素</li>
</ul>
<p>查看小容量是否满足需求：</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420132559.png" alt="TIM截图20200420132559"></p>
<p>调用了<code>ensureExplicitCapacity()</code>来确定明确的容量</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420132739.png" alt="TIM截图20200420132739"></p>
<p>grow()实现扩容操作</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420132840.png" alt="TIM截图20200420132840" style="zoom:80%;" />

<p>copyOf()方法：</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420132925.png" alt="TIM截图20200420132925"></p>
<p><strong>基本实现</strong></p>
<ul>
<li>首先检查数组的容量是否足够<ul>
<li>足够：直接添加</li>
<li>不够：扩容<ul>
<li>扩容到原来的1.5倍</li>
<li>第⼀次扩容后，如果容量还是⼩于minCapacity，就将容量扩充为minCapacity。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h6 id="1-3-2-add-int-index-E-element"><a href="#1-3-2-add-int-index-E-element" class="headerlink" title="1.3.2 add(int index, E element)"></a>1.3.2 add(int index, E element)</h6><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420132129.png" alt="TIM截图20200420132129"></p>
<p>步骤：</p>
<ul>
<li>检查角标</li>
<li>空间检查，如果有需要进行扩容</li>
<li>插入元素</li>
</ul>
<p>与扩容相关ArrayList的add⽅法底层其实都是arraycopy() 来实现的，该⽅法是由C/C++来编写的</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420133454.png" alt="TIM截图20200420133454"></p>
<h5 id="1-4-get方法"><a href="#1-4-get方法" class="headerlink" title="1.4 get方法"></a>1.4 get方法</h5><img src="https://gitee.com/lwclick/blogImg/raw/master/img/20200420133610.png" alt="20200420133610" style="zoom:80%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查⻆标</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rangeCheck</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= size)</span><br><span class="line">    	<span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回元素</span></span><br><span class="line"><span class="function">E <span class="title">elementData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (E) elementData[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-5-set方法"><a href="#1-5-set方法" class="headerlink" title="1.5 set方法"></a>1.5 set方法</h5><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/20200420133800.png" alt="20200420133800"></p>
<p>检查角标，        替代元素，         返回旧值</p>
<h5 id="1-6-remove方法"><a href="#1-6-remove方法" class="headerlink" title="1.6 remove方法"></a>1.6 remove方法</h5><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420134350.png" alt="TIM截图20200420134350" style="zoom:80%;" />

<p>检查⻆标，        删除元素，      计算出需要移动的个数，并移动，      设置为null，让Gc回收</p>
<h5 id="1-7-细节说明"><a href="#1-7-细节说明" class="headerlink" title="1.7 细节说明"></a>1.7 细节说明</h5><ul>
<li>ArrayList是基于动态数组实现的，在增删时候，需要数组的拷⻉复制。</li>
<li>ArrayList的<strong>默认初始化容量是10</strong>，每次扩容时候增加原先容量的⼀半，也就是变为原来的1.5倍</li>
<li>删除元素时不会减少容量，若希望减少容量则调⽤trimToSize()</li>
<li>它不是线程安全的。它能存放null值。</li>
</ul>
<h4 id="2-Vector与ArrayList的区别"><a href="#2-Vector与ArrayList的区别" class="headerlink" title="2. Vector与ArrayList的区别"></a>2. Vector与ArrayList的区别</h4><ul>
<li><p>vector是JDK1.2的类</p>
</li>
<li><p>Vector底层也是数组，与ArrayList最⼤的区别就是：<strong>同步(线程安全)</strong></p>
</li>
<li><p>在要求⾮同步的情况下，我们⼀般都是使⽤ArrayList来替代Vector</p>
</li>
<li><p>如果想要ArrayList实现同步，可以使⽤Collections的⽅法： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List list &#x3D; Collections.synchronizedList(new ArrayList(...))；</span><br></pre></td></tr></table></figure>
</li>
<li><p>Vector底层数组不够⽤时，是扩展1倍</p>
</li>
</ul>
<h4 id="3-LinkedList解析"><a href="#3-LinkedList解析" class="headerlink" title="3. LinkedList解析"></a>3. LinkedList解析</h4><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420135319.png" alt="TIM截图20200420135319" style="zoom:60%;" />

<h5 id="3-1-属性"><a href="#3-1-属性" class="headerlink" title="3.1 属性"></a>3.1 属性</h5><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420135807.png" alt="TIM截图20200420135807"></p>
<p>底层是<strong>双向链表</strong>，LinkedList还实现了Deque接⼝，因此，我们可以操作LinkedList像操作队列和栈⼀样</p>
<p>有了头结点，其他的数据我们都可以获取得到了。</p>
<ul>
<li>transient int size = 0；</li>
<li>transient Node<E> first；</li>
<li>transient Node<E> last；</li>
</ul>
<h5 id="3-2-构造方法"><a href="#3-2-构造方法" class="headerlink" title="3.2 构造方法"></a>3.2 构造方法</h5><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420140300.png" alt="TIM截图20200420140300"></p>
<p>还有一个无参空构造方法</p>
<h5 id="3-3-add方法（往链表最后添加元素）"><a href="#3-3-add方法（往链表最后添加元素）" class="headerlink" title="3.3 add方法（往链表最后添加元素）"></a>3.3 add方法（往链表最后添加元素）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    linkLast(e);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">linkLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; l = last;</span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(l, e, <span class="keyword">null</span>);</span><br><span class="line">    last = newNode;</span><br><span class="line">    <span class="keyword">if</span> (l == <span class="keyword">null</span>)</span><br><span class="line">    	first = newNode;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    	l.next = newNode;</span><br><span class="line">    size++;</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-4-remove方法"><a href="#3-4-remove方法" class="headerlink" title="3.4 remove方法"></a>3.4 remove方法</h5><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420140825.png" alt="TIM截图20200420140825" style="zoom:80%;" />

<p>unlink方法</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420140914.png" alt="TIM截图20200420140914" style="zoom:80%;" />

<p>相当于：</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420140950.png" alt="TIM截图20200420140950"></p>
<h5 id="3-5-get方法"><a href="#3-5-get方法" class="headerlink" title="3.5 get方法"></a>3.5 get方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    <span class="keyword">return</span> node(index).item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420141117.png" alt="TIM截图20200420141117" style="zoom:80%;" />



<h5 id="3-6-set方法"><a href="#3-6-set方法" class="headerlink" title="3.6 set方法"></a>3.6 set方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    checkElementIndex(index);</span><br><span class="line">    Node&lt;E&gt; x = node(index);</span><br><span class="line">    E oldVal = x.item;</span><br><span class="line">    x.item = element;</span><br><span class="line">    <span class="keyword">return</span> oldVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-List集合总结"><a href="#4-List集合总结" class="headerlink" title="4. List集合总结"></a>4. List集合总结</h4><ul>
<li>ArrayList:<ul>
<li>底层实现是数组</li>
<li>ArrayList的默认初始化容量是10，每次扩容时候增加原先容量的⼀半，也就是变为原来的1.5倍</li>
<li>在增删时候，需要数组的拷⻉复制(navite ⽅法由C/C++实现)</li>
</ul>
</li>
<li>LinkedList:<ul>
<li>底层实现是双向链表（双向链表⽅便实现往前遍历）</li>
</ul>
</li>
<li>Vector:<ul>
<li>底层是数组，现在已少⽤，被ArrayList替代<ul>
<li>Vector所有⽅法都是同步，<strong>有性能损失</strong></li>
<li>Vector初始length是10 超过length时 以double倍增⻓，<strong>相比于ArrayList更多消耗内存</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>查询多用ArrayList，增删多用LinkedList</strong></p>
<hr>
<h3 id="四、Map集合"><a href="#四、Map集合" class="headerlink" title="四、Map集合"></a>四、Map集合</h3><p>只要有key，就能找到与之对应的value</p>
<h4 id="1-Map和Collection的区别"><a href="#1-Map和Collection的区别" class="headerlink" title="1. Map和Collection的区别"></a>1. Map和Collection的区别</h4><ul>
<li><p>Map集合的特点：</p>
<ul>
<li>将键映射到值的对象，一个键只能映射到一个值</li>
</ul>
</li>
<li><p>Map和Collection集合的区别：</p>
<ul>
<li>Map存储元素是成对出现的，key是唯一的，value可以重复</li>
<li>Collection存储元素是单独出现的，Set是唯一的，List是可重复的</li>
</ul>
</li>
<li><p>要点：</p>
<ul>
<li>Map集合的数据结构针对键有效，跟值无关</li>
<li>Collection集合的数据结构针对元素有效</li>
</ul>
</li>
</ul>
<h4 id="2-Map的功能"><a href="#2-Map的功能" class="headerlink" title="2. Map的功能"></a>2. Map的功能</h4><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420143050.png" alt="TIM截图20200420143050" style="zoom:80%;" />

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">添加：</span><br><span class="line">	V put(K key, V value):添加元素</span><br><span class="line">		如果键是第一次存储，就直接存储value，返回null</span><br><span class="line">		否则的话，用新的value替换掉原来的value，返回以前的值</span><br><span class="line">		</span><br><span class="line">删除：</span><br><span class="line">	void clear():移除所有的键值对元素</span><br><span class="line">	V remove(Object key):根据key删除value，并把value返回</span><br><span class="line">	</span><br><span class="line">判断：</span><br><span class="line">	boolean containsKey(Object key):判断集合是否包含指定的键</span><br><span class="line">	boolean containsValue(Object value):判断集合是否包含指定的值</span><br><span class="line">	boolean isEmpty():判断集合是否为空</span><br><span class="line">	</span><br><span class="line">获取：</span><br><span class="line">	【Set&lt;Map.Entry&lt;K key, V value&gt; entrySet&gt;&gt; entrySet():返回的是键值对对象的集合】</span><br><span class="line">	V get(Object key):根据键获得值</span><br><span class="line">	Set&lt;K&gt; keySet():获取集合中所有的键的集合</span><br><span class="line">	Collection&lt;V&gt; values():获取集合中所有的值得集合</span><br><span class="line">	</span><br><span class="line">长度：</span><br><span class="line">	int size():返回集合中键值对的对数</span><br></pre></td></tr></table></figure>



<h4 id="3-散列表介绍"><a href="#3-散列表介绍" class="headerlink" title="3. 散列表介绍"></a>3. 散列表介绍</h4><ul>
<li><p>数组和链表：存储的顺序和取出的顺序是⼀致的，想要获取某个元素，就要访问所有的元素，直到找到为⽌</p>
</li>
<li><p>散列表（哈希表）：不在意元素的顺序，能够快速的查找元素的数据，<strong>通过数组+链表实现</strong></p>
</li>
</ul>
<h5 id="3-1-工作原理"><a href="#3-1-工作原理" class="headerlink" title="3.1 工作原理"></a>3.1 工作原理</h5><p>散列表为每个对象计算出⼀个整数，称为<strong>散列码</strong>。根据这些计算出来的散列码<strong>保存在对应的位置上</strong>！</p>
<p>散列表⽤的是链表数组实现的，每个列表称之为桶</p>
<p><strong>⼀个桶</strong>上可能会遇到<strong>被占用的情况</strong>(hashCode散列码相同，就存储在同⼀个位置上)  ==&gt; 散列冲突</p>
<h5 id="3-2-散列冲突"><a href="#3-2-散列冲突" class="headerlink" title="3.2 散列冲突"></a>3.2 散列冲突</h5><p>⼀个桶上可能会遇到被占⽤的情况，此时需要⽤该对象与桶上的对象进⾏⽐较，看看该对象是否存在桶⼦上了~如果存在，就不添加了，如果不存在则添加到桶⼦上</p>
<p><strong>在JDK1.8中，桶满时会从链表变成平衡⼆叉树</strong></p>
<p>如果散列表太满，是需要对散列表再散列，创建⼀个桶数更多的散列表，并将原有的元素插⼊到新表中，丢弃原来的表</p>
<ul>
<li>装填因⼦(load factor)决定了何时对散列表再散列</li>
<li>装填因⼦默认为0.75，如果表中超过了75%的位置已经填⼊了元素，那么这个表就会⽤双倍的桶数⾃动进⾏再散列</li>
</ul>
<h4 id="4-红黑树介绍"><a href="#4-红黑树介绍" class="headerlink" title="4. 红黑树介绍"></a>4. 红黑树介绍</h4><p>散列表中已经提过了：如果桶数满的时候，JDK8是将链表转成红⿊树的。并且，我们的TreeSet、TreeMap底层都是红⿊树来实现的。</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420145933.png" alt="TIM截图20200420145933"></p>
<h5 id="4-1-平衡树"><a href="#4-1-平衡树" class="headerlink" title="4.1 平衡树"></a>4.1 平衡树</h5><p>红⿊树就是⼀种平衡树，它可以保证⼆叉树基本符合<strong>矮矮胖胖(均衡)</strong>的结构</p>
<h5 id="4-2-2-3树"><a href="#4-2-2-3树" class="headerlink" title="4.2 2-3树"></a>4.2 2-3树</h5><ol>
<li><p>2-3树的意思就是说，一个父节点可以有两个子节点，也可以有三个子节点，并且其也满足类似<code>二叉搜索树</code>的定义（父节点的值大于左子树，但小于右子树），所有叶子节点都在同一层。</p>
</li>
<li><p>2节点：父节点存储一个值，最多有左右两个子树。</p>
</li>
<li><p>3节点：父节点存储两个值，最多有左中右三个子树</p>
</li>
</ol>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/2-3.png" alt="2-3" style="zoom:80%;" />

<p><strong>⼆叉查找树</strong>上，我们插⼊节点的过程是这样的：⼩于节点值往右继续与左⼦节点⽐，⼤于则继续与右⼦节点⽐，直到某节点左或右⼦节点为空，把值插⼊进去。这样<strong>⽆法避免偏向问题</strong></p>
<p><strong>2-3树</strong>：它插⼊的时候可以保持树的平衡！</p>
<ul>
<li>合并2-节点为3-节点，扩充将3-节点扩充为⼀个4-节点</li>
<li>分解4-节点为3-节点，节点3-节点为2-节点</li>
<li>⾄使得树平衡~</li>
</ul>
<h5 id="4-3-从2-3树到红黑树"><a href="#4-3-从2-3树到红黑树" class="headerlink" title="4.3 从2-3树到红黑树"></a>4.3 从2-3树到红黑树</h5><p>红黑树是对2-3查找树的改进，它能用一种<strong>统一的方式完成所有变换</strong>。</p>
<p>红黑树是一种<strong>平衡二叉树</strong>，因此它没有3-节点</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/11.png" alt="11" style="zoom:33%;" />

<p>红黑树也是平衡树的一种，在插入元素的时候它也得保持树的平衡，那红黑树是以什么的方式来保持树的平衡呢？</p>
<ul>
<li><p><strong>旋转</strong>：顺时针旋转和逆时针旋转</p>
</li>
<li><p><strong>反色</strong>：交换红黑的颜色</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">遵守这些约束的才能叫做红黑树：</span><br><span class="line">	1. 红黑树是二叉搜索树。</span><br><span class="line">    2. 根节点是黑色。</span><br><span class="line">    3. 【每个叶子节点都是黑色的空节点（NIL节点）】。</span><br><span class="line">    4. 【每个红色节点的两个子节点都是黑色】(从每个叶子到根的所有路径上不能有两个连续的红色节点)</span><br><span class="line">    5. 从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点(每一条树链上的黑色节点数量（称之为“黑高”）必须相等)。</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="五、HashMap"><a href="#五、HashMap" class="headerlink" title="五、HashMap"></a>五、HashMap</h3><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420152749.png" alt="TIM截图20200420152749" style="zoom:80%;" />

<ul>
<li>允许为null，     不保证有序 </li>
<li>底层由<strong>散列表实现</strong></li>
<li><strong>1.8之前：数组+链表，1.8之后：链表长度大于阀值（默认8），将链表转化为红黑树，减少搜索时间</strong></li>
<li>除了允许为null和同步以外，跟hashTable没区别</li>
<li>初始容量太高和装载因子太低对遍历都不好</li>
<li>当初始容量 * 装载因子小于哈希表的容量时，哈希表会再进行散列，桶数*2</li>
<li>装载因子默认是0.75，设置高虽然会减少空间，但遍历时，开销会增大</li>
<li>如果知道有足够多的数据存到hashmap中，最好设置初始容量</li>
</ul>
<h4 id="1-属性"><a href="#1-属性" class="headerlink" title="1. 属性"></a>1. 属性</h4><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420153433.png" alt="TIM截图20200420153433" style="zoom:80%;" />



<h4 id="2-构造方法"><a href="#2-构造方法" class="headerlink" title="2. 构造方法"></a>2. 构造方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420153936.png" alt="TIM截图20200420153936"></p>
<p>调用了<code>tableSizeFor()</code></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420154020.png" alt="TIM截图20200420154020"></p>
<p>threshold这个成员变量是阈值，决定了是否要将散列表再散列。它的值应该是：<code>capacity * load factor</code>才对的，这里仅仅是一个初始化，当创建哈希表的时候，它会重新赋值的</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420154211.png" alt="TIM截图20200420154211"></p>
<h4 id="3-put方法（重点）"><a href="#3-put方法（重点）" class="headerlink" title="3. put方法（重点）"></a>3. put方法（重点）</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420154340.png" alt="TIM截图20200420154340"></p>
<p>计算哈希值</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420154412.png" alt="TIM截图20200420154412"></p>
<p>做异或运算</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420154444.png" alt="TIM截图20200420154444"></p>
<p>我们是根据key的哈希值来保存在散列表中的，表默认的初始容量是16，要放到散列表中，就是0-15的位置上。</p>
<p>也就是<code>tab[i = (n - 1) &amp; hash]</code>。可以发现的是：在做<code>&amp;</code>运算的时候，仅仅是<strong>后4位有效</strong></p>
<p>那如果我们key的哈希值高位变化很大，低位变化很小。直接拿过去做<code>&amp;</code>运算，这就会导致计算出来的Hash值相同的很多。</p>
<p><strong>将key的哈希值的高位也做了运算(与高16位做异或运算，使得在做&amp;运算时，此时的低位实际上是高位与低位的结合)，这就增加了随机性</strong>，减少了碰撞冲突的可能性！</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420155433.png" alt="TIM截图20200420155433" style="zoom:80%;" />

<p>在初始化的时候要调用这个方法，当散列表元素大于<code>capacity * load factor</code>的时候也是调用<code>resize()</code></p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420155615.png" alt="TIM截图20200420155615" style="zoom:80%;" />



<h4 id="4-get方法"><a href="#4-get方法" class="headerlink" title="4. get方法"></a>4. get方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420160231.png" alt="TIM截图20200420160231"></p>
<p>getNode方法<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420160308.png" alt="TIM截图20200420160308"></p>
<h4 id="5-remove方法"><a href="#5-remove方法" class="headerlink" title="5. remove方法"></a>5. remove方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420160410.png" alt="TIM截图20200420160410"></p>
<p>removeNode</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420160430.png" alt="TIM截图20200420160430"></p>
<h4 id="6-HashMap与Hashtable对比"><a href="#6-HashMap与Hashtable对比" class="headerlink" title="6. HashMap与Hashtable对比"></a>6. HashMap与Hashtable对比</h4><ul>
<li>从存储结构和实现来讲基本上都是相同的。</li>
<li><strong>Hashtable是线程安全的</strong>，另外它<strong>不允许key和value为null</strong>。</li>
<li>Hashtable是个过时的集合类，不建议在新代码中使⽤，不需要线程安全的场合可以⽤HashMap替换，需要<strong>线程安全</strong>的场合可以<strong>⽤ConcurrentHashMap替换</strong></li>
</ul>
<h4 id="7-HashMap总结"><a href="#7-HashMap总结" class="headerlink" title="7. HashMap总结"></a>7. HashMap总结</h4><ul>
<li><p>在JDK8中<strong>HashMap的底层</strong>是：数组+链表(散列表)+红⿊树</p>
</li>
<li><p>当<strong>装载因子*初始容量 &lt; 散列表元素</strong>时，该散列表会再散列，扩容2倍</p>
</li>
<li><p><strong>装载因⼦的默认值是0.75</strong></p>
<ul>
<li>装载因⼦初始值⼤了，可以减少散列表再散列(扩容的次数)，但同时会导致散列冲突的可能性变⼤</li>
<li>装载因⼦初始值⼩了，可以减⼩散列冲突的可能性，但同时扩容的次数可能就会变多</li>
</ul>
</li>
<li><p><strong>初始容量的默认值是16</strong></p>
<ul>
<li>初始容量过⼤，那么遍历时我们的速度就会受影响</li>
<li>初始容量过小，散列表再散列(扩容的次数)可能就变得多</li>
</ul>
</li>
<li><p><strong>HashMap并不是直接拿key的哈希值来用的，它会将key的哈希值的高16位进行异或操作，使得我们将元素放入哈希表的时候增加了一定的随机性</strong></p>
</li>
<li><p><strong><em>并不是桶⼦上有8位元素的时候它就能变成红⿊树，它得同时满⾜我们的散列表容量大于64才⾏（MIN_TREEIFY_CAPACITY）</em></strong></p>
</li>
</ul>
<hr>
<h3 id="六、LinkedHashMap"><a href="#六、LinkedHashMap" class="headerlink" title="六、LinkedHashMap"></a>六、LinkedHashMap</h3><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420161844.png" alt="TIM截图20200420161844" style="zoom:80%;" />

<ul>
<li>迭代有序，底层是<strong>散列表和双向链表</strong>，继承自hashmap</li>
<li>一个key被重新插入，顺序不受影响</li>
<li>插入位置有序</li>
<li>允许为null， 非同步</li>
</ul>
<h4 id="1-LinkedHashMap重写的方法"><a href="#1-LinkedHashMap重写的方法" class="headerlink" title="1. LinkedHashMap重写的方法"></a>1. LinkedHashMap重写的方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420162325.png" alt="TIM截图20200420162325"></p>
<p>在构建新节点时，构建的是<code>LinkedHashMap.Entry</code> 不再是<code>Node</code>.</p>
<h5 id="1-1-Map-Entry"><a href="#1-1-Map-Entry" class="headerlink" title="1.1 Map.Entry"></a>1.1 Map.Entry</h5><ul>
<li><p><strong>Map.Entry的定义。</strong></p>
<ul>
<li>Map的entrySet()方法返回一个实现Map.Entry接口的对象集合。集合中每个对象都是底层Map中一个特定的键/值对。通过这个集合的迭代器，获得每一个条目(唯一获取方式)的键或值并对值进行更改。</li>
</ul>
</li>
<li><p>Map.Entry是为了更方便的输出map键值对。可以一次性获得key和value</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">"1"</span>, <span class="string">"v1"</span>);</span><br><span class="line">map.put(<span class="string">"2"</span>, <span class="string">"v2"</span>);</span><br><span class="line">map.put(<span class="string">"3"</span>, <span class="string">"v3"</span>);</span><br><span class="line"></span><br><span class="line">【第一种】</span><br><span class="line"><span class="keyword">for</span>(String key : map.keySet())&#123;</span><br><span class="line">    sout(<span class="string">"key:"</span> + key + <span class="string">"value:"</span> + map.get(key));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">【第二种】</span><br><span class="line">Iterator&lt;map.Entry&lt;String, String&gt;&gt; it = map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">    Map.Entry&lt;String, String&gt; entry = it.next();</span><br><span class="line">    sout(<span class="string">"key:"</span> + entry.getKey() + <span class="string">"value:"</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-构造方法-1"><a href="#2-构造方法-1" class="headerlink" title="2. 构造方法"></a>2. 构造方法</h4><p><strong>LinkedHashMap默认使用的是插入顺序</strong></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420164037.png" alt="TIM截图20200420164037"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420164105.png" alt="TIM截图20200420164105"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420164116.png" alt="TIM截图20200420164116"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420164127.png" alt="TIM截图20200420164127"></p>
<h4 id="3-put方法"><a href="#3-put方法" class="headerlink" title="3. put方法"></a>3. put方法</h4><p>LinkedHashMap的put方法和HashMap是一样的。</p>
<p><strong>在创建节点的时候，调用的是LinkedHashMap重写的方法</strong></p>
<h4 id="4-get方法-1"><a href="#4-get方法-1" class="headerlink" title="4. get方法"></a>4. get方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420164344.png" alt="TIM截图20200420164344"></p>
<p><strong>最常用的将其放在链表的最后，不常用的放在链表的最前</strong></p>
<h4 id="5-remove方法-1"><a href="#5-remove方法-1" class="headerlink" title="5. remove方法"></a>5. remove方法</h4><p>对于remove方法，在LinkedHashMap中调用的还是父类的HashMap的<code>remove()</code>方法</p>
<p>在LinkedHashMap中重写的是：<code>afterNodeRemoval(Node e)</code>这个方法</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420164855.png" alt="TIM截图20200420164855"></p>
<h4 id="6-遍历的方法"><a href="#6-遍历的方法" class="headerlink" title="6. 遍历的方法"></a>6. 遍历的方法</h4><p><code>Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()</code>是被重写的了</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420165053.png" alt="TIM截图20200420165053"></p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/image-20200420165140095.png" alt="image-20200420165140095" style="zoom:80%;" />

<p><strong>初始容量对遍历没有影响</strong>，因为它遍历的是<strong>LinkedHashMap内部维护的一个双向链表</strong>，而不是散列表</p>
<h4 id="7-LinkedHashMap总结"><a href="#7-LinkedHashMap总结" class="headerlink" title="7. LinkedHashMap总结"></a>7. LinkedHashMap总结</h4><ul>
<li><strong>LinkedHashMap比HashMap多了一个双向链表的维护</strong>，在数据结构而言它要复杂一些</li>
<li>LinkedHashMap并没有重写put方法，而put方法内部的<code>newNode()</code>方法重写了。LinkedHashMap调用父类的put方法，里面回调的是重写后的<code>newNode()</code>，从而达到目的</li>
<li>LinkedHashMap可以设置两种遍历顺序<ul>
<li>访问顺序（access-ordered）（ LRU(最近最少使用)算法的实现 ）</li>
<li>插入顺序（insertion-ordered）（默认）</li>
</ul>
</li>
</ul>
<hr>
<h3 id="七、TreeMap"><a href="#七、TreeMap" class="headerlink" title="七、TreeMap"></a>七、TreeMap</h3><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420170237.png" alt="TIM截图20200420170237" style="zoom:80%;" />

<ul>
<li><strong>TreeMap是有序的</strong>：TreeMap实现了NavigableMap接口，而NavigableMap接口继承着SortedMap接口</li>
<li><strong>TreeMap底层是红黑树</strong>，它方法的时间复杂度都不会太高:log(n)</li>
<li>非同步</li>
<li>使用Comparator或者Comparable来比较key是否相等与排序的问题</li>
</ul>
<h4 id="1-属性-1"><a href="#1-属性-1" class="headerlink" title="1. 属性"></a>1. 属性</h4><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200420170438.png" alt="TIM截图20200420170438" style="zoom:80%;" />



<h4 id="2-构造方法-2"><a href="#2-构造方法-2" class="headerlink" title="2. 构造方法"></a>2. 构造方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420170526.png" alt="TIM截图20200420170526"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420170537.png" alt="TIM截图20200420170537"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420170544.png" alt="TIM截图20200420170544"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420170552.png" alt="TIM截图20200420170552"></p>
<p>TreeMap有序是通过Comparator来进行比较的，<strong>如果comparator为null，那么就使用自然顺序</strong>~</p>
<h4 id="3-put方法-1"><a href="#3-put方法-1" class="headerlink" title="3. put方法"></a>3. put方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420170739.png" alt="TIM截图20200420170739"></p>
<p>下面是<code>compare(Object k1, Object k2)</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Compares two keys using the correct comparison method for this TreeMap.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Object k1, Object k2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> comparator==<span class="keyword">null</span> ? ((Comparable&lt;? <span class="keyword">super</span> K&gt;)k1).compareTo((K)k2)</span><br><span class="line">            : comparator.compare((K)k1, (K)k2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-get方法-2"><a href="#4-get方法-2" class="headerlink" title="4. get方法"></a>4. get方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420170843.png" alt="TIM截图20200420170843"></p>
<p>如果Comparator不为null，接下来我们进去看看<code>getEntryUsingComparator(Object key)</code>，是怎么实现的</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420170909.png" alt="TIM截图20200420170909"></p>
<h4 id="5-remove方法-2"><a href="#5-remove方法-2" class="headerlink" title="5. remove方法"></a>5. remove方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420171028.png" alt="TIM截图20200420171028"></p>
<h4 id="6-遍历"><a href="#6-遍历" class="headerlink" title="6. 遍历"></a>6. 遍历</h4><p><strong>TreeMap遍历是使用EntryIterator这个内部类的</strong></p>
<h4 id="7-TreeMap总结"><a href="#7-TreeMap总结" class="headerlink" title="7. TreeMap总结"></a>7. TreeMap总结</h4><ul>
<li><strong>TreeMap底层是红黑树，能够实现该Map集合有序</strong>，时间复杂度可以保证为log(n)</li>
<li><strong>TreeMap非同步的</strong>，想要同步可以使用Collections来进行封装</li>
</ul>
<p>如果在构造方法中传递了Comparator对象，那么就会以Comparator对象的方法进行比较。否则，则使用Comparable的<code>compareTo(T o)</code>方法来比较</p>
<p>如果使用的是<code>compareTo(T o)</code>方法来比较，<strong>key一定是不能为null</strong>，并且得实现了Comparable接口的</p>
<hr>
<h3 id="八、ConcurrentHashMap"><a href="#八、ConcurrentHashMap" class="headerlink" title="八、ConcurrentHashMap"></a>八、ConcurrentHashMap</h3><h4 id="1-总结"><a href="#1-总结" class="headerlink" title="1.总结"></a>1.总结</h4><ul>
<li><strong>JDK1.8底层结构是   散列表(数组+链表)+红黑树</strong></li>
<li><strong>JDK1.7的底层是：segments+HashEntry数组</strong></li>
<li>而ConcurrentHashMap作为一个高并发的容器，它是通过<strong>部分锁定+CAS算法来进行实现线程安全的</strong>。CAS算法也可以认为是<strong>乐观锁</strong>的一种，hashtable是每个方法都加锁</li>
<li>ConCurrentHashMap支持<strong>高并发</strong>的访问和更新，它是<strong>线程安全</strong>的</li>
<li>在高并发环境下，统计数据(计算size…等等)其实是无意义的，因为在下一时刻size值就变化了</li>
<li><strong>get方法是非阻塞</strong>，无锁的。重写Node类，通过volatile修饰next来实现每次获取都是<strong>最新</strong>设置的值</li>
<li><strong>ConcurrentHashMap的key和Value都不能为null</strong></li>
</ul>
<h4 id="2-CAS算法"><a href="#2-CAS算法" class="headerlink" title="2. CAS算法"></a>2. CAS算法</h4><p>CAS（比较与交换，Compare and swap） 是一种有名的<strong>无锁算法</strong></p>
<p>有<strong>3个</strong>操作数</p>
<ul>
<li><strong>内存值V</strong></li>
<li><strong>旧的预期值A</strong></li>
<li><strong>要修改的新值B</strong></li>
</ul>
<p><strong>当且仅当预期值A和内存值V相同时，将内存值V修改为B，否则什么都不做</strong></p>
<ul>
<li>当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值(<strong>A和内存值V相同时，将内存值V修改为B)</strong>，而其它线程都失败，失败的线程<strong>并不会被挂起</strong>，而是被告知这次竞争中失败，并可以再次尝试<strong>(否则什么都不做)</strong></li>
</ul>
<h4 id="3-volatile关键字"><a href="#3-volatile关键字" class="headerlink" title="3. volatile关键字"></a>3. volatile关键字</h4><p><strong>volatile仅仅用来保证该变量对所有线程的可见性，但不保证原子性</strong></p>
<ul>
<li>保证<strong>该变量对所有线程的可见性</strong><ul>
<li>在多线程的环境下：当这个变量修改时，<strong>所有的线程都会知道该变量被修改了</strong>，也就是所谓的“可见性”</li>
</ul>
</li>
<li>不保证原子性<ul>
<li>修改变量(赋值)<strong>实质上</strong>是在JVM中<strong>分了好几步</strong>，而<strong>在这几步内(从装载变量到修改)，它是不安全的</strong>。</li>
</ul>
</li>
</ul>
<h4 id="4-域对象"><a href="#4-域对象" class="headerlink" title="4. 域对象"></a>4. 域对象</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421205155.png" alt="TIM截图20200421205155"></p>
<h4 id="5-构造方法"><a href="#5-构造方法" class="headerlink" title="5. 构造方法"></a>5. 构造方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421205406.png" alt="TIM截图20200421205406"></p>
<h4 id="6-put方法"><a href="#6-put方法" class="headerlink" title="6. put方法"></a>6. put方法</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421205509.png" alt="TIM截图20200421205509"></p>
<p>初始化散列表的时候干了什么事：<code>initTable()</code></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421205549.png" alt="TIM截图20200421205549"></p>
<h4 id="7-get方法"><a href="#7-get方法" class="headerlink" title="7. get方法"></a>7. get方法</h4><p>Node节点是重写的，设置了volatile关键字修饰，致使它每次获取的都是<strong>最新</strong>设置的值</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421205636.png" alt="TIM截图20200421205636"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421205704.png" alt="TIM截图20200421205704"></p>
<hr>
<h3 id="九、Set"><a href="#九、Set" class="headerlink" title="九、Set"></a>九、Set</h3><h4 id="1-HashSet"><a href="#1-HashSet" class="headerlink" title="1. HashSet"></a>1. HashSet</h4><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200421205928.png" alt="TIM截图20200421205928" style="zoom:80%;" />

<p><strong>要点：</strong></p>
<ul>
<li>实现Set接口</li>
<li>不保证迭代顺序</li>
<li>允许元素为null</li>
<li><strong>底层实际上是一个HashMap实例</strong></li>
<li>非同步</li>
<li>初始容量非常影响迭代性能</li>
</ul>
<p>顶部注释说底层实际上是一个HashMap实例：</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421210057.png" alt="TIM截图20200421210057"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421210123.png" alt="TIM截图20200421210123"></p>
<h4 id="2-TreeSet"><a href="#2-TreeSet" class="headerlink" title="2. TreeSet"></a>2. TreeSet</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421210242.png" alt="TIM截图20200421210242"></p>
<p><strong>要点：</strong></p>
<ul>
<li>实现NavigableSet接口</li>
<li>可以实现排序功能</li>
<li><strong>底层实际上是一个TreeMap实例</strong></li>
<li>非同步</li>
</ul>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421210326.png" alt="TIM截图20200421210326"></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421210345.png" alt="TIM截图20200421210345"></p>
<h4 id="3-LinkedHashSet"><a href="#3-LinkedHashSet" class="headerlink" title="3. LinkedHashSet"></a>3. LinkedHashSet</h4><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200421210500.png" alt="TIM截图20200421210500" style="zoom:80%;" />

<p><strong>要点：</strong></p>
<ul>
<li>迭代是有序的</li>
<li>允许为null</li>
<li><strong>底层实际上是一个HashMap+双向链表实例(其实就是LinkedHashMap)…</strong></li>
<li>非同步</li>
<li>性能比HashSet差一丢丢，因为要维护一个双向链表</li>
<li>初始容量与迭代无关，LinkedHashSet迭代的是双向链表</li>
</ul>
<h4 id="4-Set集合总结"><a href="#4-Set集合总结" class="headerlink" title="4. Set集合总结"></a>4. Set集合总结</h4><p><strong>Set集合的底层就是Map</strong></p>
<ul>
<li>HashSet：<ul>
<li>无序，允许为null，底层是HashMap（散列表+红黑树），非线程同步</li>
</ul>
</li>
<li>TreeSet：<ul>
<li>有序，不允许为null，底层是TreeMap（红黑树），非线程同步</li>
</ul>
</li>
<li>LinkedHashSet：<ul>
<li>迭代有序，允许为null，底层是HashMap+双向链表，非线程同步</li>
</ul>
</li>
</ul>
<hr>
<h3 id="十、CopyOnWriteArrayList"><a href="#十、CopyOnWriteArrayList" class="headerlink" title="十、CopyOnWriteArrayList"></a>十、CopyOnWriteArrayList</h3><h4 id="1-Vector和SynchronizedList"><a href="#1-Vector和SynchronizedList" class="headerlink" title="1. Vector和SynchronizedList"></a>1. Vector和SynchronizedList</h4><h5 id="1-1-线程安全的Vector和SynchronizedList"><a href="#1-1-线程安全的Vector和SynchronizedList" class="headerlink" title="1.1 线程安全的Vector和SynchronizedList"></a>1.1 线程安全的Vector和SynchronizedList</h5><p>如果使用 <code>Collections.synchronizedList(new ArrayList())</code> 来<strong>使ArrayList变成是线程安全</strong>的话，也是几乎都是每个方法都加上synchronized关键字的，只不过<strong>它不是加在方法的声明处，而是方法的内部</strong>。</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421211449.png" alt="TIM截图20200421211449"></p>
<h4 id="2-CopyOnWriteArrayList介绍"><a href="#2-CopyOnWriteArrayList介绍" class="headerlink" title="2. CopyOnWriteArrayList介绍"></a>2. CopyOnWriteArrayList介绍</h4><p>CopyOnWriteArrayList是<strong>同步List</strong>的替代品，CopyOnWriteArraySet是<strong>同步Set</strong>的替代品。</p>
<p>CopyOnWriteArraySet的原理就是CopyOnWriteArrayList。</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421212935.png" alt="TIM截图20200421212935"></p>
<h4 id="3-CopyOnWriteArrayList源码注释"><a href="#3-CopyOnWriteArrayList源码注释" class="headerlink" title="3. CopyOnWriteArrayList源码注释"></a>3. CopyOnWriteArrayList源码注释</h4><ul>
<li>CopyOnWriteArrayList是线程安全容器(相对于ArrayList)，底层通过<strong>复制数组</strong>的方式来实现。</li>
<li>CopyOnWriteArrayList在遍历的使用不会抛出ConcurrentModificationException异常，并且遍历的时候就不用额外加锁</li>
<li>元素可以为null</li>
<li><strong>底层就是数组，加锁就交由ReentrantLock来完成。</strong></li>
</ul>
<h4 id="4-常见方法"><a href="#4-常见方法" class="headerlink" title="4. 常见方法"></a>4. 常见方法</h4><p><strong>写加锁，读不加锁</strong></p>
<h5 id="4-1-add"><a href="#4-1-add" class="headerlink" title="4.1 add()"></a>4.1 add()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 加锁</span></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 得到原数组的长度和元素</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="keyword">int</span> len = elements.length;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 复制出一个新数组</span></span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加时，将新元素添加到新数组中</span></span><br><span class="line">        newElements[len] = e;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将volatile Object[] array 的指向替换成新数组</span></span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在添加的时候就上锁，并<strong>复制一个新数组，增加操作在新数组上完成，将array指向到新数组中</strong>，最后解锁</p>
<h5 id="4-2-get"><a href="#4-2-get" class="headerlink" title="4.2 get()"></a>4.2 get()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> get(getArray(), index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Object[] getArray() &#123;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="4-3-set"><a href="#4-3-set" class="headerlink" title="4.3 set()"></a>4.3 set()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 得到原数组的旧值</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        E oldValue = get(elements, index);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断新值和旧值是否相等</span></span><br><span class="line">        <span class="keyword">if</span> (oldValue != element) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 复制新数组，新值在新数组中完成</span></span><br><span class="line">            <span class="keyword">int</span> len = elements.length;</span><br><span class="line">            Object[] newElements = Arrays.copyOf(elements, len);</span><br><span class="line">            newElements[index] = element;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将array引用指向新数组</span></span><br><span class="line">            setArray(newElements);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Not quite a no-op; enssures volatile write semantics</span></span><br><span class="line">            setArray(elements);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="4-4-迭代器"><a href="#4-4-迭代器" class="headerlink" title="4.4 迭代器"></a>4.4 迭代器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 返回的迭代器是COWIterator</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> COWIterator&lt;E&gt;(getArray(), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 迭代器的成员属性</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Object[] snapshot;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> cursor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 迭代器的构造方法</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">COWIterator</span><span class="params">(Object[] elements, <span class="keyword">int</span> initialCursor)</span> </span>&#123;</span><br><span class="line">    cursor = initialCursor;</span><br><span class="line">    snapshot = elements;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 迭代器的方法...</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (! hasNext())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    <span class="keyword">return</span> (E) snapshot[cursor++];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//.... 可以发现的是，迭代器所有的操作都基于snapshot数组，而snapshot是传递进来的array数组</span></span><br></pre></td></tr></table></figure>

<p>CopyOnWriteArrayList在使用迭代器遍历的时候，操作的都是<strong>原数组</strong></p>
<h4 id="5-CopyOnWriteArrayList缺点"><a href="#5-CopyOnWriteArrayList缺点" class="headerlink" title="5. CopyOnWriteArrayList缺点"></a>5. CopyOnWriteArrayList缺点</h4><ul>
<li><strong>内存占用</strong>：每次<code>add()、set()、remove()</code>这些增删改操作都要<strong>复制一个数组</strong>出来。</li>
<li><strong>数据一致性</strong>：CopyOnWrite容器<strong>只能保证数据的最终一致性，不能保证数据的实时一致性</strong>。</li>
</ul>
<h3 id="十一、面试题"><a href="#十一、面试题" class="headerlink" title="十一、面试题"></a>十一、面试题</h3><p>Java容器可分为两大类：</p>
<ul>
<li>Collection<ul>
<li>List<ul>
<li><strong>ArrayList</strong></li>
<li>LinkedList</li>
<li>Vector(了解，已过时)</li>
</ul>
</li>
<li>Set<ul>
<li><strong>HashSet</strong><ul>
<li>LinkedHashSet</li>
</ul>
</li>
<li>TreeSet</li>
</ul>
</li>
</ul>
</li>
<li>Map<ul>
<li><strong>HashMap</strong><ul>
<li>LinkedHashMap</li>
</ul>
</li>
<li>TreeMap</li>
<li>ConcurrentHashMap</li>
<li>Hashtable(了解，，已过时)</li>
</ul>
</li>
</ul>
<p>着重标出的那些就是我们<strong>用得最多</strong>的容器。</p>
<h4 id="1-ArrayList和Vector的区别"><a href="#1-ArrayList和Vector的区别" class="headerlink" title="1. ArrayList和Vector的区别"></a>1. ArrayList和Vector的区别</h4><p><strong>共同点：</strong></p>
<ul>
<li>这两个类都实现了List接口，它们都是<strong>有序</strong>的集合(存储有序)，<strong>底层是数组</strong>。我们可以按位置索引号取出某个元素，<strong>允许元素重复和为null</strong>。</li>
</ul>
<p><strong>区别：</strong></p>
<ul>
<li><strong>同步性：</strong><ul>
<li>ArrayList是非同步的</li>
<li>Vector是同步的</li>
<li>即便需要同步的时候，我们可以使用Collections工具类来构建出同步的ArrayList而不用Vector</li>
</ul>
</li>
<li><strong>扩容大小：</strong><ul>
<li>Vector增长原来的一倍，ArrayList增长原来的0.5倍</li>
</ul>
</li>
</ul>
<h4 id="2-HashMap和Hashtable的区别"><a href="#2-HashMap和Hashtable的区别" class="headerlink" title="2. HashMap和Hashtable的区别"></a>2. HashMap和Hashtable的区别</h4><p><strong>共同点：</strong></p>
<ul>
<li>从存储结构和实现来讲基本上都是相同的，都是实现Map接口~</li>
</ul>
<p><strong>区别：</strong></p>
<ul>
<li><strong>同步性：</strong><ul>
<li>HashMap是非同步的</li>
<li>Hashtable是同步的</li>
<li>需要同步的时候，我们往往不使用，而使用ConcurrentHashMap<a href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484161&idx=1&sn=6f52fb1f714f3ffd2f96a5ee4ebab146&chksm=ebd74200dca0cb16288db11f566cb53cafc580e08fe1c570e0200058e78676f527c014ffef41#rd" target="_blank" rel="noopener">ConcurrentHashMap基于JDK1.8源码剖析</a></li>
</ul>
</li>
<li><strong>是否允许为null：</strong><ul>
<li>HashMap允许为null</li>
<li>Hashtable不允许为null</li>
</ul>
</li>
<li><strong>contains方法</strong><ul>
<li>这知识点是在牛客网刷到的，没想到这种题还会有(我不太喜欢)….</li>
<li>Hashtable有contains方法</li>
<li>HashMap把Hashtable的contains方法去掉了，改成了containsValue和containsKey</li>
</ul>
</li>
<li><strong>继承不同：</strong><ul>
<li>HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;</li>
<li>public class Hashtable&lt;K,V&gt; extends Dictionary&lt;K,V&gt;</li>
</ul>
</li>
</ul>
<h4 id="3-List和Map的区别"><a href="#3-List和Map的区别" class="headerlink" title="3. List和Map的区别"></a>3. List和Map的区别</h4><p><strong>共同点：</strong></p>
<ul>
<li>都是Java常用的容器，都是接口</li>
</ul>
<p><strong>不同点：</strong></p>
<ul>
<li><strong>存储结构不同</strong>：<ul>
<li>List是存储单列的集合</li>
<li>Map存储的是key-value键值对的集合</li>
</ul>
</li>
<li><strong>元素是否可重复</strong>：<ul>
<li>List允许元素重复</li>
<li>Map不允许key重复</li>
</ul>
</li>
<li><strong>是否有序</strong>：<ul>
<li>List集合是有序的(存储有序)</li>
<li>Map集合是无序的(存储无序)</li>
</ul>
</li>
</ul>
<h4 id="4-Set里的元素是不能重复的，那么用什么方法来区分重复与否呢-是用-还是equals"><a href="#4-Set里的元素是不能重复的，那么用什么方法来区分重复与否呢-是用-还是equals" class="headerlink" title="4. Set里的元素是不能重复的，那么用什么方法来区分重复与否呢? 是用==还是equals()?"></a>4. Set里的元素是不能重复的，那么用什么方法来区分重复与否呢? 是用==还是equals()?</h4><p>我们知道Set集合实际<strong>大都使用的是Map集合的put方法来添加元素</strong>。</p>
<p>以HashSet为例，HashSet里的元素不能重复，在源码(HashMap)是这样体现的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F; 1. 如果key 相等  </span><br><span class="line">  if (p.hash &#x3D;&#x3D; hash &amp;&amp;</span><br><span class="line">      ((k &#x3D; p.key) &#x3D;&#x3D; key || (key !&#x3D; null &amp;&amp; key.equals(k))))</span><br><span class="line">      e &#x3D; p;</span><br><span class="line">&#x2F;&#x2F; 2. 修改对应的value</span><br><span class="line">   if (e !&#x3D; null) &#123; &#x2F;&#x2F; existing mapping for key</span><br><span class="line">          V oldValue &#x3D; e.value;</span><br><span class="line">          if (!onlyIfAbsent || oldValue &#x3D;&#x3D; null)</span><br><span class="line">              e.value &#x3D; value;</span><br><span class="line">          afterNodeAccess(e);</span><br><span class="line">          return oldValue;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>添加元素的时候，如果key(也对应的Set集合的元素)相等，那么则修改value值。而在Set集合中，value值仅仅是一个Object对象罢了(<strong>该对象对Set本身而言是无用的</strong>)。</p>
<p>也就是说：Set集合如果添加的元素相同时，<strong>是根本没有插入的(仅修改了一个无用的value值)</strong>！从源码(HashMap)中也看出来，<strong>==和equals()方法都有使用</strong>！</p>
<h4 id="5-Collection和Collections的区别"><a href="#5-Collection和Collections的区别" class="headerlink" title="5. Collection和Collections的区别"></a>5. Collection和Collections的区别</h4><ol>
<li>Collection是集合的上级<strong>接口</strong>，继承它的有Set和List接口</li>
<li>Collections是集合的<strong>工具类</strong>，提供了一系列的静态方法对集合的搜索、查找、同步等操作</li>
</ol>
<h4 id="6-说出ArrayList-LinkedList的存储性能和特性"><a href="#6-说出ArrayList-LinkedList的存储性能和特性" class="headerlink" title="6. 说出ArrayList,LinkedList的存储性能和特性"></a>6. 说出ArrayList,LinkedList的存储性能和特性</h4><p>ArrayList的底层是数组，LinkedList的底层是双向链表。</p>
<ul>
<li>ArrayList它支持以角标位置进行索引出对应的元素(随机访问)，而LinkedList则需要遍历整个链表来获取对应的元素。因此<strong>一般来说ArrayList的访问速度是要比LinkedList要快的</strong></li>
<li>ArrayList由于是数组，对于删除和修改而言消耗是比较大(复制和移动数组实现)，LinkedList是双向链表删除和修改只需要修改对应的指针即可，消耗是很小的。因此<strong>一般来说LinkedList的增删速度是要比ArrayList要快的</strong></li>
</ul>
<h5 id="6-1扩展："><a href="#6-1扩展：" class="headerlink" title="6.1扩展："></a>6.1扩展：</h5><p>ArrayList的增删<strong>未必</strong>就是比LinkedList要慢。</p>
<ul>
<li>如果增删都是在<strong>末尾</strong>来操作【每次调用的都是remove()和add()】，此时ArrayList就不需要移动和复制数组来进行操作了。如果数据量有百万级的时，<strong>速度是会比LinkedList要快的</strong>。(我测试过)</li>
<li>如果<strong>删除操作</strong>的位置是在<strong>中间</strong>。由于LinkedList的消耗主要是在遍历上，ArrayList的消耗主要是在移动和复制上(底层调用的是arraycopy()方法，是native方法)。<ul>
<li>LinkedList的遍历速度是要慢于ArrayList的复制移动速度的</li>
<li>如果数据量有百万级的时，<strong>还是ArrayList要快</strong>。(我测试过)</li>
</ul>
</li>
</ul>
<h4 id="7-Enumeration和Iterator接口的区别"><a href="#7-Enumeration和Iterator接口的区别" class="headerlink" title="7. Enumeration和Iterator接口的区别"></a>7. Enumeration和Iterator接口的区别</h4><p>只是大概知道的是：Iterator替代了Enumeration，Enumeration是一个旧的迭代器了。</p>
<p>与Enumeration相比，Iterator更加安全，<strong>因为当一个集合正在被遍历的时候，它会阻止其它线程去修改集合</strong>。</p>
<ul>
<li>我们在做练习的时候，迭代时会不会经常出错，抛出ConcurrentModificationException异常，说我们在遍历的时候还在修改元素。</li>
<li>这其实就是fail-fast机制~具体可参考博文：<a href="https://blog.csdn.net/panweiwei1994/article/details/77051261" target="_blank" rel="noopener">https://blog.csdn.net/panweiwei1994/article/details/77051261</a></li>
</ul>
<p><strong>区别有三点：</strong></p>
<ul>
<li>Iterator的方法名比Enumeration更科学</li>
<li>Iterator有fail-fast机制，比Enumeration更安全</li>
<li>Iterator能够删除元素，Enumeration并不能删除元素</li>
</ul>
<h4 id="8-ListIterator有什么特点"><a href="#8-ListIterator有什么特点" class="headerlink" title="8. ListIterator有什么特点"></a>8. ListIterator有什么特点</h4><ul>
<li>ListIterator<strong>继承了</strong>Iterator接口，它用于<strong>遍历List集合的元素</strong>。</li>
<li>ListIterator可以实现<strong>双向遍历,添加元素，设置元素</strong></li>
</ul>
<p>看一下源码的方法就知道了：</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200420172642.png" alt="TIM截图20200420172642"></p>
<h4 id="9-并发集合类是什么？"><a href="#9-并发集合类是什么？" class="headerlink" title="9. 并发集合类是什么？"></a>9. 并发集合类是什么？</h4><p>Java1.5并发包（java.util.concurrent）<strong>包含线程安全集合类，允许在迭代时修改集合</strong>。</p>
<ul>
<li>Utils包下的集合迭代器被设计为fail-fast的，会抛出ConcurrentModificationException。但java.util.concurrent的并不会，感谢评论区提醒~</li>
<li>一部分类为：<ul>
<li>CopyOnWriteArrayList</li>
<li>ConcurrentHashMap</li>
<li>CopyOnWriteArraySet</li>
</ul>
</li>
</ul>
<h4 id="10-Java中HashMap的key值要是为类对象则该类需要满足什么条件？"><a href="#10-Java中HashMap的key值要是为类对象则该类需要满足什么条件？" class="headerlink" title="10. Java中HashMap的key值要是为类对象则该类需要满足什么条件？"></a>10. Java中HashMap的key值要是为类对象则该类需要满足什么条件？</h4><p><strong>需要同时重写该类的hashCode()方法和它的equals()方法</strong>。</p>
<ul>
<li>从源码可以得知，在插入元素的时候是<strong>先算出该对象的hashCode</strong>。如果hashcode相等话的。那么表明该对象是存储在同一个位置上的。</li>
<li>如果调用equals()方法，<strong>两个key相同</strong>，则<strong>替换元素</strong></li>
<li>如果调用equals()方法，<strong>两个key不相同</strong>，则说明该<strong>hashCode仅仅是碰巧相同</strong>，此时是散列冲突，将新增的元素放在桶子上</li>
</ul>
<p>一般来说，我们会认为：<strong>只要两个对象的成员变量的值是相等的，那么我们就认为这两个对象是相等的</strong>！因为，Object底层比较的是两个对象的地址，而对我们开发来说这样的意义并不大~这也就为什么我们要重写<code>equals()</code>方法</p>
<p>重写了equals()方法，就要重写hashCode()的方法。因为<strong>equals()认定了这两个对象相同</strong>，而<strong>同一个对象调用hashCode()方法时</strong>，是应该返回相同的值的！</p>
<h4 id="11-与Java集合框架相关的有哪些最好的实践"><a href="#11-与Java集合框架相关的有哪些最好的实践" class="headerlink" title="11. 与Java集合框架相关的有哪些最好的实践"></a>11. 与Java集合框架相关的有哪些最好的实践</h4><ol>
<li><strong>根据需要</strong>确定集合的类型。如果是单列的集合，我们考虑用Collection下的子接口ArrayList和Set。如果是映射，我们就考虑使用Map~</li>
<li>确定完我们的集合类型，我们接下来<strong>确定使用该集合类型下的哪个子类</strong>~我认为可以简单分成几个步骤：<ul>
<li>是否需要同步<ul>
<li>去找线程安全的集合类使用</li>
</ul>
</li>
<li>迭代时是否需要有序(插入顺序有序)<ul>
<li>去找Linked双向列表结构的</li>
</ul>
</li>
<li>是否需要排序(自然顺序或者手动排序)<ul>
<li>去找Tree红黑树类型的(JDK1.8) </li>
</ul>
</li>
</ul>
</li>
<li>估算存放集合的数据量有多大，无论是List还是Map，它们实现动态增长，都是有性能消耗的。在初始集合的时候给出一个<strong>合理的容量</strong>会减少动态增长时的消耗~</li>
<li><strong>使用泛型</strong>，避免在运行时出现ClassCastException</li>
<li>尽可能使用Collections工具类，或者获取只读、同步或空的集合，<strong>而非编写自己的实现</strong>。它将会提供代码重用性，它有着更好的稳定性和可维护性</li>
</ol>
<h4 id="12-ArrayList集合加入1万条数据，应该怎么提高效率"><a href="#12-ArrayList集合加入1万条数据，应该怎么提高效率" class="headerlink" title="12. ArrayList集合加入1万条数据，应该怎么提高效率"></a>12. ArrayList集合加入1万条数据，应该怎么提高效率</h4><p>ArrayList的默认初始容量为10，要插入大量数据的时候需要不断扩容，而扩容是非常影响性能的。因此，现在明确了10万条数据了，我们可以<strong>直接在初始化的时候就设置ArrayList的容量</strong>！</p>
<p>这样就可以提高效率了~</p>
<h4 id="13-集合框架底层实现总结"><a href="#13-集合框架底层实现总结" class="headerlink" title="13. 集合框架底层实现总结"></a>13. 集合框架底层实现总结</h4><ul>
<li>collection<ul>
<li>list<ul>
<li>arraylist：object数组</li>
<li>vector：object数组</li>
<li>LinkedList：双向链表</li>
</ul>
</li>
<li>set<ul>
<li>hashset（无序，唯一）：底层由hashmap实现</li>
<li>linkedhashset：继承于hashset，内部通过linkedhashmap来实现</li>
<li>treeset（有序，唯一）：红黑树（自平衡的有序二叉树）</li>
</ul>
</li>
<li>map<ul>
<li>hashmap：1.8之前：数组+链表，1.8之后：链表长度大于阀值（默认8），将链表转化为红黑树，减少搜索时间</li>
<li>linkedhashmap：继承自hashmap，在上面hashmap结构的基础上，增加了双向链表</li>
<li>hashtable：数组+链表组成，数组是hashmap的主体，链表为了解决哈希冲突</li>
<li>treemap：红黑树（自平衡的二叉树）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="14-各种对比"><a href="#14-各种对比" class="headerlink" title="14. 各种对比"></a>14. 各种对比</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421213435.png" alt="TIM截图20200421213435"></p>
<hr>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421213453.png" alt="TIM截图20200421213453"></p>
<hr>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421213501.png" alt="TIM截图20200421213501"></p>
<hr>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421213512.png" alt="TIM截图20200421213512"></p>
<hr>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421213524.png" alt="TIM截图20200421213524"></p>
<hr>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200421213534.png" alt="TIM截图20200421213534"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" itemprop="url">多线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:59:54+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="leancloud_visitors" data-flag-title="多线程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  35
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、什么是多线程"><a href="#一、什么是多线程" class="headerlink" title="一、什么是多线程"></a>一、什么是多线程</h3><h4 id="1-初识多线程"><a href="#1-初识多线程" class="headerlink" title="1. 初识多线程"></a>1. 初识多线程</h4><h5 id="1-1-进程"><a href="#1-1-进程" class="headerlink" title="1.1 进程"></a>1.1 进程</h5><p>电脑中，每一个程序就是一个进程</p>
<p>电脑管家是一个程序 ==&gt; 进程</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/CPU%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E6%97%B6%E9%97%B4%E7%89%87%E6%A6%82%E5%BF%B5.png" alt="CPU执行程序时间片概念"></p>
<p><strong>进程是系统进行资源分配和调度的独立单位。每一个进程都有它自己的内存空间和系统资源</strong></p>
<h5 id="1-2-线程"><a href="#1-2-线程" class="headerlink" title="1.2 线程"></a>1.2 线程</h5><p>引入线程主要是<strong>为了提高系统的执行效率，减少处理机的空转时间和调度切换的时间，以及便于系统管理。</strong>使OS具有更好的并发性。</p>
<ul>
<li>一个应用程序 ==&gt; 进程</li>
<li>应用程序的某一个功能 ==&gt; 线程</li>
<li>应用程序中可以同时执行多个功能 ==&gt; 多线程</li>
</ul>
<p>线程使用的是系统资源，多个线程的情况下，同时【抢占执行】会导致资源紧缺</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一个Java程序，最少有几个线程？</span><br><span class="line">    2个线程</span><br><span class="line">        main线程</span><br><span class="line">        JVM的GC机制，守护线程</span><br></pre></td></tr></table></figure>



<p>线程有<strong>两个基本类型</strong></p>
<ul>
<li>用户级线程：管理过程全部由用户程序完成，<strong>操作系统内核心只对进程进行管理</strong></li>
<li><strong>系统级线程</strong>(核心级线程)：<strong>由操作系统内核进行管理</strong></li>
</ul>
<p>多线程的存在，不是提高程序的执行速度。其实<strong>是为了提高应用程序的使用率</strong></p>
<h5 id="1-3-并发和并行"><a href="#1-3-并发和并行" class="headerlink" title="1.3 并发和并行"></a>1.3 并发和并行</h5><p>并行是针对进程的，<strong>并发是针对线程的</strong>。</p>
<ul>
<li>并发:<ul>
<li>两个或者两个以上的事务在同一个时间段发生</li>
</ul>
</li>
<li>并行:<ul>
<li>两个或者两个以上的事务在同一个时刻发生</li>
<li>宏观并行，微观串行</li>
</ul>
</li>
<li>【高并发】：<ul>
<li>同时在一个时间段以内，很多事情都发生了，这就是高并发。</li>
<li>双十一，中午下课的餐厅</li>
</ul>
</li>
</ul>
<h5 id="1-4-创建多线程"><a href="#1-4-创建多线程" class="headerlink" title="1.4 创建多线程"></a>1.4 创建多线程</h5><ul>
<li>继承Thread，重写run方法</li>
<li>实现Runnable接口，重写run方法</li>
</ul>
<h6 id="1-4-1创建一个类，继承Thread，重写run方法"><a href="#1-4-1创建一个类，继承Thread，重写run方法" class="headerlink" title="1.4.1创建一个类，继承Thread，重写run方法"></a>1.4.1创建一个类，继承Thread，重写run方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; <span class="number">200</span>; x++) &#123;</span><br><span class="line">        	System.out.println(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建两个线程对象</span></span><br><span class="line">    MyThread my1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">    MyThread my2 = <span class="keyword">new</span> MyThread();</span><br><span class="line"></span><br><span class="line">    my1.start();</span><br><span class="line">    my2.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="1-4-2-实现Runnable接口，重写run方法（推荐）"><a href="#1-4-2-实现Runnable接口，重写run方法（推荐）" class="headerlink" title="1.4.2 实现Runnable接口，重写run方法（推荐）"></a>1.4.2 实现Runnable接口，重写run方法（推荐）</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			System.out.println(<span class="string">"遵从Runnable接口实现自定义线程类"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        【写法一】</span><br><span class="line">		<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">					System.out.println(<span class="string">"匿名内部类方式创建对象，作为线程执行代码"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;).start();</span><br><span class="line">		</span><br><span class="line">        【写法二】</span><br><span class="line">		<span class="comment">// 创建一个Thread类对象，使用遵从Runnable接口的实现类作为构造方法参数</span></span><br><span class="line">		Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyThread2());</span><br><span class="line">		<span class="comment">// 借助于Thread类内的start方法开启线程</span></span><br><span class="line">		thread.start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 此处不是启动线程，而是将run作为一个普通方法执行</span></span><br><span class="line">        <span class="comment">// thread.run();</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			System.out.println(<span class="string">"main线程"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/lwclick/blogImg/raw/master/img/自定义线程执行流程简述.png" alt="自定义线程执行流程简述" style="zoom:50%;" />



<h5 id="1-5-Java实现多线程需要注意的细节"><a href="#1-5-Java实现多线程需要注意的细节" class="headerlink" title="1.5 Java实现多线程需要注意的细节"></a>1.5 Java实现多线程需要注意的细节</h5><p>不要将<code>run()</code>和<code>start()</code>搞混了~</p>
<p><strong>run()和start()方法区别：</strong></p>
<ul>
<li><code>run()</code>:仅仅是<strong>封装被线程执行的代码</strong>，直接调用是普通方法</li>
<li><code>start()</code>:首先<strong>启动了线程</strong>，然后再<strong>由jvm去调用该线程的run()方法。</strong></li>
<li><strong>jvm虚拟机的启动是多线程的</strong></li>
</ul>
<hr>
<h3 id="二、Thread类解析"><a href="#二、Thread类解析" class="headerlink" title="二、Thread类解析"></a>二、Thread类解析</h3><h4 id="1-Thread线程类API"><a href="#1-Thread线程类API" class="headerlink" title="1. Thread线程类API"></a>1. Thread线程类API</h4><h5 id="1-1-设置线程名"><a href="#1-1-设置线程名" class="headerlink" title="1.1 设置线程名"></a>1.1 设置线程名</h5><p>​            想要<strong>查看线程名</strong>是很简单的，调用<code>Thread.currentThread().getName()</code>即可</p>
<p>默认情况下，<strong>主线程叫做main，其他线程是Thread-x</strong></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200422092656.png" alt="TIM截图20200422092656"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 打印出当前线程的名字</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyThread myThread = <span class="keyword">new</span> MyThread();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//带参构造方法给线程起名字</span></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(myThread, <span class="string">"hello"</span>);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(myThread);</span><br><span class="line">        Thread thread3 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				System.out.println(<span class="string">"Anonymous Inner Type"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, <span class="string">"匿名内部类对象"</span>);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line">    	</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            Thread[hello,5,main]</span></span><br><span class="line"><span class="comment">            Thread[Thread-0,5,main]</span></span><br><span class="line"><span class="comment">            Thread[匿名内部类对象,5,main]</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 打印当前线程的名字</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以通过<code>setName(String name)</code>的方法来改掉线程的名字</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200422093028.png" alt="TIM截图20200422093028" style="zoom:80%;" />



<h5 id="1-2-守护线程"><a href="#1-2-守护线程" class="headerlink" title="1.2 守护线程"></a>1.2 守护线程</h5><p>守护线程是<strong>为其他线程服务的</strong>（例如GC）</p>
<p>守护线程一般用于:</p>
<ul>
<li>自动下载</li>
<li>操作日志</li>
<li>操作监控</li>
</ul>
<p>特点：</p>
<ul>
<li>当别的用户线程执行完了，虚拟机就会退出，守护线程也就会被停止掉了。</li>
</ul>
<p>注意：</p>
<ol>
<li><strong>在线程启动前</strong>设置为守护线程，方法是<code>setDaemon(boolean on)</code></li>
<li>使用守护线程<strong>不要访问共享资源</strong>(数据库、文件等)，因为它可能会在任何时候就挂掉了。</li>
<li>守护线程中产生的新线程也是守护线程</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BackUpThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">100</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			System.out.println(<span class="string">"Loading..."</span> + i + <span class="string">"%"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (<span class="number">100</span> == i) &#123;</span><br><span class="line">				System.out.println(<span class="string">"Loading Complete..."</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> BackUpThread());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 当前线程作为一个守护线程使用【主线程结束后，守护线程也结束】</span></span><br><span class="line">		thread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">		</span><br><span class="line">		thread.start();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">50</span>; i++) &#123;</span><br><span class="line">			Thread.sleep(<span class="number">100</span>);</span><br><span class="line">			System.out.println(<span class="string">"主线程运行中。。。。"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-3-优先级线程"><a href="#1-3-优先级线程" class="headerlink" title="1.3 优先级线程"></a>1.3 优先级线程</h5><p>线程优先级高仅仅表示线程<strong>获取的CPU时间片的几率高</strong>，但这不是一个<strong>确定的因素</strong></p>
<p>java提供的 优先级默认是5，最低是1，最高是10</p>
<p><code>setPriority</code>是一个本地(navite)的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">setPriority</span><span class="params">(<span class="keyword">int</span> newPriority)</span></span>;</span><br><span class="line"></span><br><span class="line">thread.setPriority(Thread.NORM_PRIORITY);</span><br></pre></td></tr></table></figure>



<h5 id="1-4-线程生命周期"><a href="#1-4-线程生命周期" class="headerlink" title="1.4 线程生命周期"></a>1.4 线程生命周期</h5><h6 id="1-4-1-sleep方法"><a href="#1-4-1-sleep方法" class="headerlink" title="1.4.1 sleep方法"></a>1.4.1 sleep方法</h6><p>调用sleep方法会进入计时等待状态，等时间到了，<strong>进入的是就绪状态而并非是运行状态</strong>！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(1000);   &#x2F;&#x2F; 【所处位置的代码块休眠】</span><br></pre></td></tr></table></figure>



<h6 id="1-4-2-interrupt方法"><a href="#1-4-2-interrupt方法" class="headerlink" title="1.4.2 interrupt方法"></a>1.4.2 interrupt方法</h6><p>Stop方法太暴力了，不安全，一般使用的是interrupt来<strong>请求终止线程</strong></p>
<ul>
<li>interrupt<strong>不会真正停止</strong>一个线程，它仅仅是给这个线程发了一个信号告诉它，它应该要结束了</li>
<li>具体到底中断还是继续运行，应该<strong>由被通知的线程自己处理</strong></li>
</ul>
<hr>
<h3 id="三、线程安全问题和解决方案"><a href="#三、线程安全问题和解决方案" class="headerlink" title="三、线程安全问题和解决方案"></a>三、线程安全问题和解决方案</h3><h4 id="1-共享资源能使用问题"><a href="#1-共享资源能使用问题" class="headerlink" title="1. 共享资源能使用问题"></a>1. 共享资源能使用问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;湄公河行动&gt;&gt;</span><br><span class="line">	100张票</span><br><span class="line"></span><br><span class="line">淘票票  美团  猫眼</span><br><span class="line">三个销售渠道，100张票是一个共享资源！！！</span><br><span class="line">三个销售渠道，可以认为是三个销售线程！！！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">问题一：</span><br><span class="line">	100张票共享资源问题，选什么来保存</span><br><span class="line">	【局部变量】：</span><br><span class="line">		在方法内，如果run方法执行，存在</span><br><span class="line">		run方法当前执行完毕，销毁。</span><br><span class="line">		每一个线程对象中都有run方法，无法满足共享问题</span><br><span class="line">	【成员变量】：</span><br><span class="line">		每一个线程对象中，都有一个对应的成员变量，非共享资源。</span><br><span class="line">	【【静态成员变量】】：</span><br><span class="line">		属于类变量，所有的当前类对象，使用的静态成员变量都是一个，而且一处修改，处处</span><br><span class="line">		受影响。【共享资源】</span><br><span class="line"></span><br><span class="line">问题二:</span><br><span class="line">	资源冲突问题</span><br></pre></td></tr></table></figure>

<p><strong>代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 共享资源冲突问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 共享资源</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ticket = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName() </span><br><span class="line">                                   + <span class="string">"售出了"</span> + ticket + <span class="string">"张票"</span>);</span><br><span class="line">				ticket -= <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Thread.sleep(<span class="number">100</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName() + <span class="string">"售罄！"</span>);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SingleThread(), <span class="string">"淘票票"</span>);</span><br><span class="line">		Thread thread2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SingleThread(), <span class="string">"猫眼"</span>);</span><br><span class="line">		Thread thread3 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SingleThread(), <span class="string">"美图"</span>);</span><br><span class="line">		</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread2.start();</span><br><span class="line">		thread3.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第100张，卖了3次                      直接到第97张</p>
<p><strong>解决方法：同步代码块，同步方法，Lock</strong></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/%E8%B5%84%E6%BA%90%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98.png" alt="资源冲突问题"></p>
<h4 id="2-synchronized锁简介"><a href="#2-synchronized锁简介" class="headerlink" title="2. synchronized锁简介"></a>2. synchronized锁简介</h4><h5 id="2-1-synchronized是什么"><a href="#2-1-synchronized是什么" class="headerlink" title="2.1 synchronized是什么"></a>2.1 synchronized是什么</h5><p>synchronized是Java的一个<strong>关键字</strong>，它能够将<strong>代码块(方法)锁起来</strong></p>
<ul>
<li><p>synchronized是一种<strong>互斥锁</strong></p>
</li>
<li><p><strong>一次只能允许一个线程进入被锁住的代码块</strong></p>
</li>
</ul>
<p>​              synchronized是一种<strong>内置锁/监视器锁</strong></p>
<p>Java中的synchronized，通过使用内置锁，来实现对变量的同步操作，进而实现了<strong>对变量操作的原子性和其他线程对变量的可见性</strong>，从而确保了并发情况下的线程安全。</p>
<h5 id="2-2-重入锁"><a href="#2-2-重入锁" class="headerlink" title="2.2 重入锁"></a>2.2 重入锁</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 锁住了</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggingWidget</span> <span class="keyword">extends</span> <span class="title">Widget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 锁住了</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(toString() + <span class="string">": calling doSomething"</span>);</span><br><span class="line">    <span class="keyword">super</span>.doSomething();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>当线程A进入到LoggingWidget的<code>doSomething()</code>方法时，<strong>此时拿到了LoggingWidget实例对象的锁</strong>。</li>
<li>随后在方法上又调用了父类Widget的<code>doSomething()</code>方法，它<strong>又是被synchronized修饰</strong>。</li>
<li>那现在我们LoggingWidget实例对象的锁还没有释放，进入父类Widget的<code>doSomething()</code>方法<strong>还需要一把锁吗</strong></li>
</ol>
<p><strong>不需要的！</strong></p>
<p>因为<strong>锁的持有者是“线程”，而不是“调用”</strong>。线程A已经是有了LoggingWidget实例对象的锁了，当再需要的时候可以继续<strong>“开锁”</strong>进去的！</p>
<p>这就是内置锁的<strong>可重入性</strong>。记住，<strong>锁的持有者是线程</strong>。</p>
<h5 id="2-3-释放锁的时机"><a href="#2-3-释放锁的时机" class="headerlink" title="2.3 释放锁的时机"></a>2.3 释放锁的时机</h5><ol>
<li>当方法(代码块)执行完毕后会<strong>自动释放锁</strong>，不需要做任何的操作。</li>
<li><strong>当一个线程执行的代码出现异常时，其所持有的锁会自动释放</strong>。</li>
</ol>
<h4 id="3-Lock锁简介"><a href="#3-Lock锁简介" class="headerlink" title="3. Lock锁简介"></a>3. Lock锁简介</h4><p>必须要手动释放</p>
<ul>
<li>Lock方式来获取锁<strong>支持中断、超时不获取、是非阻塞的</strong></li>
<li><strong>提高了语义化</strong>，哪里加锁，哪里解锁都得写出来</li>
<li><strong>Lock显式锁可以给我们带来很好的灵活性，但同时我们必须手动释放锁</strong></li>
<li>支持Condition条件对象</li>
<li><strong>允许多个读线程同时访问共享资源</strong></li>
</ul>
<h4 id="4-公平锁简介"><a href="#4-公平锁简介" class="headerlink" title="4. 公平锁简介"></a>4. 公平锁简介</h4><p>公平锁理解起来非常简单：</p>
<ul>
<li>线程将按照它们<strong>发出请求的顺序来获取锁</strong></li>
</ul>
<p>非公平锁就是：</p>
<ul>
<li>线程发出请求的时可以<strong>“插队”</strong>获取锁</li>
</ul>
<p>Lock和synchronize都是<strong>默认使用非公平锁的</strong>。如果不是必要的情况下，不要使用公平锁</p>
<ul>
<li>公平锁会来带一些性能的消耗的</li>
</ul>
<h4 id="5-synchronized同步代码块（可以用，有隐患）"><a href="#5-synchronized同步代码块（可以用，有隐患）" class="headerlink" title="5. synchronized同步代码块（可以用，有隐患）"></a>5. synchronized同步代码块（可以用，有隐患）</h4><p>sleep不会开锁，此种方法被称为<strong>客户端锁</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">synchronized (&#x2F;* 锁对象 *&#x2F;) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;*</span><br><span class="line">特征:</span><br><span class="line"> 	1. synchronized 小括号里面的对象是锁对象，并且要求如果是多线程的情况下，锁对象必须是同一个对象。</span><br><span class="line"> 	2. synchronized 大括号中的代码块就是需要进行同步的代码，或者说是加锁的代码，大括号里面的内容，【有且只允许一个线程进入】</span><br><span class="line"> 	3. 同步代码块越短越好，在保证安全的情况下，提高性能</span><br><span class="line"> </span><br><span class="line">问题:</span><br><span class="line">	1. 目前【锁对象】感觉很随意，存在一定的隐患</span><br><span class="line">	2. 代码层级关系很复杂，看着有点麻烦</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">synchronized (&quot;锁&quot;) &#123;</span><br><span class="line">				if (ticket &gt; 0) &#123;</span><br><span class="line">					System.out.println(Thread.currentThread().getName() + &quot;售出了&quot; + ticket + &quot;张票&quot;);</span><br><span class="line">					ticket -&#x3D; 1;</span><br><span class="line">					try &#123;</span><br><span class="line">						Thread.sleep(100);</span><br><span class="line">					&#125; catch (InterruptedException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125; else &#123;</span><br><span class="line">					System.out.println(Thread.currentThread().getName() + &quot;售罄！&quot;);</span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-synchronized同步方法（非静态使用多）"><a href="#6-synchronized同步方法（非静态使用多）" class="headerlink" title="6. synchronized同步方法（非静态使用多）"></a>6. synchronized同步方法（非静态使用多）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">synchronized 作为关键字来【修饰方法】，修饰的方法就是对应的同步方</span><br><span class="line">有且只允许一个线程进入，到底是谁来完成的加锁操作?</span><br><span class="line"></span><br><span class="line">1. 静态成员方法</span><br><span class="line">	锁对象，是当前类对应的字节码文件.class   [类名.class]</span><br><span class="line">	</span><br><span class="line">2. 非静态成员方法</span><br><span class="line">	锁对象就是当前类对象      this</span><br><span class="line"></span><br><span class="line">选择同步【方法】是否使用static修饰问题</span><br><span class="line">	1. 如果非static修饰，要保证执行的【线程对象有且只有一个】，因为锁对象就是当前线程对象</span><br><span class="line">	SingleThread2 singleThread2 &#x3D; new SingleThread2();</span><br><span class="line">    Thread thread1 &#x3D; new Thread(singleThread2, &quot;淘票票&quot;);</span><br><span class="line">    Thread thread2 &#x3D; new Thread(singleThread2, &quot;猫眼&quot;);</span><br><span class="line">    Thread thread3 &#x3D; new Thread(singleThread2, &quot;美图&quot;);</span><br><span class="line">    public synchronized void sellTicket() &#123; &#125;</span><br><span class="line">	</span><br><span class="line">	2. 如果是static修饰，锁对象具有唯一性，多个线程使用的锁是同一个锁。</span><br><span class="line">	public static synchronized void sellTicket() &#123; &#125;</span><br><span class="line">    Thread thread1 &#x3D; new Thread(new SingleThread2(), &quot;淘票票&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 共享资源冲突问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义售票线程类</span></span><br><span class="line"><span class="comment"> * 使用非静态成员同步方法，需要满足【有且只有一个】当前线程类对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleThread2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 共享资源</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> ticket = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * 调用一个同步方法</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			sellTicket();</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (<span class="number">0</span> == ticket) &#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 完成一个同步方法，该方法是一个非静态成员方法，锁对象就是   this，当前类对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sellTicket</span><span class="params">()</span> </span>&#123;      【使用<span class="keyword">synchronized</span>修饰方法】</span><br><span class="line">		<span class="keyword">if</span> (ticket &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">"售出了"</span> + ticket + <span class="string">"张票"</span>);</span><br><span class="line">			ticket -= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">100</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.println(Thread.currentThread().getName() + <span class="string">"售罄！"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    【解决方法二】</span><br><span class="line">    <span class="comment">// 使用静态方法    .class  当前类对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sellTicket</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    使用Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SingleThread2(), <span class="string">"淘票票"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        【如果使用Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SingleThread(), <span class="string">"淘票票"</span>);】</span><br><span class="line">        【就是<span class="keyword">new</span>了三个对象，使用的不同的锁方法】</span><br><span class="line">        </span><br><span class="line">        【解决方法一】</span><br><span class="line">		SingleThread2 singleThread2 = <span class="keyword">new</span> SingleThread2();</span><br><span class="line">		Thread thread1 = <span class="keyword">new</span> Thread(singleThread2, <span class="string">"淘票票"</span>);</span><br><span class="line">		Thread thread2 = <span class="keyword">new</span> Thread(singleThread2, <span class="string">"猫眼"</span>);</span><br><span class="line">		Thread thread3 = <span class="keyword">new</span> Thread(singleThread2, <span class="string">"美图"</span>);</span><br><span class="line">		</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread2.start();</span><br><span class="line">		thread3.start();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="7-Lock锁"><a href="#7-Lock锁" class="headerlink" title="7. Lock锁"></a>7. Lock锁</h4><p>创建Lock构造方法<br>        Lock lock = new ReentrantLock();</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Java提供了一个对于线程安全问题，加锁操作相对于同步代码块和同步方法更加广泛的一种操作方式。</span><br><span class="line">1. 对象化操作。</span><br><span class="line">	创建Lock构造方法</span><br><span class="line">		Lock lock &#x3D; new ReentrantLock();</span><br><span class="line">2. 方法化操作。</span><br><span class="line">	开锁:</span><br><span class="line">		unlock();</span><br><span class="line">	加锁:</span><br><span class="line">		lock();</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">import java.util.concurrent.locks.Lock;</span><br><span class="line">import java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line">class SingleThread5 implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; 共享资源</span><br><span class="line">	private static int ticket &#x3D; 100;</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F; 定义一个【静态成员变量】</span><br><span class="line">	static Lock lock &#x3D; new ReentrantLock();</span><br><span class="line">	使用Thread thread1 &#x3D; new Thread(new SingleThread5(), &quot;淘票票&quot;);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F; 定义一个【成员变量】</span><br><span class="line">	Lock lock &#x3D; new ReentrantLock();</span><br><span class="line">	使用SingleThread5 singleThread5 &#x3D; new SingleThread5();</span><br><span class="line">	Thread thread1 &#x3D; new Thread(singleThread5, &quot;淘票票&quot;);</span><br><span class="line">	</span><br><span class="line">	@Override</span><br><span class="line">	public void run() &#123;</span><br><span class="line">		while (true) &#123;</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; lock对象加锁</span><br><span class="line">			lock.lock();</span><br><span class="line">			if (ticket &gt; 0) &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName() + &quot;售出了&quot; + ticket + &quot;张票&quot;);</span><br><span class="line">				ticket -&#x3D; 1;</span><br><span class="line"></span><br><span class="line">				try &#123;</span><br><span class="line">					Thread.sleep(100);</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					&#x2F;&#x2F; TODO Auto-generated catch block</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName() + &quot;售罄！&quot;);</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			&#x2F;&#x2F; 解除锁</span><br><span class="line">			lock.unlock();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Demo5 &#123;</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		</span><br><span class="line">		Thread thread1 &#x3D; new Thread(new SingleThread5(), &quot;淘票票&quot;);</span><br><span class="line">		Thread thread2 &#x3D; new Thread(new SingleThread5(), &quot;猫眼&quot;);</span><br><span class="line">		Thread thread3 &#x3D; new Thread(new SingleThread5(), &quot;美图&quot;);</span><br><span class="line">		</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread2.start();</span><br><span class="line">		thread3.start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="8-加锁方法总结"><a href="#8-加锁方法总结" class="headerlink" title="8. 加锁方法总结"></a>8. 加锁方法总结</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 一锁一线程，一锁多线程问题。</span><br><span class="line">	使用对应的锁操作对应的线程，考虑静态和非静态问题。</span><br><span class="line">	同步方法和Lock锁使用。</span><br><span class="line">	</span><br><span class="line">	【静态是一锁多目标，非静态是一锁一目标】</span><br><span class="line"></span><br><span class="line">2. 涉及到同步问题时，要考虑好锁对象的选择问题</span><br><span class="line">	同步代码块，同步方法，Lock对象。</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="四、AQS"><a href="#四、AQS" class="headerlink" title="四、AQS"></a>四、AQS</h3><h4 id="1-AQS是什么"><a href="#1-AQS是什么" class="headerlink" title="1. AQS是什么"></a>1. AQS是什么</h4><p>juc是什么：<strong>juc其实就是包的缩写(java.util.concurrnt)</strong></p>
<p><strong>AbstractQueuedSynchronizer简称为AQS</strong></p>
<ul>
<li>AQS其实就是一个可以给我们实现锁的<strong>框架</strong></li>
<li>内部实现的关键是：<strong>先进先出的队列、state状态</strong></li>
<li>定义了内部类ConditionObject</li>
<li>拥有两种线程模式<ul>
<li>独占模式</li>
<li>共享模式</li>
</ul>
</li>
<li>在LOCK包中的相关锁(常用的有ReentrantLock、 ReadWriteLock)都是<strong>基于AQS来构建</strong></li>
<li>一般我们<strong>叫AQS为同步器</strong></li>
</ul>
<h4 id="2-简单了解AQS"><a href="#2-简单了解AQS" class="headerlink" title="2. 简单了解AQS"></a>2. 简单了解AQS</h4><h5 id="2-1-同步状态"><a href="#2-1-同步状态" class="headerlink" title="2.1 同步状态"></a>2.1 同步状态</h5><p>使用volatile修饰实现线程可见性：</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200422101835.png" alt="TIM截图20200422101835"></p>
<p>修改state状态值时使用CAS算法来实现：</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200422101932.png" alt="TIM截图20200422101932"></p>
<p>先进先出队列，这个队列被称为：CLH队列(三个名字组成)，是一个<strong>双向队列</strong></p>
<h5 id="2-2-acquire方法"><a href="#2-2-acquire方法" class="headerlink" title="2.2 acquire方法"></a>2.2 acquire方法</h5><p><strong>获取独占锁</strong>的过程就是在acquire定义的，该方法用到了<strong>模板设计模式</strong>，由子类实现的~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过程：acquire(int)尝试获取资源，如果获取失败，将线程插入等待队列。插入等待队列后，acquire(int)并没有放弃获取资源，而是根据前置节点状态状态判断是否应该继续获取资源，如果前置节点是头结点，继续尝试获取资源，如果前置节点是SIGNAL状态，就中断当前线程，否则继续尝试获取资源。直到当前线程被park()或者获取到资源，acquire(int)结束。</span><br></pre></td></tr></table></figure>



<h5 id="2-3-release方法"><a href="#2-3-release方法" class="headerlink" title="2.3 release方法"></a>2.3 release方法</h5><p><strong>释放独占锁</strong>的过程就是在acquire定义的，该方法也用到了<strong>模板设计模式</strong>，由子类实现的~</p>
<hr>
<h3 id="五、ReentrantLock和ReentrantReadWriteLock"><a href="#五、ReentrantLock和ReentrantReadWriteLock" class="headerlink" title="五、ReentrantLock和ReentrantReadWriteLock"></a>五、ReentrantLock和ReentrantReadWriteLock</h3><p>Lock锁主要的两个子类：ReentrantLock 及 ReentrantReadWriteLock</p>
<h4 id="1-ReentrantLock"><a href="#1-ReentrantLock" class="headerlink" title="1. ReentrantLock"></a>1. ReentrantLock</h4><ul>
<li><strong>是一种互斥锁</strong></li>
<li>比synchronized更有伸缩性(灵活)</li>
<li><strong>支持公平锁(是相对公平的)</strong>，也有非公平锁（默认）</li>
<li>使用时最标准用法是在try之前调用lock方法，在finally代码块释放锁</li>
<li><strong>AQS是ReentrantLock的基础，AQS是构建锁、同步器的框架</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123; </span><br><span class="line">        lock.lock();  <span class="comment">// block until condition holds</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ... method body</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-1-非公平lock方法"><a href="#1-1-非公平lock方法" class="headerlink" title="1.1 非公平lock方法"></a>1.1 非公平lock方法</h5><p>尝试获取锁，获取失败的话就调用AQS的<code>acquire(1)</code>方法</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200422103111.png" alt="TIM截图20200422103111"></p>
<p>acquire(1)方法</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200422103155.png" alt="TIM截图20200422103155"></p>
<h5 id="1-2-公平lock方法"><a href="#1-2-公平lock方法" class="headerlink" title="1.2 公平lock方法"></a>1.2 公平lock方法</h5><p>公平的lock方法其实就<strong>多了一个状态条件</strong></p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200422103311.png" alt="TIM截图20200422103311"></p>
<p>这个方法主要是判断<strong>当前线程是否位于CLH同步队列中的第一个。如果是则返回flase，否则返回true</strong>。</p>
<h4 id="2-ReentrantReadWriteLock"><a href="#2-ReentrantReadWriteLock" class="headerlink" title="2. ReentrantReadWriteLock"></a>2. ReentrantReadWriteLock</h4><p>synchronized内置锁和ReentrantLock都是<strong>互斥锁</strong>(一次只能有一个线程进入到临界区(被锁定的区域))</p>
<p>而ReentrantReadWriteLock是一个<strong>读写锁</strong></p>
<ul>
<li>在<strong>读</strong>取数据的时候，可以<strong>多个线程同时进入到到临界区</strong>(被锁定的区域)</li>
<li>在<strong>写</strong>数据的时候，无论是读线程还是写线程都是<strong>互斥</strong>的</li>
</ul>
<p><strong>在读的时候可以共享，在写的时候是互斥的</strong></p>
<ul>
<li>读锁不支持条件对象，写锁支持条件对象</li>
<li>读锁不能升级为写锁，写锁可以降级为读锁</li>
<li>读写锁也有公平和非公平模式</li>
<li><strong>读锁支持多个读线程进入临界区，写锁是互斥的</strong></li>
</ul>
<h4 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h4><ul>
<li><strong>AQS是</strong>ReentrantReadWriteLock和ReentrantLock的<strong>基础</strong>，因为默认的实现都是在内部类Syn中，而Syn是继承AQS的~</li>
<li>ReentrantReadWriteLock和ReentrantLock<strong>都支持公平和非公平模式</strong>，公平模式下会去看FIFO队列线程是否是在队头，而非公平模式下是没有的</li>
<li>ReentrantReadWriteLock是一个读写锁，如果读的线程比写的线程要多很多的话，那可以考虑使用它。它使用state的变量<strong>高16位是读锁，低16位是写锁</strong></li>
<li><strong>写锁可以降级为读锁，读锁不能升级为写锁</strong></li>
<li><strong>写锁是互斥的，读锁是共享的</strong>。</li>
</ul>
<hr>
<h3 id="六、线程状态"><a href="#六、线程状态" class="headerlink" title="六、线程状态"></a>六、线程状态</h3><h4 id="1-六种状态"><a href="#1-六种状态" class="headerlink" title="1. 六种状态"></a>1. 六种状态</h4><table>
<thead>
<tr>
<th align="left">状态</th>
<th align="left">导致状态的发生条件</th>
</tr>
</thead>
<tbody><tr>
<td align="left">NEW(新建)</td>
<td align="left">线程刚刚被创建，没有启动，没有调用start方法</td>
</tr>
<tr>
<td align="left">RUNNABLE(可运行)</td>
<td align="left">线程已经可以在JVM中运行，但是是否运行不确定，看当前线程是否拥有CPU执行权</td>
</tr>
<tr>
<td align="left">BLOCKED(锁阻塞)</td>
<td align="left">当前线程进入一个同步代码需要获取对应的锁对象，但是发现当前锁对象被其他线程持有，当前线程会进入一个 BLOCKED。如果占用锁对象的线程打开锁对象，当前线程持有对应锁对象，进入 Runnable 状态</td>
</tr>
<tr>
<td align="left">WAITING(无限等待)</td>
<td align="left">通过一个wait方法线程进入一个无限等待状态，这里需要另外一个线程进行唤醒操作。进入无限等待状态的线程是无法自己回到 Runnable 状态，需要其他线程通过 notify 或者 notifyAll 方法进行唤醒操作</td>
</tr>
<tr>
<td align="left">TIMED_WAITING(计时等待)</td>
<td align="left">当前线程的确是等待状态，但是会在一定时间之后自动回到Runnable状态，例如 Thread.sleep() 或者是Object类内的 wait(int ms);</td>
</tr>
<tr>
<td align="left">TERMINATED(被终止)</td>
<td align="left">因为Run方法运行结束正常退出线程，或者说在运行的过程中因为出现异常导致当前线程GG</td>
</tr>
</tbody></table>
<h4 id="2-TIMED-WAITING-计时等待"><a href="#2-TIMED-WAITING-计时等待" class="headerlink" title="2. TIMED_WAITING(计时等待)"></a>2. TIMED_WAITING(计时等待)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Thread.sleep(int ms);</span><br><span class="line">	在对应线程代码块中，当前线程休眠指定的时间。</span><br><span class="line">	</span><br><span class="line">Object类内  wait(int ms);</span><br><span class="line">	让当前线程进入一个计时等待状态</span><br><span class="line">		1. 规定的时间计时完毕，线程回到可运行状态</span><br><span class="line">		2. 在等待时间内，通过其他线程被notify或者notifyAll唤醒</span><br><span class="line"></span><br><span class="line">Sleep方法</span><br><span class="line">	1. 调用之后休眠指定时间</span><br><span class="line">	2. 【sleep方法必须执行在run方法内，才可以休眠线程】</span><br><span class="line">	3. sleep不会打开当前线程占用的锁对象。</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIMED_WAITING状态.png" alt="TIMED_WAITING状态" style="zoom:50%;" />



<h4 id="3-BLOCKED-锁阻塞"><a href="#3-BLOCKED-锁阻塞" class="headerlink" title="3. BLOCKED(锁阻塞)"></a>3. BLOCKED(锁阻塞)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">线程中有锁存在，线程需要进入带有锁操作的同步代码，如果锁对象被别人持有，只能在锁外等待</span><br><span class="line"></span><br><span class="line">锁阻塞状态的线程是否能够抢到锁对象有很多因素</span><br><span class="line">	1. 优先级问题，非决定因素</span><br><span class="line">	2. CPU执行概率问题。</span><br><span class="line"></span><br><span class="line">后期高并发一定会存在多线程操作锁对象问题，秒杀，抢购...</span><br><span class="line">	队列方式来处理</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/lwclick/blogImg/raw/master/img/BLOCKED锁阻塞状态.png" alt="BLOCKED锁阻塞状态" style="zoom:50%;" />



<h4 id="4-WAITING-无限等待"><a href="#4-WAITING-无限等待" class="headerlink" title="4. WAITING(无限等待)"></a>4. WAITING(无限等待)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">当某一个线程被执行wait()方法，需要等待另外的一个线程进行唤醒操作。</span><br><span class="line"></span><br><span class="line">一下三个方法都是Object类内的方法:</span><br><span class="line">	public void wait();</span><br><span class="line">		在哪一个线程中执行，就会让当前线程进入一个无限等待状态。</span><br><span class="line">			1. 所在线程进入无限等待状态</span><br><span class="line">			2. 开启【锁对象】</span><br><span class="line">	</span><br><span class="line">	public void notify();</span><br><span class="line">		唤醒和当前锁对象有关的无限等待线程中的一个，随机选择。</span><br><span class="line">			1. 唤醒一个无限等待状态线程</span><br><span class="line">			2. 开启【锁对象】</span><br><span class="line">	</span><br><span class="line">	public void notifyAll();</span><br><span class="line">		唤醒所有和当前锁对象有关的无限等待线程</span><br><span class="line">			1. 唤醒所有线程</span><br><span class="line">			2. 开启【锁对象】</span><br><span class="line">			3. 线程进入锁对象抢占过程，就有可能进入一个锁阻塞状态。</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/lwclick/blogImg/raw/master/img/无限等待图例.png" alt="无限等待图例" style="zoom:50%;" />



<h4 id="5-线程执行的所有状态分析图"><a href="#5-线程执行的所有状态分析图" class="headerlink" title="5. 线程执行的所有状态分析图"></a>5. 线程执行的所有状态分析图</h4><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/%E5%85%AD%E5%A4%A7%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81.png" alt="六大线程状态"></p>
<hr>
<h3 id="七、线程通信"><a href="#七、线程通信" class="headerlink" title="七、线程通信"></a>七、线程通信</h3><h4 id="1-生活化例子"><a href="#1-生活化例子" class="headerlink" title="1. 生活化例子"></a>1. 生活化例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">预约 --&gt; 抢购</span><br><span class="line">消费者 &lt;--&gt; 商品 &lt;--&gt; 生产者</span><br><span class="line"></span><br><span class="line">消费者</span><br><span class="line">    1. 购买商品</span><br><span class="line">    2. 等待，不过【在等待之前】，需要告知生产者快点生产</span><br><span class="line"></span><br><span class="line">生产者：</span><br><span class="line">    1. 生产商品</span><br><span class="line">    2. 休息，在【休息之前】，要告知消费者你快来买啊</span><br><span class="line"></span><br><span class="line">商品:</span><br><span class="line">	就是两个独立线程之间的共享资源。</span><br></pre></td></tr></table></figure>

<h4 id="2-共享资源处理问题"><a href="#2-共享资源处理问题" class="headerlink" title="2. 共享资源处理问题"></a>2. 共享资源处理问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">现在存在两个完全无关的线程，生产者和消费者，但是商品会作为他们两者之间的共享资源。</span><br><span class="line"></span><br><span class="line">生产者和消费者中都有一个成员变量</span><br><span class="line">	商品类型</span><br><span class="line">	</span><br><span class="line">【解决方案】</span><br><span class="line">    创建生产者或者消费者线程对象时，使用同一个商品类对象，</span><br><span class="line">    	作为构造方法参数进行初始化操作</span><br></pre></td></tr></table></figure>

<h4 id="3-程序设计"><a href="#3-程序设计" class="headerlink" title="3. 程序设计"></a>3. 程序设计</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Goods goods = <span class="keyword">new</span> Goods(<span class="string">"烤羊排"</span>, <span class="number">138</span>, <span class="keyword">true</span>);</span><br><span class="line">		</span><br><span class="line">		Producer producer = <span class="keyword">new</span> Producer(goods);</span><br><span class="line">		Custmor custmor = <span class="keyword">new</span> Custmor(goods);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> Thread(producer).start();</span><br><span class="line">		<span class="keyword">new</span> Thread(custmor).start();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		两个线程同时运行，一个线程进入线程代码块，同时加锁，运行结束</span></span><br><span class="line"><span class="comment">		两个线程回到同一个起跑线，但是保障之前运行锅的线程，需要进行休眠操作</span></span><br><span class="line"><span class="comment">		如果已经执行完成的，调用wait方法， 进入休眠状态、。</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Custmor消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Custmor</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Goods goods = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Custmor</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Custmor</span><span class="params">(Goods goods)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.goods = goods;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (goods) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Thread.sleep(<span class="number">300</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// 可以购买</span></span><br><span class="line">				<span class="keyword">if</span> (!goods.isProduct()) &#123;</span><br><span class="line">					System.out.println(<span class="string">"消费者购买了"</span> + goods.getName() + <span class="string">":"</span> + goods.getPrice());</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 修改商品标记</span></span><br><span class="line">					goods.setProduct(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 唤醒生产者</span></span><br><span class="line">					System.out.println(<span class="string">"唤醒生产者"</span>);</span><br><span class="line">					goods.notify();</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					System.out.println(<span class="string">"消费者进入无限等待状态"</span>);</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						goods.wait();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">						<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Goods 商品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goods</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> price;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> product;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Goods</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Goods</span><span class="params">(String name, <span class="keyword">float</span> price, <span class="keyword">boolean</span> product)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">		<span class="keyword">this</span>.product = product;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	getter/ setter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Producer生产者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Goods goods = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(Goods goods)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.goods = goods;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Thread线程代码块</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (goods) &#123;    【加锁】</span><br><span class="line"></span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					Thread.sleep(<span class="number">300</span>);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 需要生产</span></span><br><span class="line">				<span class="keyword">if</span> (goods.isProduct()) &#123;</span><br><span class="line">					<span class="keyword">if</span> (Math.random() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">						goods.setName(<span class="string">"擀面皮"</span>);</span><br><span class="line">						goods.setPrice(<span class="number">6.0F</span>);</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						goods.setName(<span class="string">"烤羊排"</span>);</span><br><span class="line">						goods.setPrice(<span class="number">138</span>);</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 修改标记</span></span><br><span class="line">					goods.setProduct(<span class="keyword">false</span>);</span><br><span class="line">					System.out.println(<span class="string">"生产者生产了"</span> + goods.getName() + <span class="string">":"</span> + goods.getPrice());</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 唤醒消费者</span></span><br><span class="line">					System.out.println(<span class="string">"唤醒消费者"</span>);</span><br><span class="line">					goods.notify();</span><br><span class="line"></span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					System.out.println(<span class="string">"生产者进入无限等待状态"</span>);</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						goods.wait();</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%8C%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%EF%BC%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%92%8CLambda%E8%A1%A8%E8%BE%BE%E5%BC%8F.jpg" alt="多线程，线程通信，线程池和Lambda表达式"></p>
<h3 id="八、线程池"><a href="#八、线程池" class="headerlink" title="八、线程池"></a>八、线程池</h3><h4 id="1-线程池简介"><a href="#1-线程池简介" class="headerlink" title="1. 线程池简介"></a>1. 线程池简介</h4><p>线程池可以看做是<strong>线程的集合</strong>。在没有任务时线程处于空闲状态，当请求到来：线程池给这个请求分配一个空闲的线程，任务完成后回到线程池中等待下次任务<strong>(而不是销毁)</strong>。这样就<strong>实现了线程的重用</strong>。</p>
<p><strong>如果没有使用线程池</strong>的情况是这样的：<strong>为每个请求都新开一个线程</strong>！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">不管是继承Thread还是遵从Runnable接口，都需要重写Run方法，而且每一个线程对象有且只能执行一次，之后就会被销毁。</span><br><span class="line">	利用Runnable接口来提供执行目标，而借助于Thread执行线程。</span><br><span class="line">	</span><br><span class="line">一个餐厅</span><br><span class="line">	服务人员</span><br><span class="line">	餐厅会按照餐桌比例安排服务员人数。</span><br><span class="line">	每一个服务员我们都可以看做是一个线程对象</span><br><span class="line">	需要告知服务器做什么事情就可以了，相当于告知线程对象执行目标是什么</span><br><span class="line">	当你来餐厅之前，服务员在这里，你走之后，服务员依然在这类。</span><br><span class="line">	</span><br><span class="line">线程池 &#x3D;&#x3D;&gt; 可以容纳多个线程的容器</span><br><span class="line">	程序可以从线程池获取线程来完成目标代码</span><br><span class="line">	同时也可以将线程归还给线程池。</span><br><span class="line">	省去了【创建线程】和【销毁线程】这样非常繁琐的操作。</span><br></pre></td></tr></table></figure>

<img src="https://gitee.com/lwclick/blogImg/raw/master/img/线程池任务执行参考图.png" alt="线程池任务执行参考图" style="zoom:50%;" />



<h4 id="2-JDK提供的线程池API"><a href="#2-JDK提供的线程池API" class="headerlink" title="2. JDK提供的线程池API"></a>2. JDK提供的线程池API</h4><p>JDK给我们提供了<strong>Excutor框架</strong>来使用线程池，它是<strong>线程池的基础</strong>。</p>
<ul>
<li>Executor提供了一种将<strong>“任务提交”与“任务执行”</strong>分离开来的机制(解耦)</li>
</ul>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200422104503.png" alt="TIM截图20200422104503" style="zoom:80%;" />

<p><strong>JDK1.7新增</strong>的线程池：ForkJoinPool线程池</p>
<p>与其它类型的ExecutorService相比，<strong>其主要的不同在于采用了工作窃取算法(work-stealing)</strong>：所有池中线程会尝试找到并执行已被提交到池中的或由其他线程创建的任务。</p>
<h5 id="2-1-补充Callable和Future"><a href="#2-1-补充Callable和Future" class="headerlink" title="2.1 补充Callable和Future"></a>2.1 补充Callable和Future</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;?&gt; submit(Runnable task)</span><br><span class="line">&lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Callable&lt;T&gt; task)</span></span></span><br></pre></td></tr></table></figure>

<p><strong>Callable就是Runnable的扩展</strong>。</p>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200422104848.png" alt="TIM截图20200422104848"></p>
<p>也就是说：当我们的<strong>任务需要返回值</strong>的时，我们就可以使用Callable！</p>
<p><strong>Future一般我们认为是Callable的返回值</strong>，但他其实代表的是<strong>任务的生命周期</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程池对象</span></span><br><span class="line">    ExecutorService pool = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以执行Runnable对象或者Callable对象代表的线程</span></span><br><span class="line">    Future&lt;Integer&gt; f1 = pool.submit(<span class="keyword">new</span> MyCallable(<span class="number">100</span>));</span><br><span class="line">    Future&lt;Integer&gt; f2 = pool.submit(<span class="keyword">new</span> MyCallable(<span class="number">200</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// V get()</span></span><br><span class="line">    Integer i1 = f1.get();</span><br><span class="line">    Integer i2 = f2.get();</span><br><span class="line"></span><br><span class="line">    System.out.println(i1);</span><br><span class="line">    System.out.println(i2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结束</span></span><br><span class="line">    pool.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Callable任务：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyCallable</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.number = number;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">1</span>; x &lt;= number; x++) &#123;</span><br><span class="line">      sum += x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行完任务之后可以<strong>获取得到任务返回的数据</strong>：</p>
<h4 id="3-线程池使用"><a href="#3-线程池使用" class="headerlink" title="3. 线程池使用"></a>3. 线程池使用</h4><h5 id="3-1-方法"><a href="#3-1-方法" class="headerlink" title="3.1 方法"></a>3.1 方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static ExecutorService newFixedThreadPool(int nThreads);</span><br><span class="line"> 	得到一个线程对象，初始化参数是要求的当前线程池中的线程数</span><br><span class="line"> </span><br><span class="line"> public Future submit(Runnable target);</span><br><span class="line"> 	从线程池中获取一个线程对象，并且执行给定的Runnable接口实现类对象作为执行目标</span><br></pre></td></tr></table></figure>

<h5 id="3-2-常规使用方法"><a href="#3-2-常规使用方法" class="headerlink" title="3.2 常规使用方法"></a>3.2 <strong>常规使用方法</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread1</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Runnable接口实现类，线程目标代码"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println(Thread.currentThread().getName() + <span class="string">" 明天吃土豆牛腩"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 1. 创建线程池对象</span></span><br><span class="line">		ExecutorService service = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 2. 创建一个MyThread1 Runnable接口实现类对象、</span></span><br><span class="line">		MyThread1 target = <span class="keyword">new</span> MyThread1();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 3. 使用线程池对象中的一个线程，指定目标代码</span></span><br><span class="line">		<span class="comment">// 【初始化线程数为5】，这里使用的是线程池中已经存在的5个线程来执行代码，同时执行</span></span><br><span class="line">		service.submit(target);</span><br><span class="line">		service.submit(target);</span><br><span class="line">		service.submit(target);</span><br><span class="line">		service.submit(target);</span><br><span class="line">		service.submit(target);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 因为原本的5个线程都在被使用中，【这里需要等待5个线程执行完毕，出现空闲线程】</span></span><br><span class="line">		<span class="comment">// 来执行对应的目标代码</span></span><br><span class="line">		service.submit(target);</span><br><span class="line">		service.submit(target);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 4. 关闭线程池</span></span><br><span class="line">		<span class="comment">// 一般不用关闭线程池，会随着程序的退出而关闭</span></span><br><span class="line">		<span class="comment">// service.shutdown();</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="3-3-lambda表达式使用"><a href="#3-3-lambda表达式使用" class="headerlink" title="3.3 lambda表达式使用"></a>3.3 lambda表达式使用</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ExecutorService service = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        【常规写法】</span><br><span class="line">		service.submit(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;); </span><br><span class="line">			</span><br><span class="line">		<span class="comment">// lambda表达式</span></span><br><span class="line">		service.submit(() -&gt; </span><br><span class="line">			&#123;</span><br><span class="line">				System.out.println(Thread.currentThread().getName());</span><br><span class="line">			&#125;); </span><br><span class="line">		service.submit(() -&gt; System.out.println(Thread.currentThread().getName())); </span><br><span class="line">		service.submit(() -&gt; System.out.println(Thread.currentThread().getName())); </span><br><span class="line">		service.submit(() -&gt; System.out.println(Thread.currentThread().getName())); 	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="九、死锁"><a href="#九、死锁" class="headerlink" title="九、死锁"></a>九、死锁</h3><p>造成死锁的原因可以<strong>概括</strong>成三句话：</p>
<ul>
<li>当前线程<strong>拥有其他线程需要的</strong>资源</li>
<li>当前线程<strong>等待其他线程已拥有</strong>的资源</li>
<li><strong>都不放弃</strong>自己拥有的资源</li>
</ul>
<p>避免死锁可以概括成三种方法：</p>
<ul>
<li><strong>固定加锁的顺序</strong>(针对锁顺序死锁)</li>
<li><strong>开放调用</strong>(针对对象之间协作造成的死锁)</li>
<li><strong>使用定时锁</strong>–&gt;<code>tryLock()</code><ul>
<li>如果等待获取锁时间超时，则<strong>抛出异常而不是一直等待</strong>！</li>
</ul>
</li>
</ul>
<p>发生死锁的原因主要由于：</p>
<ul>
<li>线程之间交错执行<ul>
<li>解决：<strong>以固定的顺序加锁</strong></li>
</ul>
</li>
<li>执行某方法时就需要持有锁，且不释放<ul>
<li>解决：<strong>缩减同步代码块范围，最好仅操作共享变量时才加锁</strong></li>
</ul>
</li>
<li>永久等待<ul>
<li>解决：使用<code>tryLock()</code>定时锁，超过时限则返回错误信息</li>
</ul>
</li>
</ul>
<h3 id="十、线程常用的工具类"><a href="#十、线程常用的工具类" class="headerlink" title="十、线程常用的工具类"></a>十、线程常用的工具类</h3><p><strong>三个同步工具类</strong>：</p>
<ul>
<li>CountDownLatch(闭锁)<ul>
<li>CountDownLatch是一个同步的辅助类，<strong>允许一个或多个线程一直等待</strong>，<strong>直到</strong>其它线程<strong>完成</strong>它们的操作。</li>
</ul>
</li>
<li>CyclicBarrier(栅栏)<ul>
<li>CyclicBarrier允许一组线程互相等待，直到<strong>到达某个公共屏障点</strong>。叫做cyclic是因为当所有等待线程都被释放以后，CyclicBarrier可以<strong>被重用</strong>(对比于CountDownLatch是不能重用的)</li>
</ul>
</li>
<li>Semaphore(信号量)<ul>
<li>可以控制<strong>同时访问的线程个数</strong>，它维护了一组<strong>“许可证”</strong></li>
</ul>
</li>
</ul>
<h3 id="十一、Atomic"><a href="#十一、Atomic" class="headerlink" title="十一、Atomic"></a>十一、Atomic</h3><h4 id="1-CAS"><a href="#1-CAS" class="headerlink" title="1. CAS"></a>1. CAS</h4><p><strong>原子性的</strong></p>
<p>有3个操作数：</p>
<ul>
<li>内存值V</li>
<li>旧的预期值A</li>
<li>要修改的新值B</li>
</ul>
<p>当多个线程尝试使用CAS同时更新同一个变量时，<strong>只有其中一个线程能更新变量的值</strong>(A和内存值V相同时，将内存值V修改为B)，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，<strong>并可以再次尝试（重试/自旋）或者什么都不做</strong>。</p>
<h4 id="2-原子变量类"><a href="#2-原子变量类" class="headerlink" title="2. 原子变量类"></a>2. 原子变量类</h4><ul>
<li>基本类型：<ul>
<li>AtomicBoolean：布尔型</li>
<li>AtomicInteger：整型</li>
<li>AtomicLong：长整型</li>
</ul>
</li>
<li>数组：<ul>
<li>AtomicIntegerArray：数组里的整型</li>
<li>AtomicLongArray：数组里的长整型</li>
<li>AtomicReferenceArray：数组里的引用类型</li>
</ul>
</li>
<li>引用类型：<ul>
<li>AtomicReference：引用类型</li>
<li>AtomicStampedReference：带有版本号的引用类型</li>
<li>AtomicMarkableReference：带有标记位的引用类型</li>
</ul>
</li>
<li>对象的属性：<ul>
<li>AtomicIntegerFieldUpdater：对象的属性是整型</li>
<li>AtomicLongFieldUpdater：对象的属性是长整型</li>
<li>AtomicReferenceFieldUpdater：对象的属性是引用类型</li>
</ul>
</li>
<li>JDK8新增DoubleAccumulator、LongAccumulator、DoubleAdder、LongAdder<ul>
<li>是对AtomicLong等类的改进。比如LongAccumulator与LongAdder在高并发环境下比AtomicLong更高效。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="十二、ThreadLocal"><a href="#十二、ThreadLocal" class="headerlink" title="十二、ThreadLocal"></a>十二、ThreadLocal</h3><p><strong>ThreadLocal可以让我们拥有当前线程的变量</strong></p>
<p>ThreadLocal提供了线程的局部变量，每个线程都可以通过<code>set()</code>和<code>get()</code>来对这个局部变量进行操作，但不会和其他线程的局部变量进行冲突，<strong>实现了线程的数据隔离</strong>。</p>
<ul>
<li><p>可以用来管理Connection</p>
<p><strong>管理数据库的Connection</strong>，实现<strong>当前线程的操作都是用同一个Connection，保证了事务</strong></p>
</li>
<li><p><strong>避免一些参数的传递</strong></p>
<p>可以参考一下Cookie和Session</p>
<ul>
<li>每当我访问一个页面的时候，浏览器都会帮我们从硬盘中找到对应的Cookie发送过去。</li>
<li>浏览器是十分聪明的，不会发送别的网站的Cookie过去，只带当前网站发布过来的Cookie过去</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. 每个Thread维护着一个ThreadLocalMap的引用</span><br><span class="line"></span><br><span class="line">2. ThreadLocalMap是ThreadLocal的内部类，用Entry来进行存储</span><br><span class="line"></span><br><span class="line">3. 调用ThreadLocal的set()方法时，实际上就是往ThreadLocalMap设置值，key是ThreadLocal对象，值是传递进来的对象</span><br><span class="line"></span><br><span class="line">4. 调用ThreadLocal的get()方法时，实际上就是往ThreadLocalMap获取值，key是ThreadLocal对象</span><br><span class="line"></span><br><span class="line">5. ThreadLocal本身并不存储值，它只是作为一个key来让线程从ThreadLocalMap获取value。</span><br></pre></td></tr></table></figure>

<ul>
<li>避免内存泄露</li>
</ul>
<p><strong>ThreadLocal设计的目的就是为了能够在当前线程中有属于自己的变量，并不是为了解决并发或者共享变量的问题</strong></p>
<hr>
<h3 id="十三、面试题"><a href="#十三、面试题" class="headerlink" title="十三、面试题"></a>十三、面试题</h3><ul>
<li><p>悲观锁</p>
<ul>
<li>共享资源每次只给一个线程使用，其他线程阻塞，用完后再把资源让给其他线程</li>
</ul>
</li>
<li><p>乐观锁</p>
<ul>
<li>加上版本号，更新数据的时候根据版本号判断数据有没有被修改</li>
<li>适用于多读的应用类型，提高吞吐量</li>
</ul>
</li>
<li><p>synchronized和volatile的区别</p>
<ul>
<li>volatile<ul>
<li>解决变量在多个线程之间的可见性</li>
<li>只能修饰变量</li>
<li>线程同步的轻量级实现，性能更好</li>
<li>多线程访问volatile不会发生阻塞</li>
</ul>
</li>
<li>synchronized<ul>
<li>解决多个线程之间访问共享资源的同步性</li>
<li>修饰方法以及代码块</li>
<li>多线程访问synchronized可能会发生阻塞</li>
</ul>
</li>
</ul>
</li>
<li><p>synchronized和lock的区别</p>
<ul>
<li>lock<ul>
<li>是一个接口</li>
<li>发生异常时，如果没有主动通过unlocak()释放锁，可能会发生死锁</li>
<li>因此，需要在finally快中释放锁</li>
<li>可以让等待锁的线程响应中断</li>
<li>可以知道有没有成功获取锁</li>
<li>在竞争激烈的时候，lock性能远远优于synchronized</li>
</ul>
</li>
<li>synchronized<ul>
<li>是java中的关键字</li>
<li>synchronized是内置的语言实现</li>
<li>在发生异常时，自动释放占有的锁</li>
<li>等待线程会一直等待下去</li>
<li>不可以知道有没有成功获取锁</li>
</ul>
</li>
</ul>
</li>
<li><p>可重入锁与非可重入锁</p>
<ul>
<li>可重入锁（sychronized）<ul>
<li>可重复可递归调用的锁</li>
<li>在外层使用锁后，在内层仍然可以使用</li>
</ul>
</li>
<li>非可重入锁<ul>
<li>递归调用发生死锁</li>
</ul>
</li>
</ul>
</li>
<li><p>多线程</p>
<ul>
<li>优点<ul>
<li>把占据时间长的任务放到后台处理</li>
<li>程序运行效率可能会提高</li>
<li>提高用户体验</li>
</ul>
</li>
<li>缺点<ul>
<li>如果有大量线程，会影响性能，因为操作系统需要在它们之间切换</li>
<li>需要更大的内存空间</li>
<li>线程终止需要考虑对程序运行的影响</li>
<li>需要防止线程死锁情况</li>
</ul>
</li>
</ul>
</li>
<li><p>进程与线程</p>
<ul>
<li>进程<ul>
<li>静态的概念，在机器上实际运行的都是线程</li>
</ul>
</li>
<li>线程<ul>
<li>一个进程里面不同的执行路径</li>
</ul>
</li>
</ul>
</li>
<li><p>线程池</p>
</li>
<li><p>保存了一定数量线程的空间，系统提前申请好空间个资源，在线程池销毁之前一直等待被调用</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/String/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/String/" itemprop="url">String</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:59:33+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/String/" class="leancloud_visitors" data-flag-title="String">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="String类"><a href="#String类" class="headerlink" title="String类"></a>String类</h2><h4 id="1-获取方法"><a href="#1-获取方法" class="headerlink" title="1. 获取方法"></a>1. 获取方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">int length();</span><br><span class="line">	获取字符串长度 &quot;&quot;</span><br><span class="line"></span><br><span class="line">char charAt(int index);</span><br><span class="line">	获取String字符串中指定下标位置的char类型字符，如果index超出有效范围</span><br><span class="line">		StringIndexOutOfBoundsException</span><br><span class="line"></span><br><span class="line">int indexOf(char ch);</span><br><span class="line">int indexOf(String str);</span><br><span class="line">int indexOf(char ch, int fromIndex);</span><br><span class="line">int indexOf(String str, int fromIndex);</span><br><span class="line">	获取指定元素所在的下标位置，元素可以是char类型，也可以是字符串。</span><br><span class="line">	这里找出的是指定元素在字符串中【第一次出现】的位置</span><br><span class="line">	可以通过一定的约束，从哪个位置开始找fromIndex</span><br><span class="line">	</span><br><span class="line">int lastIndexOf(char ch);</span><br><span class="line">int lastIndexOf(String str);</span><br><span class="line">int lastIndexOf(char ch, int fromIndex);</span><br><span class="line">int lastIndexOf(String str, int fromIndex);</span><br><span class="line">	获取指定元素所在的下标位置，元素可以是char类型，也可以是字符串。</span><br><span class="line">	这里找出的是指定元素在字符串中【最后一次出现】的位置</span><br><span class="line">	可以通过一定的约束，从哪个位置开始找fromIndex</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/05/15/String/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/springBoot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/springBoot/" itemprop="url">Springboot</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:59:20+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/springBoot/" class="leancloud_visitors" data-flag-title="Springboot">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.7k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SpringBoot简介"><a href="#SpringBoot简介" class="headerlink" title="SpringBoot简介"></a>SpringBoot简介</h2><h3 id="1-spring的优缺点"><a href="#1-spring的优缺点" class="headerlink" title="1. spring的优缺点"></a>1. spring的优缺点</h3><h4 id="1-1-优点"><a href="#1-1-优点" class="headerlink" title="1.1 优点"></a>1.1 优点</h4><p>spring是JEE的轻量级代替品。无需开发重量级的Enterprise JavaBean(EJB)，通过IOC和AOP用简单的<strong>java对象(POJO)</strong>实现EJB的功能</p>
<h4 id="1-2-缺点"><a href="#1-2-缺点" class="headerlink" title="1.2 缺点"></a>1.2 缺点</h4><ul>
<li><p>组件代码轻量，配置是重量级的。spring2.5注解+XML，spring3.0纯注解。</p>
</li>
<li><p>配置有时耗，业务逻辑的代码和spring的配置之间需要切换思维。</p>
</li>
<li><p>项目的依赖管理也是问题。</p>
</li>
</ul>
<h3 id="2-Springboot概述"><a href="#2-Springboot概述" class="headerlink" title="2. Springboot概述"></a>2. Springboot概述</h3><h4 id="2-1-解决spring的缺点"><a href="#2-1-解决spring的缺点" class="headerlink" title="2.1 解决spring的缺点"></a>2.1 解决spring的缺点</h4><h4 id="2-2-Springboot的特点"><a href="#2-2-Springboot的特点" class="headerlink" title="2.2 Springboot的特点"></a>2.2 Springboot的特点</h4><ul>
<li>开箱即用，没有代码生成，也无需XML配置，也可以自定义</li>
<li>springboot不是对spring功能上的增强，而是提供了<strong>一种快速使用spring的方式</strong></li>
<li>提供了大型项目的非功能型特性，嵌入式服务器、安全、健康监测</li>
</ul>
<h4 id="2-3-spring的核心功能"><a href="#2-3-spring的核心功能" class="headerlink" title="2.3 spring的核心功能"></a>2.3 spring的核心功能</h4><ul>
<li>起步依赖：<strong>就是将具备某种功能的坐标打包到一起，并提供一些默认的功能</strong><ul>
<li>本质上是一个maven项目对象模型（POM），定义了对其他库的传递依赖</li>
</ul>
</li>
<li>自动配置：<ul>
<li>是一个运行时的过程， 考虑了众多因素，才决定spring的配置应该用哪个，该过程是spring自动完成的</li>
<li>例如自动注入DataSource</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Springboot入门"><a href="#Springboot入门" class="headerlink" title="Springboot入门"></a>Springboot入门</h2><h3 id="1-步骤"><a href="#1-步骤" class="headerlink" title="1. 步骤"></a>1. 步骤</h3><ol>
<li><p>创建maven工程，不需要骨架</p>
</li>
<li><p>添加Springboot的起步依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Springboot继承springmvc进行controller开发，要导入web的启动依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加Springboot引导类（放到com.lwclick包下）</p>
<p>通过Springboot提供的引导类<strong>起步Springboot</strong>才可以进行访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lwclick;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySpringBootApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MySpringBootApplication<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行main方法</strong></p>
</li>
<li><p>创建controller类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lwclick.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/quick"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">quick</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello~"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h3 id="2-入门分析"><a href="#2-入门分析" class="headerlink" title="2. 入门分析"></a>2. 入门分析</h3><ol>
<li>所有springboot工程都必须继承 spring-boot-starter-parent</li>
<li><code>@SpringBootApplication</code> 声明该类是一个springboot引导类</li>
<li><code>run方法</code>运行springboot的引导类，参数就是springboot引导类的 字节码</li>
</ol>
<h3 id="3-springboot工程的热部署"><a href="#3-springboot工程的热部署" class="headerlink" title="3. springboot工程的热部署"></a>3. springboot工程的热部署</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>修改IDEA的自动编译</strong></p>
<p><code>Settings --&gt; Compiler --&gt; Build project automatically --&gt; 在pom.xml里按shift + ctrl + alt + /  --&gt; 选择registry --&gt; 勾选compiler.automake.allow...running</code></p>
<h3 id="4-使用IDEA快速创建Springboot"><a href="#4-使用IDEA快速创建Springboot" class="headerlink" title="4. 使用IDEA快速创建Springboot"></a>4. 使用IDEA快速创建Springboot</h3><p>创建项目时选择 <strong>Spring Initializr</strong> –&gt; 起名 –&gt; <strong>勾选</strong>自己要使用的组件的坐标</p>
<hr>
<h2 id="Springboot原理分析"><a href="#Springboot原理分析" class="headerlink" title="Springboot原理分析"></a>Springboot原理分析</h2><h3 id="1-起步依赖–parent"><a href="#1-起步依赖–parent" class="headerlink" title="1. 起步依赖–parent"></a>1. 起步依赖–parent</h3><p>maven的版本控制</p>
<h3 id="2-起步依赖–web"><a href="#2-起步依赖–web" class="headerlink" title="2. 起步依赖–web"></a>2. 起步依赖–web</h3><p>tomcat， json， spring-web， spring-webmvc</p>
<h3 id="3-自动配置"><a href="#3-自动配置" class="headerlink" title="3. 自动配置"></a>3. 自动配置</h3><p>进行一些默认的配置</p>
<ul>
<li>SpringbootApplication<ul>
<li>相当于configration</li>
<li>相当于enableAutoConfiguration：import注解，自动导入选择器，底层自动进行配置</li>
<li>相当于ComponentScan：<strong>所在的包及子包都会被扫描</strong>。</li>
</ul>
</li>
</ul>
<p>可以通过application.properties配置文件修改</p>
<hr>
<h2 id="springboot的配置文件"><a href="#springboot的配置文件" class="headerlink" title="springboot的配置文件"></a>springboot的配置文件</h2><h3 id="1-配置文件类型"><a href="#1-配置文件类型" class="headerlink" title="1. 配置文件类型"></a>1. 配置文件类型</h3><p>一种properties，一种yml(yaml)，properties的优先级高</p>
<p>数据库的配置信息，覆盖默认的配置信息。  <strong>application.propertyis</strong></p>
<h3 id="2-application-yml配置文件"><a href="#2-application-yml配置文件" class="headerlink" title="2. application.yml配置文件"></a>2. application.yml配置文件</h3><p>YAML（YAML Aint Markup Language）编写的文件格式。比xml更加简洁</p>
<h4 id="2-1-语法格式"><a href="#2-1-语法格式" class="headerlink" title="2.1 语法格式"></a>2.1 语法格式</h4><ul>
<li><p>普通数据（<strong>冒号</strong> 后边要加 <strong>空格</strong>）</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">lw</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对象的配置（<strong>换行</strong>加空格）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">lw</span></span><br><span class="line"> <span class="attr">age:</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>集合和数组的配置（换行加 -  空格）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 普通字符串</span></span><br><span class="line"><span class="attr">city:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">beijing</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">shanghai</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">linyi</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 对象数据</span></span><br><span class="line"><span class="attr">person:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lw</span></span><br><span class="line">   <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">click</span></span><br><span class="line">   <span class="attr">age:</span> <span class="number">22</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>map配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">map:</span></span><br><span class="line"> <span class="attr">key1:</span> <span class="string">value1</span></span><br><span class="line"> <span class="attr">key2:</span> <span class="string">value2</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="2-2-在类中获取配置信息"><a href="#2-2-在类中获取配置信息" class="headerlink" title="2.2 在类中获取配置信息"></a>2.2 在类中获取配置信息</h4><ul>
<li>通过使用<strong>@Value</strong>注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;person.age&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/quick"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">quick</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 获得配置文件信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"name:  "</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>使用<strong>ConfigurationProperties</strong>注解</p>
<ul>
<li><p>添加maven坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"person"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 属性根据名字自动注入     【需要getter/setter方法】</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/quick"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">quick</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 获得配置文件信息</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"name:  "</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Springboot整合"><a href="#Springboot整合" class="headerlink" title="Springboot整合"></a>Springboot整合</h2><h3 id="1-整合mybatis"><a href="#1-整合mybatis" class="headerlink" title="1. 整合mybatis"></a>1. 整合mybatis</h3><p>创建springboot项目</p>
<h4 id="1-1-添加mybatis起步依赖"><a href="#1-1-添加mybatis起步依赖" class="headerlink" title="1.1 添加mybatis起步依赖"></a>1.1 添加mybatis起步依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-2-添加数据库驱动坐标"><a href="#1-2-添加数据库驱动坐标" class="headerlink" title="1.2 添加数据库驱动坐标"></a>1.2 添加数据库驱动坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-3-添加数据库连接信息（application-properties）"><a href="#1-3-添加数据库连接信息（application-properties）" class="headerlink" title="1.3 添加数据库连接信息（application.properties）"></a>1.3 添加数据库连接信息（application.properties）</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数据库连接信息</span></span><br><span class="line"><span class="meta">spring.datasource.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>



<h4 id="1-4-创建数据表、实体类、dao接口-Mapper，-Repository-、接口中的方法-添加注解"><a href="#1-4-创建数据表、实体类、dao接口-Mapper，-Repository-、接口中的方法-添加注解" class="headerlink" title="1.4 创建数据表、实体类、dao接口(@Mapper，@Repository)、接口中的方法(添加注解)"></a>1.4 创建数据表、实体类、dao接口(@Mapper，@Repository)、接口中的方法(添加注解)</h4><h4 id="1-5-在application-properties中添加mybatis的信息"><a href="#1-5-在application-properties中添加mybatis的信息" class="headerlink" title="1.5 在application.properties中添加mybatis的信息"></a>1.5 在application.properties中添加mybatis的信息</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#spring集成mybatis环境</span></span><br><span class="line"><span class="comment">#pojo别名扫描包</span></span><br><span class="line"><span class="meta">mybatis.type-aliases-package</span>=<span class="string">com.lwclick.domain</span></span><br></pre></td></tr></table></figure>



<h4 id="1-6-编写controller"><a href="#1-6-编写controller" class="headerlink" title="1.6 编写controller"></a>1.6 编写controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserDao iUserDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/findAllUser"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findAllUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;User&gt; users = iUserDao.findAll();</span><br><span class="line">        <span class="keyword">for</span>(User u : users)&#123;</span><br><span class="line">            System.out.println(u);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-整合Junit"><a href="#2-整合Junit" class="headerlink" title="2. 整合Junit"></a>2. 整合Junit</h3><p>在测试类中编写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= DemoSpringbootMybatisApplication<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MybatisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserDao iUserDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        iUserDao.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-整合SpringDataJPA"><a href="#3-整合SpringDataJPA" class="headerlink" title="3. 整合SpringDataJPA"></a>3. 整合SpringDataJPA</h3><h4 id="3-1-添加起步依赖"><a href="#3-1-添加起步依赖" class="headerlink" title="3.1 添加起步依赖"></a>3.1 添加起步依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="3-2-导入数据库驱动"><a href="#3-2-导入数据库驱动" class="headerlink" title="3.2 导入数据库驱动"></a>3.2 导入数据库驱动</h4><h4 id="3-3-在application-properties中配置数据库和jpa的相关属性"><a href="#3-3-在application-properties中配置数据库和jpa的相关属性" class="headerlink" title="3.3 在application.properties中配置数据库和jpa的相关属性"></a>3.3 在application.properties中配置数据库和jpa的相关属性</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JPA配置</span></span><br><span class="line"><span class="meta">spring.jpa.database</span>=<span class="string">MySQL</span></span><br><span class="line"><span class="meta">spring.jpa.show-sql</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.jpa.generate-ddl</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.jpa.mybatis....</span></span><br></pre></td></tr></table></figure>



<h4 id="3-4-创建实体类"><a href="#3-4-创建实体类" class="headerlink" title="3.4 创建实体类"></a>3.4 创建实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    id, name ....</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-5-创建持久层接口"><a href="#3-5-创建持久层接口" class="headerlink" title="3.5 创建持久层接口"></a>3.5 创建持久层接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Long</span>&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询方法</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JpaRepository&lt;User, Long&gt;</span></span><br><span class="line"><span class="comment">// 实体类的类型，Id的类型</span></span><br></pre></td></tr></table></figure>



<h3 id="4-整合Redis"><a href="#4-整合Redis" class="headerlink" title="4. 整合Redis"></a>4. 整合Redis</h3><h4 id="4-1-起步依赖"><a href="#4-1-起步依赖" class="headerlink" title="4.1 起步依赖"></a>4.1 起步依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="4-2-配置redis的连接信息application-properties"><a href="#4-2-配置redis的连接信息application-properties" class="headerlink" title="4.2 配置redis的连接信息application.properties"></a>4.2 配置redis的连接信息application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">127.0.01</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br></pre></td></tr></table></figure>



<h4 id="4-3-注入redisTemplate测试"><a href="#4-3-注入redisTemplate测试" class="headerlink" title="4.3 注入redisTemplate测试"></a>4.3 注入redisTemplate测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTem;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IUserDao iUserDao;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//1. 从redis中获得数据，   json字符串</span></span><br><span class="line">    String userListJson = redisTem.boundValueOps(<span class="string">"user.findAll"</span>).get();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. 判断redis中是否存在数据</span></span><br><span class="line">    <span class="keyword">if</span>(userListJson == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//3. 不存在，从数据库中查询</span></span><br><span class="line">        List&lt;User&gt; all = iUserDao.findAll();</span><br><span class="line">        <span class="comment">//4. 将查询出来的数据存储到redis缓存中</span></span><br><span class="line">        ObjectMapper obj = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        userListJson = obj.writeValueAsString(all);</span><br><span class="line">        redisTem.boundValueOps(<span class="string">"user.findAll"</span>).set(userListJson);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//从redis缓存获取数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4. 存在，处理</span></span><br><span class="line">    sout(userListJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/spring/" itemprop="url">spring</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:59:01+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/spring/" class="leancloud_visitors" data-flag-title="spring">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  29
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="spring入门和IOC介绍"><a href="#spring入门和IOC介绍" class="headerlink" title="spring入门和IOC介绍"></a>spring入门和IOC介绍</h2><h3 id="1-spring介绍"><a href="#1-spring介绍" class="headerlink" title="1. spring介绍"></a>1. spring介绍</h3><ul>
<li>用来<strong>代替更加重量级的企业级java技术</strong></li>
<li>简化java的开发<ul>
<li>基于<strong>POJO轻量级</strong> 和  <strong>最小侵入式开发</strong></li>
<li>通过  <strong>依赖注入</strong>  和  <strong>面向接口</strong>  实现松耦合</li>
<li><strong>基于切面(AOP)</strong>和惯例进行声明式编程</li>
<li>通过切面和模板<strong>减少样板式代码</strong></li>
</ul>
</li>
</ul>
<h4 id="1-1-侵入式概念"><a href="#1-1-侵入式概念" class="headerlink" title="1.1 侵入式概念"></a>1.1 侵入式概念</h4><ul>
<li><strong>侵入式</strong>：对于EJB、Struts2等一些传统的框架，<strong>通常要实现特定的接口</strong>，继承特定的类才能增强功能</li>
</ul>
<p>​            ==》  改变了java类的结构</p>
<p>​                  EJB : Enterprise Java Beans</p>
<ul>
<li><strong>非侵入式</strong>：对于hibernate、spring等框架，<strong>对现有的类结构没有影响</strong>，就能增强javabean的功能</li>
</ul>
<h4 id="1-2-切面编程"><a href="#1-2-切面编程" class="headerlink" title="1.2 切面编程"></a>1.2 切面编程</h4><p>AOP编程，<strong>动态代理</strong>就是⼀种切⾯编程了..</p>
<p>  <strong>在执行某些代码前，执行另外的代码</strong></p>
<h4 id="1-3-IOC控制反转"><a href="#1-3-IOC控制反转" class="headerlink" title="1.3 IOC控制反转"></a>1.3 IOC控制反转</h4><p><strong>对象的创建交给外部容器完成，使实现对象不用在程序中写死，降低程序间的耦合（依赖关系）</strong></p>
<p>依赖注⼊：dependency injection   <strong>DI</strong></p>
<ul>
<li>Spring使⽤依赖注⼊来实现对象之间的依赖关系</li>
<li>在创建完对象之后，<strong>对象的关系处理</strong>就是依赖注⼊</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">资源不由使⽤资源的双⽅管理       【只有在使用资源时，双方才进行交互】</span><br><span class="line">⽽由不使⽤资源的第三⽅管理</span><br><span class="line">优点：</span><br><span class="line">	第⼀，资源集中管理，实现资源的可配置和易管理。</span><br><span class="line">	第⼆，降低了使⽤资源双⽅的依赖程度，也就是我们说的耦合度。</span><br><span class="line">	</span><br><span class="line">支付宝，闲鱼。。。。</span><br></pre></td></tr></table></figure>



<h4 id="1-4-依赖注入"><a href="#1-4-依赖注入" class="headerlink" title="1.4 依赖注入"></a>1.4 依赖注入</h4><p><strong>依赖注入的数据：</strong></p>
<ol>
<li>基本类型和String</li>
<li>其他bean类型（在配置文件中或者注解配置过的bean）</li>
<li>复杂类型/集合类型</li>
</ol>
<p><strong>注入的方式【类中有需要注入的变量】：</strong></p>
<ol>
<li><p>使用构造函数提供【需要有默认构造函数】</p>
<p>   <strong>使用constructor-arg标签在 bean内部配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">标签的属性：</span><br><span class="line">    type：    用于指定要注入的数据的数据类型，给构造函数中相应类型的参数赋值</span><br><span class="line">    index：   给构造函数中第 i（从0开始）个参数赋值</span><br><span class="line">    name：    给构造函数中指定名称的参数赋值             （常用）</span><br><span class="line">    value：   提供基本类型和String类型</span><br><span class="line">    ref：     指定其他的bean类型（自己配置的bean）</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.lwclick.service.impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注入其他bean类型，使用ref属性 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"birthday"</span> <span class="attr">ref</span>=<span class="string">"time"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一个日期对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"time"</span> <span class="attr">class</span>=<span class="string">"java.util.Date"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>使用set方法提供【需要每个属性的setter方法】</p>
<p><strong>bean标签的内部使用property进行配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">标签的属性：</span><br><span class="line">    name：     调用的 set方法 名称（不算set）</span><br><span class="line">    value：    提供基本类型和String类型</span><br><span class="line">    ref：      指定其他的bean类型（自己配置的bean）</span><br><span class="line">			</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService2"</span> <span class="attr">class</span>=<span class="string">"com.lwclick.service.impl.AccountServiceImpl2"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"19"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"birthday"</span> <span class="attr">ref</span>=<span class="string">"time"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一个日期对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"time"</span> <span class="attr">class</span>=<span class="string">"java.util.Date"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>使用注解提供（后面讲解）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>            自动按照类型注入</span><br><span class="line"><span class="meta">@Qualifier</span>(value=<span class="string">""</span>)  按照类型注入的基础上，再根据名称注入   value：指定注入bean的id</span><br><span class="line"><span class="meta">@Resource</span>(name=<span class="string">""</span>)    直接按照bean的id注入    【name】：指定注入bean的id</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>：用于注入基本类型和String类型的数据</span><br><span class="line">		value：指定数据的值，可以使用spEL（spring的EL表达式） $&#123;表达式&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="4">
<li><p>复杂类型【一般使用setter方法注入】</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">复杂类型/集合类型的注入</span><br><span class="line">    list结构：array,list,set</span><br><span class="line">    map结构：map,entry,props,prop</span><br><span class="line">		</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountServices3"</span> <span class="attr">class</span>=<span class="string">"com.lwclick.service.impl.AccountServiceImpl3"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 列表类型（list）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Map类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"testA"</span> <span class="attr">value</span>=<span class="string">"aaa"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"testB"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h3 id="2-spring模块"><a href="#2-spring模块" class="headerlink" title="2. spring模块"></a>2. spring模块</h3><ul>
<li>Spring Core               spring的核⼼功能： <strong>IOC容器</strong>, 解决对象创建及依赖关系</li>
<li>Spring Web               Spring对web模块的⽀持。<ul>
<li>可以与struts整合,让struts的action创建交给spring</li>
<li>spring mvc模式</li>
</ul>
</li>
<li>Spring DAO               Spring 对jdbc操作的⽀持 【JdbcTemplate模板⼯具类】</li>
<li>Spring ORM              spring对orm的⽀持：<ul>
<li>既可以与hibernate整合，【session】</li>
<li>也可以使⽤spring的对hibernate操作的封装</li>
</ul>
</li>
<li>Spring AOP                <strong>切⾯编程</strong></li>
<li>SpringEE                     spring 对javaEE其他模块的⽀持</li>
</ul>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200509202942.png" alt="TIM截图20200509202942" style="zoom:80%;" />

<hr>
<h2 id="IOC入门"><a href="#IOC入门" class="headerlink" title="IOC入门"></a>IOC入门</h2><p>Core模块是：IOC容器，解决对象创建和对象之间的依赖关系。</p>
<h3 id="1-Spring容器对象【IOC容器】"><a href="#1-Spring容器对象【IOC容器】" class="headerlink" title="1. Spring容器对象【IOC容器】"></a>1. Spring容器对象【IOC容器】</h3><ul>
<li><p>Bean⼯⼚，BeanFactory【功能简单】</p>
<p><strong>什么时候用什么时候创建对象。（延迟加载）多例对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载Spring的资源⽂件</span></span><br><span class="line">Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">"bean.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建IOC容器对象 【IOC容器 = ⼯⼚类+applicationContext.xml】</span></span><br><span class="line">BeanFactory beanFactory = <span class="keyword">new</span> XmlBeanFactory(resource);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>应⽤上下⽂，ApplicationContext【功能强⼤，⼀般我们使⽤这个】</p>
<p><strong>只要一读取配置文件，默认情况下就会创建对象（立即加载）单例对象</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 得到IOC容器对象</span></span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">System.out.println(ac);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="2-XML配置IOC"><a href="#2-XML配置IOC" class="headerlink" title="2. XML配置IOC"></a>2. XML配置IOC</h3><ol>
<li><p>导入约束</p>
</li>
<li><p>使用<bean>标签配置IOC</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"从容器中获取对象的标识"</span> <span class="attr">class</span>=<span class="string">"要创建对象的全限定类名"</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在需要创建对象的类中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&gt;获取核心容器对象</span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>&gt;根据id获取Bean对象</span><br><span class="line">IAccountService as = ac.getBean(<span class="string">"上面声明的对象的标识"</span>, IAccountService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>&gt;as即为对象</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="2-1-IOC的3种标签"><a href="#2-1-IOC的3种标签" class="headerlink" title="2.1 IOC的3种标签"></a>2.1 IOC的3种<bean>标签</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.使用 【默认构造函数】 创建（使用bean标签，配上id，class）</span><br><span class="line">	   若类中没有 默认构造函数，则对象创建失败</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.lwclick.service.impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.使用普通工厂中的方法创建对象（使用某个类中的方法创建对象）   jar包中的类的方法</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accSer"</span> <span class="attr">factory-bean</span>=<span class="string">"普通工厂全限定类名"</span> <span class="attr">factory-method</span>=<span class="string">"工厂中创建对象的方法"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.使用工厂中的静态方法创建对象（静态方法创建）       jar包中的类的静态方法</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accSer"</span> <span class="attr">class</span>=<span class="string">"静态工厂全限定类名"</span> <span class="attr">factory-method</span>=<span class="string">"静态方法"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2-2-bean对象的作用范围调整-【scope属性调整】"><a href="#2-2-bean对象的作用范围调整-【scope属性调整】" class="headerlink" title="2.2 bean对象的作用范围调整   【scope属性调整】"></a>2.2 bean对象的作用范围调整   【scope属性调整】</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">singleton：     单例的（默认值）</span><br><span class="line">prototype：     多例的</span><br><span class="line">request：       作用于web应用的请求范围</span><br><span class="line">session：       作用于web应用的会话范围</span><br><span class="line">global-session：作用于 集群环境 的会话范围（全局session），不是集群环境时，就是session</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"对象的标志"</span> <span class="attr">class</span>=<span class="string">"全限定类名"</span>   <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="2-3-bean对象的生命周期"><a href="#2-3-bean对象的生命周期" class="headerlink" title="2.3 bean对象的生命周期"></a>2.3 bean对象的生命周期</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">单例对象（立即加载）</span><br><span class="line">		出生：当容器创建时，对象出生</span><br><span class="line">		活着：容器还在时</span><br><span class="line">		死亡：容器销毁    ac.close()</span><br><span class="line">		</span><br><span class="line">多例对象（延迟加载）</span><br><span class="line">        出生：使用对象时，spring框架创建对象</span><br><span class="line">        活着：对象只要使用过程中就一直活着</span><br><span class="line">        死亡：当对象长时间不用，且没有其他对象引用时，由GC回收</span><br></pre></td></tr></table></figure>



<h3 id="3-注解的类型"><a href="#3-注解的类型" class="headerlink" title="3. 注解的类型"></a>3. 注解的类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&gt; 用于【创建】对象的，在需要  【创建对象的类】 上进行注解</span><br><span class="line">    和在XML配置中编写一个&lt;bean&gt;标签相同</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Component</span>(<span class="string">"id"</span>)：用于把当前类对象存入spring容器中</span><br><span class="line">    			value：用于指定bean的id       不写时，默认为当前类名（首字母小写）</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Controller</span>：用于表现层的</span><br><span class="line">    <span class="meta">@Service</span>：用于业务层的</span><br><span class="line">    <span class="meta">@Repository</span>：用于持久层的</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line"><span class="number">2</span>&gt; 用于注入数据的【给需要用到对象的地方进行赋值】</span><br><span class="line">	和在bean标签中写一个&lt;property&gt;相同</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Autowired</span>：自动按照类型注入</span><br><span class="line">	<span class="meta">@Qualifier</span>(value=<span class="string">""</span>)：按照类型注入的基础上，再根据名称注入（与Autowired结合使用）</span><br><span class="line">				 【value】：指定注入bean的id</span><br><span class="line">	<span class="meta">@Resource</span>(name=<span class="string">""</span>)：直接按照bean的id注入【上面创建时的id】</span><br><span class="line">				 【name】：指定注入bean的id</span><br><span class="line">	<span class="meta">@Value</span>：用于注入基本类型和String类型的数据</span><br><span class="line">				 【value】：指定数据的值，可以使用spEL（spring的EL表达式） $&#123;表达式&#125;</span><br><span class="line">					   </span><br><span class="line">					   </span><br><span class="line"><span class="number">3</span>&gt; 用于改变作用范围的</span><br><span class="line">    与scope属性实现的功能相同</span><br><span class="line">            </span><br><span class="line">    <span class="meta">@Scope</span>：指定bean的作用范围</span><br><span class="line">             value：指定范围的取值（singleton  prototype）</span><br><span class="line">					</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>&gt; 和生命周期相关的（了解）</span><br><span class="line">    与init-method和destroy-method作用一样</span><br><span class="line">           </span><br><span class="line">    <span class="meta">@PreDestroy</span>：指定销毁方法</span><br><span class="line">    <span class="meta">@PostConstruct</span>：指定初始化方法</span><br></pre></td></tr></table></figure>



<h3 id="4-XML结合注解【重点使用】"><a href="#4-XML结合注解【重点使用】" class="headerlink" title="4. XML结合注解【重点使用】"></a>4. XML结合注解【重点使用】</h3><ol>
<li><p>导入注解的约束</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>告知spring创建容器时要扫描的包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.lwclick"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置连接数据库的数据源</p>
</li>
<li><p>使用注解进行配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 放在类上</span></span><br><span class="line">    <span class="meta">@Controller</span>：用于表现层的</span><br><span class="line">    <span class="meta">@Service</span>：用于业务层的</span><br><span class="line">    <span class="meta">@Repository</span>：用于持久层的</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建的对象上面</span></span><br><span class="line">    <span class="meta">@Autowired</span>：自动按照类型注入</span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">""</span>)：直接按照bean的id注入【上面创建时的id】</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">	<span class="comment">// 2.得到业务层对象</span></span><br><span class="line">IAccountService as = ac.getBean(<span class="string">"accSer"</span>, IAccountService<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><h3 id="1-动态代理"><a href="#1-动态代理" class="headerlink" title="1. 动态代理"></a>1. 动态代理</h3><p><strong>【字节码随用随创建，随用随加载】【在不修改源码的基础上，对已有方法进行增强】</strong></p>
<p>由于<strong>静态代理</strong>需要实现<strong>目标对象的相同接口</strong>，那么可能会导致代理类会⾮常⾮常多….不好维护 –&gt; 动态代理</p>
<p>动态代理：⽬标对象⼀定是要有接⼝的，没有接⼝就不能实现动态代理   –&gt; cglib代理</p>
<h4 id="1-1-基于接口的动态代理"><a href="#1-1-基于接口的动态代理" class="headerlink" title="1.1 基于接口的动态代理"></a>1.1 基于接口的动态代理</h4><ul>
<li>提供者：JDK官方的<strong>Proxy类</strong>。</li>
<li>要求：被代理类<strong>最少实现一个接口</strong>。</li>
<li>创建代理对象：<ul>
<li>Proxy类中的<strong>newProxyInstance</strong>方法</li>
</ul>
</li>
<li>newProxyInstance方法的参数：<ul>
<li>Classloader：用于加载 代理对象 字节码。和被代理对象使用相同的类加载器（代理谁，就写它）</li>
<li>Class[]：用于让代理对象和被代理对象有相同的方法（代理谁就写谁的getInterfaces)</li>
<li>InvocationHandler：用于提供增强的代码，即如何代理，  写InvocationHandler的匿名内部实现类</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">【接口】</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IProducer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saleProduct</span><span class="params">(<span class="keyword">float</span> money)</span></span>;     <span class="comment">//销售</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterService</span><span class="params">(<span class="keyword">float</span> money)</span></span>;    <span class="comment">//售后</span></span><br><span class="line">&#125;</span><br><span class="line">		</span><br><span class="line">【实现接口的类，即被代理的类，至少实现一个接口】</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">IProducer</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saleProduct</span><span class="params">(<span class="keyword">float</span> money)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"销售产品，并拿到钱："</span> + money);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterService</span><span class="params">(<span class="keyword">float</span> money)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"提供售后服务，并拿到钱："</span> + money);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">【测试类，实现动态代理】</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Producer producer = <span class="keyword">new</span> Producer();   <span class="comment">//内部类访问时，要求是最终的</span></span><br><span class="line">			</span><br><span class="line">    IProducer iProducer = (IProducer)Proxy.newProxyInstance(</span><br><span class="line">        producer.getClass().getClassLoader(), </span><br><span class="line">        producer.getClass().getInterfaces(),</span><br><span class="line">		<span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">			  * 执行被代理对象的任何接口方法都会经过该方法</span></span><br><span class="line"><span class="comment">			  * <span class="doctag">@param</span> proxy    代理对象的引用</span></span><br><span class="line"><span class="comment">			  * <span class="doctag">@param</span> method   当前执行的方法</span></span><br><span class="line"><span class="comment">			  * <span class="doctag">@param</span> args     当前执行方法所需的参数</span></span><br><span class="line"><span class="comment">			  * <span class="doctag">@return</span>         和被代理对象方法有相同的返回值</span></span><br><span class="line"><span class="comment">			  */</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">				<span class="comment">//提供增强的代码</span></span><br><span class="line">				Object returnValue = <span class="keyword">null</span>;</span><br><span class="line">				</span><br><span class="line">                <span class="comment">// 1.获取方法执行的参数</span></span><br><span class="line">				Float money = (Float)args[<span class="number">0</span>];</span><br><span class="line">				</span><br><span class="line">                <span class="comment">// 2.判断当前方法是不是销售</span></span><br><span class="line">				<span class="keyword">if</span> (<span class="string">"saleProduct"</span>.equals(method.getName()))&#123;</span><br><span class="line">					returnValue = method.invoke(producer, money * <span class="number">0.8f</span>);   <span class="comment">//必须写f</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> returnValue;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">			</span><br><span class="line">    </span><br><span class="line">	iProducer.saleProduct(<span class="number">10000f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-2-基于子类的动态代理"><a href="#1-2-基于子类的动态代理" class="headerlink" title="1.2 基于子类的动态代理"></a>1.2 基于子类的动态代理</h4><ul>
<li>提供者：第三方的<strong>CGLib</strong></li>
<li>要求：被代理类<strong>不能是用final修饰的类</strong>（最终类）</li>
<li>创建代理对象：<ul>
<li>使用Enhancer类中的create方法</li>
</ul>
</li>
<li>create方法的参数：<ul>
<li>Class：指定被代理对象的字节码</li>
<li>callback：用于提供增强的代码，即如何代理，<ul>
<li>一般写InvocationHandler的子接口实现类，MethodInterceptor</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">【坐标】</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;cglib&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;cglib&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1_3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">		</span><br><span class="line">    </span><br><span class="line">【普通类，被代理的类，不能用<span class="keyword">final</span>修饰】</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saleProduct</span><span class="params">(<span class="keyword">float</span> money)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"销售产品，并拿到钱："</span> + money);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterService</span><span class="params">(<span class="keyword">float</span> money)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"提供售后服务，并拿到钱："</span> + money);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">【测试类，实现代理】</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">final</span> Producer producer = <span class="keyword">new</span> Producer();   <span class="comment">//内部类访问时，要求是最终的</span></span><br><span class="line">    </span><br><span class="line">	Producer cglibPro = (Producer) Enhancer.create(</span><br><span class="line">        producer.getClass(), </span><br><span class="line">        <span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, </span></span></span><br><span class="line"><span class="function"><span class="params">                                    Method method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    Object[] objects, </span></span></span><br><span class="line"><span class="function"><span class="params">                                    MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">				<span class="comment">/**</span></span><br><span class="line"><span class="comment">				  * 执行被代理对象的任何方法都会经过该方法</span></span><br><span class="line"><span class="comment">				  * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">				  * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">				  * <span class="doctag">@param</span> objects</span></span><br><span class="line"><span class="comment">				  *   以上三个参数和基于接口的动态代理中invoke方法的参数一样</span></span><br><span class="line"><span class="comment">				  * <span class="doctag">@param</span> methodProxy   当前执行方法的代理对象</span></span><br><span class="line"><span class="comment">				  */</span></span><br><span class="line">                </span><br><span class="line">				<span class="comment">//提供增强的代码</span></span><br><span class="line">				Object returnValue = <span class="keyword">null</span>;</span><br><span class="line">                </span><br><span class="line">				<span class="comment">// 1.获取方法执行的参数</span></span><br><span class="line">				Float money = (Float)objects[<span class="number">0</span>];</span><br><span class="line">                </span><br><span class="line">				<span class="comment">// 2.判断当前方法是不是销售</span></span><br><span class="line">				<span class="keyword">if</span> (<span class="string">"saleProduct"</span>.equals(method.getName()))&#123;</span><br><span class="line">					returnValue = method.invoke(producer, money * <span class="number">0.8f</span>);   <span class="comment">//必须写</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> returnValue;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	</span><br><span class="line">    cglibPro.saleProduct(<span class="number">12000f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-AOP编程"><a href="#2-AOP编程" class="headerlink" title="2. AOP编程"></a>2. AOP编程</h3><p>把程序中<strong>重复的代码</strong>(提交事务等)抽取出来，在<strong>需要执行的时候</strong>。</p>
<p>使用 【<strong>动态代理</strong>】的技术，【在不修改源码的基础上，对已有的方法进行增强】</p>
<p>AOP可以实现“<strong>业务代码</strong>”与“<strong>关注点代码</strong>”分离</p>
<ul>
<li>业务代码：保存用户等类似的</li>
<li>关注点代码：重复执行的代码</li>
</ul>
<h3 id="3-AOP相关术语"><a href="#3-AOP相关术语" class="headerlink" title="3. AOP相关术语"></a>3. AOP相关术语</h3><ul>
<li>Joinpoint(<strong>连接点</strong>): <ul>
<li>所谓连接点是指那些被拦截到的点。</li>
<li>在spring中,这些点指的是方法,因为spring只支持方法类型的连接点。 </li>
</ul>
</li>
<li>Pointcut(<strong>切入点</strong>): <ul>
<li>所谓切入点是指我们要对哪些Joinpoint进行拦截的定义。</li>
</ul>
</li>
<li>Advice(<strong>通知/增强</strong>): <ul>
<li>所谓通知是指拦截到Joinpoint之后所要做的事情就是通知。 </li>
<li>通知的类型：前置通知,后置通知,异常通知,最终通知,环绕通知。 </li>
</ul>
</li>
<li>Introduction(<strong>引介</strong>): <ul>
<li>引介是一种特殊的通知在不修改类代码的前提下</li>
<li>Introduction可以在运行期为类动态地添加一些方法或Field。</li>
</ul>
</li>
<li>Target(<strong>目标对象</strong>): <ul>
<li>代理的目标对象。 </li>
</ul>
</li>
<li>Weaving(<strong>织入</strong>): <ul>
<li>是指把增强应用到目标对象来创建新的代理对象的过程。 </li>
<li>spring采用动态代理织入，而AspectJ采用编译期织入和类装载期织入。 </li>
</ul>
</li>
<li>Proxy（<strong>代理</strong>）:<ul>
<li>一个类被AOP织入增强后，就产生一个结果代理类。</li>
</ul>
</li>
<li>Aspect(<strong>切面</strong>): <ul>
<li>是切入点和通知（引介）的结合。</li>
</ul>
</li>
</ul>
<h3 id="4-未使用AOP解决事务管理方法"><a href="#4-未使用AOP解决事务管理方法" class="headerlink" title="4. 未使用AOP解决事务管理方法"></a>4. 未使用AOP解决事务管理方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAccount</span><span class="params">(Account account)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">try</span> &#123; </span><br><span class="line">        TransactionManager.beginTransaction();    <span class="comment">//开启事务</span></span><br><span class="line">        </span><br><span class="line">        accountDao.save(account); </span><br><span class="line">        TransactionManager.commit(); 			  <span class="comment">//提交事务，未发生异常时提交</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">        TransactionManager.rollback();			  <span class="comment">//回滚事务，产生异常时，不提交</span></span><br><span class="line">        e.printStackTrace(); </span><br><span class="line">    &#125;<span class="keyword">finally</span> &#123; </span><br><span class="line">        TransactionManager.release(); 			  <span class="comment">//释放事务</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的事务管理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取连接，用自己定义的工具类，从Connection中获取的，可以使用对应方法  用反射注入</span></span><br><span class="line">    <span class="keyword">private</span> ConnUtils connectionUtils;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConnectionUtils</span><span class="params">(ConnUtils connectionUtils)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connectionUtils = connectionUtils;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	  * 开启事务，即关闭自动提交</span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beginTran</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConn().setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	  * 提交事务</span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConn().commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	  * 回滚事务</span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConn().rollback();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	  * 释放连接</span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConn().close();</span><br><span class="line">            <span class="comment">//close为关闭，还回连接池中，还存在，但是不能用了， 所以应该进行解绑操作</span></span><br><span class="line">            connectionUtils.removeConn();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-使用AOP的配置-–-xml"><a href="#5-使用AOP的配置-–-xml" class="headerlink" title="5. 使用AOP的配置  – xml"></a>5. 使用AOP的配置  – xml</h3><ol>
<li><p>导入坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 解析切入点表达式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入约束</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">				http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">				http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">				http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置IOC，service，dao，数据源等</p>
</li>
<li><p>抽取<strong>公共代码制作成通知类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforePrintLog</span><span class="params">()</span></span>&#123;&#125;【前置通知，开启事务】</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPrintLog</span><span class="params">()</span></span>&#123;&#125; 【后置通知，提交事务】</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowPrintLog</span><span class="params">()</span></span>&#123;&#125;【异常通知，回滚事务】</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finalPrintLog</span><span class="params">()</span></span>&#123;&#125;【最终通知，释放资源】</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">aroundPrintLog</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">        Object rtValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object[] args = pjp.getArgs();  <span class="comment">//得到方法执行所需参数</span></span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">"前置。。。。"</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//明确调用业务层方法</span></span><br><span class="line">            rtValue = pjp.proceed(args);</span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">"后置。。。。"</span>);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            System.out.println(<span class="string">"异常。。。。"</span>);</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"最终。。。。"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rtValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>把通知类的 bean 也交给spring来管理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"loggerConfig"</span> <span class="attr">class</span>=<span class="string">"com.lwclick.utils.Logger"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置AOP</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置切入点表达式，必须在切面配置之前 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pt1"</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">expression</span>=<span class="string">"execution(* com.lwclick.service.impl.*.*(..))"</span>/&gt;</span></span><br><span class="line">		</span><br><span class="line">    <span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"logAdvice"</span> <span class="attr">ref</span>=<span class="string">"loggerConfig"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置通知的类型，并且建立通知方法和切入点方法的关联 </span></span><br><span class="line"><span class="comment">        &lt;aop:before method="beforePrintLog" pointcut="pt1"&gt;&lt;/aop:before&gt;--&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 后置通知   aop:after-returning</span></span><br><span class="line"><span class="comment">        &lt;aop:after-returning method="afterPrintLog" pointcut-ref="pt1"&gt;					&lt;/aop:after-returning&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 异常通知   aop:after-throwing</span></span><br><span class="line"><span class="comment">        &lt;aop:after-throwing method="afterThrowPrintLog" pointcut-ref="pt1"&gt;				&lt;/aop:after-throwing&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 最终通知   aop:after</span></span><br><span class="line"><span class="comment">        &lt;aop:after method="finalPrintLog" pointcut-ref="pt1"&gt;&lt;/aop:after&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置环绕通知，具体看Logger类 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundPrintLog"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="spring的JdbcTemplate"><a href="#spring的JdbcTemplate" class="headerlink" title="spring的JdbcTemplate"></a>spring的JdbcTemplate</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">作用：</span><br><span class="line">	它就是用于和数据库交互的，实现对表的CRUD操作</span><br><span class="line">		</span><br><span class="line">基本使用：</span><br><span class="line">	<span class="number">1</span>.导入坐标</span><br><span class="line">		spring-context, spring-jdbc, spring-tx【事务控制】</span><br><span class="line">		</span><br><span class="line">	<span class="number">2</span>.创建表，创建账户实体类</span><br><span class="line">		</span><br><span class="line">	<span class="number">3</span>.JdbcTem类</span><br><span class="line">		<span class="comment">//  【spring内置数据源】</span></span><br><span class="line">	    DriverManagerDataSource ds = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">        ds.setDriverClassName();</span><br><span class="line">        ds.setUrl();</span><br><span class="line">        JdbcTemplate jt = <span class="keyword">new</span> JdbcTemplate();【创建】</span><br><span class="line">        jt.setDataSource(ds);</span><br><span class="line">        jt.execute(<span class="string">"sql语句"</span>);</span><br><span class="line">		</span><br><span class="line">高级配置：</span><br><span class="line">   <span class="number">1</span>.导入约束</span><br><span class="line">   &lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">   &lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">        xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">        xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span><br><span class="line">   &lt;/beans&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.配置IOC</span><br><span class="line">    &lt;bean id=<span class="string">"jdbcConfig"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span><br><span class="line">    	&lt;property name="dataSource" ref="dataSourceConfig"&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">"dataSourceConfig"</span> </span><br><span class="line">            <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.jdbc.dataSource.DriverManagerDataSource"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"driverClassName"</span> value=<span class="string">""</span>&gt;.......</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.JdbcTem类</span><br><span class="line">    <span class="number">1</span>&gt; 获取容器</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">    <span class="number">2</span>&gt; 获取对象</span><br><span class="line">    JdbcTemplate jt = ac.getBean(<span class="string">"jdbcConfig"</span>, JdbcTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    jt.execute(<span class="string">"sql语句"</span>);</span><br><span class="line"></span><br><span class="line">对象中的常用方法：</span><br><span class="line">    <span class="number">0</span>.前置语句</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">    JdbcTemplate jt = ac.getBean(<span class="string">"jdbcConfig"</span>, JdbcTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="number">1</span>.保存</span><br><span class="line">    jt.update(<span class="string">"insert into account(name,money)values(?,?)"</span>,<span class="string">"fff"</span>,<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="number">2</span>.更新</span><br><span class="line">    jt.update(<span class="string">"update account set money = money=? where id = ?"</span>,<span class="number">300</span>,<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="number">3</span>.删除</span><br><span class="line">    jt.update(<span class="string">"delete from account where id = ?"</span>,<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="number">4</span>.查询所有</span><br><span class="line">    List&lt;Account&gt; accounts = </span><br><span class="line">        jt.query(<span class="string">"select * from account where money &gt; ?"</span>, </span><br><span class="line">                 <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account<span class="class">.<span class="keyword">class</span>), 1000<span class="title">f</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="number">5</span>.查询一个</span><br><span class="line">    List&lt;Account&gt; accounts = </span><br><span class="line">        jt.query(<span class="string">"select * from account where id = ?"</span>, </span><br><span class="line">                 <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account<span class="class">.<span class="keyword">class</span>), 1)</span>;</span><br><span class="line">    sout(accounts.isEmpty()?<span class="string">"没有内容"</span> : accounts.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="number">6</span>.查询返回一行一列（使用聚合函数）</span><br><span class="line">    jt.queryForObject(<span class="string">"select count(*) from account where money &gt; ?"</span>, </span><br><span class="line">                      Long<span class="class">.<span class="keyword">class</span>, 1000<span class="title">f</span>)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在dao中使用JdbcTemplate【XML和注解都可以】</span><br><span class="line">    <span class="number">1</span>.创建实体类</span><br><span class="line"></span><br><span class="line">    <span class="number">2</span>.创建持久层接口，加上方法</span><br><span class="line"></span><br><span class="line">    <span class="number">3</span>.创建持久层接口的实现类，实现方法</span><br><span class="line">        <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line">        setter方法</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountByName</span><span class="params">(String name)</span> </span>&#123; </span><br><span class="line">        List&lt;Account&gt; list = </span><br><span class="line">            jdbc.query(<span class="string">"select * from account where name = ? "</span>,</span><br><span class="line">                       <span class="keyword">new</span> AccountRowMapper(),name); </span><br><span class="line">        <span class="keyword">if</span>(list.isEmpty())&#123; </span><br><span class="line">        	<span class="keyword">return</span> <span class="keyword">null</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span>(list.size()&gt;<span class="number">1</span>)&#123; </span><br><span class="line">        	<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"结果集不唯一，不是只有一个账户对象"</span>); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> list.get(<span class="number">0</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">4</span>.配置IOC，给jdbc注入数据，配置数据源</span><br><span class="line"></span><br><span class="line">    <span class="number">5</span>.测试类</span><br><span class="line">    ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">    IAccountDao accountDao = ac.getBean(<span class="string">"配置的bean的id"</span>);</span><br><span class="line">    accountDao.findAccountByName(<span class="string">"lwclick"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="number">6</span>.解决重复代码的问题</span><br><span class="line">    【重复代码】</span><br><span class="line">        <span class="keyword">private</span> JdbcTemplate jdbc;</span><br><span class="line">        setter方法</span><br><span class="line">    【继承JdbcDaoSupport类， 只能用于基于XML的方式】</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">IAccountDao</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> Account <span class="title">findAccountById</span><span class="params">(Integer id)</span> </span>&#123; </span><br><span class="line">        <span class="comment">//getJdbcTemplate()方法是从父类上继承下来的。 </span></span><br><span class="line">        List&lt;Account&gt; list = </span><br><span class="line">            getJdbcTemplate().query(<span class="string">"select * from account where id = ? "</span>,</span><br><span class="line">                                    <span class="keyword">new</span> AccountRowMapper(),id);</span><br><span class="line">        <span class="keyword">return</span> list.isEmpty()?<span class="keyword">null</span>:list.get(<span class="number">0</span>); </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="声明式事务管理"><a href="#声明式事务管理" class="headerlink" title="声明式事务管理"></a>声明式事务管理</h2><ol>
<li><p>配置数据源dataSource</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceConfig"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.dataSource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>.......</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">【1.配置事务管理器】</span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">【2.配置事务的通知引用事务管理器】</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		事务的配置&lt;tx:advice&gt;标签</span></span><br><span class="line"><span class="comment">			id：给事务通知起一个唯一标识</span></span><br><span class="line"><span class="comment">			transaction-manager：给事务通知提供一个事务管理器引用</span></span><br><span class="line"><span class="comment">	--&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"txManager"</span>&gt;</span> 其内配置事务的属性 		<span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">【3.配置事务的属性】</span><br><span class="line">	<span class="comment">&lt;!-- 在tx:advice标签内部 配置事务的属性</span></span><br><span class="line"><span class="comment">        isolation="DEFAULT"     指定事务的隔离级别，默认DEFAULT（使用数据库的隔离级别）</span></span><br><span class="line"><span class="comment">        propagation="REQUIRED"  指定事务的传播行为，默认REQUIRED（一定有事务，增删改的） </span></span><br><span class="line"><span class="comment">                                                  查询使用SUPPORTS</span></span><br><span class="line"><span class="comment">        read-only=""            指定事务是否只读，只有查询时是true,默认false</span></span><br><span class="line"><span class="comment">        timeout=""              指定事务的超时时间，默认-1，单位 秒</span></span><br><span class="line"><span class="comment">        rollback-for=""         指定一个异常，发生该异常时，回滚   其他不回滚     默认都回滚</span></span><br><span class="line"><span class="comment">        no-rollback-for=""      指定一个异常，发生时不回滚        其他的回滚     默认都回滚</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"txManager"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:method</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 查询专用 ，命名需规范--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">【4.配置AOP切入点表达式，配置切入点表达式和事务通知的对应关系】</span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pt1"</span> </span></span><br><span class="line"><span class="tag">                      <span class="attr">expression</span>=<span class="string">"execution(* com.lwclick.service.impl.*.*(..))"</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 建立切入点表达式和事务通知的对应关系  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="1-什么是spring"><a href="#1-什么是spring" class="headerlink" title="1. 什么是spring"></a>1. 什么是spring</h3><p>Spring 是个java企业级应⽤的开源开发框架。</p>
<p>Spring主要⽤来开发Java应⽤，但是有些扩展是针对构建J2EE平台的web应⽤。</p>
<p>Spring框架⽬标是<strong>简化Java企业级应用开发</strong>，并通过POJO为基础的编程模型促进良好的编程习惯。</p>
<h3 id="2-使⽤Spring框架的好处是什么？"><a href="#2-使⽤Spring框架的好处是什么？" class="headerlink" title="2. 使⽤Spring框架的好处是什么？"></a>2. 使⽤Spring框架的好处是什么？</h3><p>轻量，控制反转，⾯向切⾯的编程(AOP)，容器，MVC框架，事务管理，异常处理</p>
<h3 id="3-Spring由哪些模块组成"><a href="#3-Spring由哪些模块组成" class="headerlink" title="3. Spring由哪些模块组成?"></a>3. Spring由哪些模块组成?</h3><p>Core         AOP           ORM           DAO              Web                 Spring EE</p>
<h3 id="4-BeanFactory-实现举例"><a href="#4-BeanFactory-实现举例" class="headerlink" title="4. BeanFactory 实现举例"></a>4. BeanFactory 实现举例</h3><p>Bean⼯⼚是⼯⼚模式的⼀个实现，提供了控制反转功能，⽤来把应⽤的配置和依赖从正真的应⽤代码中分离。</p>
<p>在spring3.2之前最常⽤的是XmlBeanFactory的，但现在被废弃了，取⽽代之的是：<br><strong>XmlBeanDefinitionReader</strong>和<strong>DefaultListableBeanFactory</strong></p>
<h3 id="5-什么是Spring的依赖注⼊？"><a href="#5-什么是Spring的依赖注⼊？" class="headerlink" title="5. 什么是Spring的依赖注⼊？"></a>5. 什么是Spring的依赖注⼊？</h3><p>是IOC的⼀个⽅⾯</p>
<p>你不⽤创建对象，⽽只需要描述它如何被创建。</p>
<p>你不在代码⾥直接组装你的组件和服务，但是要在配置⽂件⾥描述哪些组件需要哪些服务，</p>
<p>之后⼀个容器（IOC容器）负责把他们组装起来。</p>
<h3 id="6-有哪些不同类型的IOC（依赖注⼊）⽅式？"><a href="#6-有哪些不同类型的IOC（依赖注⼊）⽅式？" class="headerlink" title="6. 有哪些不同类型的IOC（依赖注⼊）⽅式？"></a>6. 有哪些不同类型的IOC（依赖注⼊）⽅式？</h3><ul>
<li>构造器依赖注⼊：构造器依赖注⼊通过容器触发⼀个类的构造器来实现的，该类有⼀系列参数，每个参数代表⼀个对其他类的依赖。</li>
<li>Setter⽅法注⼊：Setter⽅法注⼊是容器通过调⽤⽆参构造器或⽆参static⼯⼚ ⽅法实例化bean之后，调⽤该bean的setter⽅法，即实现了基于setter的依赖注⼊。</li>
<li>⼯⼚注⼊：这个是遗留下来的，很少⽤的了！</li>
</ul>
<p><strong>⽤构造器参数实现强制依赖，setter⽅法实现可选依赖。</strong></p>
<h3 id="7-什么是Spring-beans"><a href="#7-什么是Spring-beans" class="headerlink" title="7. 什么是Spring beans?"></a>7. 什么是Spring beans?</h3><p>形成Spring应⽤的主⼲的java对象。</p>
<p>它们被Spring IOC容器初始化，装配，和管理。</p>
<p>这些beans通过容器中配置的元数据创建。⽐如，以XML⽂件中<bean/> 的形式定义。</p>
<p><strong>给Spring容器提供配置元数据。</strong></p>
<ul>
<li>XML配置⽂件。</li>
<li>基于注解的配置。</li>
<li>基于java的配置。</li>
<li>Groovy DSL配置</li>
</ul>
<h3 id="8-解释Spring框架中bean的⽣命周期"><a href="#8-解释Spring框架中bean的⽣命周期" class="headerlink" title="8. 解释Spring框架中bean的⽣命周期"></a>8. 解释Spring框架中bean的⽣命周期</h3><ul>
<li>Spring容器 从XML ⽂件中读取bean的定义，并实例化bean。</li>
<li>Spring根据bean的定义填充所有的属性。</li>
<li>如果bean实现了BeanNameAware 接⼝，Spring 传递bean 的ID 到 setBeanName⽅法。</li>
<li>如果Bean 实现了 BeanFactoryAware 接⼝， Spring传递beanfactory 给setBeanFactory ⽅法。</li>
<li>如果有任何与bean相关联的BeanPostProcessors，Spring会在postProcesserBeforeInitialization()⽅法内调⽤它们。</li>
<li>如果bean实现IntializingBean了，调⽤它的afterPropertySet⽅法，如果bean声明了初始化⽅法，调⽤此初始化⽅法。</li>
<li>如果有BeanPostProcessors 和bean 关联，这些bean的postProcessAfterInitialization() ⽅法将被调⽤。</li>
<li>如果bean实现了 DisposableBean，它将调⽤destroy()⽅法。</li>
</ul>
<h3 id="9-解释不同⽅式的⾃动装配"><a href="#9-解释不同⽅式的⾃动装配" class="headerlink" title="9. 解释不同⽅式的⾃动装配"></a>9. 解释不同⽅式的⾃动装配</h3><ul>
<li>no：默认的⽅式是不进⾏⾃动装配，通过显式设置ref 属性来进⾏装配。</li>
<li>byName：通过参数名 ⾃动装配，Spring容器在配置⽂件中发现bean的autowire属性被设置成byname，之后容器试图匹配、装配和该bean的属性具有相同名字的bean。</li>
<li>byType:：通过参数类型⾃动装配，Spring容器在配置⽂件中发现bean的autowire属性被设置成byType，之后容器试图匹配、装配和该bean的属性具有相同类型的bean。如果有多个bean符合条件，则抛出错误。</li>
<li>constructor：这个⽅式类似于byType， 但是要提供给构造器参数，如果没有确定的带参数的构造器参数类型，将会抛出异常。</li>
<li>autodetect：⾸先尝试使⽤constructor来⾃动装配，如果⽆法⼯作，则使⽤byType⽅式。</li>
</ul>
<h3 id="10-IOC的优点是什么？"><a href="#10-IOC的优点是什么？" class="headerlink" title="10. IOC的优点是什么？"></a>10. IOC的优点是什么？</h3><p>IOC容器⽀持加载服务时的 <strong>饿汉式初始化</strong> 和 <strong>懒加载</strong>。</p>
<p>最⼩的代价和最⼩的侵⼊性使松散耦合得以实现</p>
<h3 id="11-哪些是重要的bean⽣命周期⽅法？-你能重载它们吗？"><a href="#11-哪些是重要的bean⽣命周期⽅法？-你能重载它们吗？" class="headerlink" title="11. 哪些是重要的bean⽣命周期⽅法？ 你能重载它们吗？"></a>11. 哪些是重要的bean⽣命周期⽅法？ 你能重载它们吗？</h3><p>第⼀个是setup ， 它是在容器加载bean的时候被调⽤。</p>
<p>第⼆个⽅法是 teardown 它是在容器卸载类的时候被调⽤。</p>
<p>bean 标签有两个重要的属性（ init-method 和destroy-method ）。</p>
<p>⽤它们你可以⾃⼰定制初始化和注销⽅法。它们也有相应的注解（ @PostConstruct 和@PreDestroy ）。</p>
<h3 id="12-你对Spring的理解？"><a href="#12-你对Spring的理解？" class="headerlink" title="12. 你对Spring的理解？"></a>12. 你对Spring的理解？</h3><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200510190246.png" alt="TIM截图20200510190246"></p>
<h3 id="13-Spring框架中的单例Beans是线程安全的么？"><a href="#13-Spring框架中的单例Beans是线程安全的么？" class="headerlink" title="13. Spring框架中的单例Beans是线程安全的么？"></a>13. Spring框架中的单例Beans是线程安全的么？</h3><ul>
<li><p>Spring框架并没有对单例bean进⾏任何多线程的封装处理。</p>
</li>
<li><p>关于单例bean的线程安全和并发问题需要开发者⾃⾏去搞定。</p>
</li>
<li><p>但实际上，⼤部分的Spring bean并没有可变的状态(⽐如Serview类和DAO类)，所以在某种程度上说Spring的单例bean是线程安全的。</p>
</li>
<li><p>如果你的bean有多种状态的话（⽐如 View Model 对象），就需要⾃⾏保证线程安全。</p>
<ul>
<li>最浅显的解决办法就是将多态bean的作⽤域由“singleton”变更为“prototype”</li>
</ul>
</li>
</ul>
<h3 id="14-FileSystemResource和ClassPathResource有何区别？"><a href="#14-FileSystemResource和ClassPathResource有何区别？" class="headerlink" title="14. FileSystemResource和ClassPathResource有何区别？"></a>14. FileSystemResource和ClassPathResource有何区别？</h3><p><strong>ClassPathResource</strong>在环境变量中读取配置⽂件，<strong>FileSystemResource</strong>在配置⽂件中读取配置⽂件。</p>
<h3 id="15-AOP总结"><a href="#15-AOP总结" class="headerlink" title="15. AOP总结"></a>15. AOP总结</h3><p>OOP面向对象，允许开发者定义纵向的关系，但并不适用于定义横向的关系，导致<strong>代码重复</strong></p>
<p>静态代理的代表：aspectJ</p>
<ul>
<li>AOP的底层实际上是动态代理，动态代理分成了JDK动态代理和CGLib动态代理。如果被代理对象没有接⼝，那么就使⽤的是CGLIB代理(也可以直接配置使⽤CBLib代理)</li>
<li>如果是单例的话，那我们最好使⽤CGLib代理，因为CGLib代理对象运⾏速度要⽐JDK的代理对象要快</li>
<li>AOP既然是基于动态代理的，那么它只能对⽅法进⾏拦截，它的层⾯上是⽅法级别的</li>
<li>⽆论经典的⽅式、注解⽅式还是XML配置⽅式使⽤Spring AOP的原理都是⼀样的，只不过形式变了⽽已。⼀般我们使⽤注解的⽅式使⽤AOP就好了。</li>
<li>注解的⽅式使⽤Spring AOP就了解⼏个切点表达式，⼏个增强/通知的注解就完事了，是不是贼简单…使⽤XML的⽅式和注解其实没有很⼤的区别，很快就可以上⼿啦。</li>
<li>引介/引⼊切⾯也算是⼀个⽐较亮的地⽅，可以⽤代理的⽅式为某个对象实现接⼝，从⽽能够使⽤借⼝下的⽅法。这种⽅式是⾮侵⼊式的~</li>
<li>要增强的⽅法还可以接收与被代理⽅法⼀样的参数、绑定被代理⽅法的返回值这些功能…</li>
</ul>
<h3 id="16-spring框架中都用到了哪些设计模式"><a href="#16-spring框架中都用到了哪些设计模式" class="headerlink" title="16. spring框架中都用到了哪些设计模式"></a>16. spring框架中都用到了哪些设计模式</h3><p>工厂模式：beanFactory</p>
<p>单例模式：bean默认为单例模式</p>
<p>代理模式：</p>
<p>模板方法</p>
<h3 id="17-spring事务的实现方式和实现原理"><a href="#17-spring事务的实现方式和实现原理" class="headerlink" title="17. spring事务的实现方式和实现原理"></a>17. spring事务的实现方式和实现原理</h3><p>spring事务的本质其实是数据库对事务的支持</p>
<p>真正的数据库层的事务提交和回滚是通过binlog 或者 redo log实现的</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/servlet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/servlet/" itemprop="url">servlet</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:58:44+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/servlet/" class="leancloud_visitors" data-flag-title="servlet">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  31
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><p>⼀个运⾏JAVA的⽹络服务器，底层是Socket的⼀个程序，它也是JSP和Serlvet的⼀个容器。</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200430131308.png" alt="TIM截图20200430131308" style="zoom:80%;" />



<p><strong>URL和URI</strong></p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200430131446.png" alt="TIM截图20200430131446" style="zoom:50%;" />



<p><strong>Tomcat目录结构</strong></p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200430131507.png" alt="TIM截图20200430131507" style="zoom:80%;" />



<p><strong>虚拟目录</strong></p>
<ol>
<li><p>在其他盘符下创建⼀个web站点⽬录，并创建WEB-INF⽬录和⼀个html⽂件。</p>
</li>
<li><p>找到Tomcat⽬录下/conf/server.xml⽂件</p>
</li>
<li><p>在server.xml中的<Host> 节点下添加如下代码。</p>
<p><strong>path</strong>表示的是访问时输⼊的<strong>web项⽬名</strong>，<strong>docBase</strong>表示的是<strong>站点⽬录的绝对路径</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Context path=<span class="string">"/web1"</span> docBase=<span class="string">"D:\web1"</span>/&gt;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<p><strong>虚拟主机</strong></p>
<ol>
<li><p>在tomcat的server.xml⽂件中添加主机名</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Host name=<span class="string">"lwclick"</span> appBase=<span class="string">"D:\web1"</span>&gt;</span><br><span class="line">	&lt;Context path=<span class="string">"/web1"</span> docBase=<span class="string">"D:\web1"</span>/&gt;</span><br><span class="line">&lt;/Host&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问：<code>lwclick：8080/web1/test.html</code></p>
</li>
</ol>
<p><strong>浏览器访问WEB资源的流程图</strong></p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200430175929.png" alt="TIM截图20200430175929" style="zoom:90%;" />

<hr>
<h2 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h2><h3 id="1-什么是Servlet？"><a href="#1-什么是Servlet？" class="headerlink" title="1. 什么是Servlet？"></a>1. 什么是Servlet？</h3><p>是⼀个遵循Servlet开发的java类。Servlet是<strong>由服务器调⽤的</strong>，运⾏在服务器端。</p>
<h3 id="2-HTTP协议"><a href="#2-HTTP协议" class="headerlink" title="2. HTTP协议"></a>2. HTTP协议</h3><h4 id="2-1-什么是HTPP协议"><a href="#2-1-什么是HTPP协议" class="headerlink" title="2.1 什么是HTPP协议"></a>2.1 什么是HTPP协议</h4><p>超⽂本传输协议（HTTP，HyperText Transfer Protocol)是互联⽹上应⽤最为⼴泛的⼀种⽹络协议。所有的WWW⽂件都必须遵守这个标准。它是<strong>TCP/IP协议</strong>的⼀个<strong>应⽤层协议</strong></p>
<p>HTTP协议就是客户端和服务器交互的⼀种通迅的格式。</p>
<h4 id="2-2-HTTP1-0和HTTP1-1的区别"><a href="#2-2-HTTP1-0和HTTP1-1的区别" class="headerlink" title="2.2 HTTP1.0和HTTP1.1的区别"></a>2.2 HTTP1.0和HTTP1.1的区别</h4><ul>
<li>HTTP1.0协议，客户端与web服务器建⽴连接后，只能获得⼀个web资源【短连接，获取资源后就断开】</li>
<li>HTTP1.1协议，允许客户端与web服务器建⽴连接后，在⼀个连接上获取多个web资源【保持连接】</li>
</ul>
<h4 id="2-3-HTTP请求"><a href="#2-3-HTTP请求" class="headerlink" title="2.3 HTTP请求"></a>2.3 HTTP请求</h4><p>浏览器向服务器请求某个web资源时，称之为<strong>浏览器</strong>向<strong>服务器</strong>发送了⼀个http请求。</p>
<p>http请求应该包含三个部分：</p>
<ol>
<li>请求⾏【描述客户端的请求⽅式、请求的资源名称，以及使⽤的HTTP协议版本号】</li>
<li>多个消息头【描述客户端请求哪台主机，以及客户端的⼀些环境信息等】</li>
<li>⼀个空⾏</li>
</ol>
<h5 id="2-3-1-请求行"><a href="#2-3-1-请求行" class="headerlink" title="2.3.1 请求行"></a>2.3.1 请求行</h5><ul>
<li><p><strong>GET</strong>：⽤来查询数据，提交速度快，在URL地址后附带的参数是有限制的，其数据容量通常不能超过1K。</p>
</li>
<li><p><strong>POST</strong>：⽤来提交数据，可以在请求的实体内容中向服务器发送数据，传送的数据量⽆限制。</p>
</li>
</ul>
<h5 id="2-3-2-请求头"><a href="#2-3-2-请求头" class="headerlink" title="2.3.2 请求头"></a>2.3.2 请求头</h5><p>Accept: text/html,image/*           Accept-Encoding: gzip,compress            Accept-Charset: ISO-8859-1</p>
<h4 id="2-4-HTTP响应"><a href="#2-4-HTTP响应" class="headerlink" title="2.4 HTTP响应"></a>2.4 HTTP响应</h4><p>⼀个HTTP响应代表着<strong>服务器</strong>向<strong>浏览器</strong>回送数据</p>
<p>HTTP响应应该包含四个部分:</p>
<ol>
<li>⼀个状态⾏【描述服务器对请求的处理结果。】</li>
<li>多个消息头【描述服务器的基本信息以及数据，通过描述信息，可以通知客户端如何处理服务器回送的数据】</li>
<li>⼀个空⾏</li>
<li>实体内容【服务器向客户端回送的数据】</li>
</ol>
<h5 id="2-4-1-状态⾏"><a href="#2-4-1-状态⾏" class="headerlink" title="2.4.1 状态⾏"></a>2.4.1 状态⾏</h5><p>格式： HTTP版本号　  状态码　原因叙述<br>状态⾏：HTTP/1.1          200           OK</p>
<p>​                                          404           客户端的请求有错误</p>
<p>​                                          500           服务器有错误 </p>
<h5 id="2-4-2-响应头"><a href="#2-4-2-响应头" class="headerlink" title="2.4.2 响应头"></a>2.4.2 响应头</h5><p>Server:apache tomcat       Content-Encoding: gzip       Content-Type: text/html; charset=GB2312</p>
<h3 id="3-servlet生命周期（面试题）"><a href="#3-servlet生命周期（面试题）" class="headerlink" title="3. servlet生命周期（面试题）"></a>3. servlet生命周期（面试题）</h3><ol>
<li><strong>加载Servlet</strong>。当Tomcat<strong>第⼀次访问Servlet</strong>的时候，Tomcat会负责<strong>创建Servlet的实例</strong></li>
<li><strong>初始化</strong>。当<strong>Servlet被实例化后</strong>，Tomcat会调⽤<strong>init()</strong>⽅法<strong>初始化这个对象</strong></li>
<li><strong>处理服务</strong>。当<strong>浏览器访问Servlet</strong>的时候，Servlet 会调⽤<strong>service()⽅法</strong>处理请求</li>
<li><strong>销毁</strong>。当<strong>Tomcat关闭时</strong>或者检测到<strong>Servlet要从Tomcat删除的时候</strong>会⾃动调⽤<strong>destroy()</strong>⽅法，让该<br>实例释放掉所占的资源。⼀个Servlet如果⻓时间不被使⽤的话，也会被Tomcat⾃动销毁</li>
<li><strong>卸载</strong>。当Servlet调⽤完<strong>destroy()⽅法后</strong>，等待<strong>垃圾回收</strong>。如果有需要再次使⽤这个Servlet，会重<br>新调⽤init()⽅法进⾏初始化操作。</li>
</ol>
<ul>
<li><p>只要访问Servlet，service()就会被调⽤。</p>
</li>
<li><p>init()只有第⼀次访问Servlet的时候才会被调⽤。</p>
</li>
<li><p>destroy()只有在Tomcat关闭的时候才会被调⽤。</p>
</li>
</ul>
<h3 id="4-servlet编写"><a href="#4-servlet编写" class="headerlink" title="4. servlet编写"></a>4. servlet编写</h3><ul>
<li><p>继承HttpServlet，重写service方法</p>
</li>
<li><p>配置web.xml文件</p>
</li>
</ul>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200430182222.png" alt="TIM截图20200430182222"></p>
<hr>
<h2 id="细节问题"><a href="#细节问题" class="headerlink" title="细节问题"></a>细节问题</h2><h3 id="1-servlet细节"><a href="#1-servlet细节" class="headerlink" title="1. servlet细节"></a>1. servlet细节</h3><h4 id="1-1-⼀个已经注册的Servlet可以被多次映射"><a href="#1-1-⼀个已经注册的Servlet可以被多次映射" class="headerlink" title="1.1 ⼀个已经注册的Servlet可以被多次映射"></a>1.1 ⼀个已经注册的Servlet可以被多次映射</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>lwclick.web.Demo1<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Demo1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-2-Servlet映射的URL可以使⽤通配符"><a href="#1-2-Servlet映射的URL可以使⽤通配符" class="headerlink" title="1.2 Servlet映射的URL可以使⽤通配符"></a>1.2 Servlet映射的URL可以使⽤通配符</h4><p>通配符有两种格式：</p>
<ol>
<li>*. 扩展名</li>
<li>正斜杠（/）开头并以“/*”结尾。</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;<span class="comment">/*&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;</span></span><br><span class="line"><span class="comment">&lt;/servlet-mapping&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-3-Servlet是单例的（面试题）"><a href="#1-3-Servlet是单例的（面试题）" class="headerlink" title="1.3 Servlet是单例的（面试题）"></a>1.3 Servlet是单例的（面试题）</h4><ul>
<li><p>Servlet对象⼀旦创建了，就会驻留在内存中，为后续的请求做服务，直到服务器关闭。</p>
</li>
<li><p>每次访问请求，都创建新的请求对象(HttpServletRequest)和响应对象(HttpServletResponse)</p>
</li>
<li><p>多个⽤户访问Servlet的时候，服务器会为每个⽤户创建⼀个线程。当多个⽤户<strong>并发访问Servlet共享资源</strong>的时候就会出现线程安全问题。</p>
<ul>
<li>如果<strong>⼀个变量需要多个用户共享</strong>，则应当在访问该变量的时候，加同步机制<strong>synchronized (对象){}</strong></li>
<li>如果⼀个变量<strong>不需要共享</strong>，则直接在service()中定义.这样不会存在线程安全问题</li>
</ul>
</li>
</ul>
<h4 id="1-4-load-on-startup"><a href="#1-4-load-on-startup" class="headerlink" title="1.4 load-on-startup"></a>1.4 load-on-startup</h4><p>如果在<code>&lt;servlet&gt;</code>元素中配置了⼀个<code>&lt;load-on-startup&gt;</code> 元素，那么WEB应⽤程序在启动时，就会装载并创建Servlet的实例对象、以及调⽤Servlet实例对象的init()⽅法。</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200430183607.png" alt="TIM截图20200430183607" style="zoom:80%;" />

<p><strong>作用：</strong></p>
<ol>
<li>为web应⽤写⼀个InitServlet，这个servlet配置为启动时装载，<strong>为整个web应⽤创建必要的数据库表和数据</strong></li>
<li>完成⼀些定时的任务【定时写⽇志，定时备份数据】</li>
</ol>
<h4 id="1-5-在web访问任何资源都是在访问servlet"><a href="#1-5-在web访问任何资源都是在访问servlet" class="headerlink" title="1.5 在web访问任何资源都是在访问servlet"></a>1.5 在web访问任何资源都是在访问servlet</h4><p>⽆论在web中访问什么资源【包括JSP】，都是在访问Servlet。</p>
<p>没有⼿⼯配置缺省Servlet的时候，你访问静态图⽚，静态⽹⻚，缺省Servlet会在你web站点中寻找该图⽚或⽹⻚，如果有就返回给浏览器，没有就报404错误</p>
<h3 id="2-ServletConfig对象"><a href="#2-ServletConfig对象" class="headerlink" title="2. ServletConfig对象"></a>2. ServletConfig对象</h3><h4 id="2-1-ServletConfig对象有什么⽤？"><a href="#2-1-ServletConfig对象有什么⽤？" class="headerlink" title="2.1 ServletConfig对象有什么⽤？"></a>2.1 ServletConfig对象有什么⽤？</h4><p>通过此对象可以读取web.xml中配置的初始化参数。能够让程序更加灵活【更换需求，更改配置⽂件web.xml即可，程序代码不⽤改】</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-<span class="class"><span class="keyword">class</span>&gt;<span class="title">zhongfucheng</span>.<span class="title">web</span>.<span class="title">Demo1</span>&lt;/<span class="title">servlet</span>-<span class="title">class</span>&gt;</span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class">    &lt;<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">param</span>-<span class="title">name</span>&gt;<span class="title">name</span>&lt;/<span class="title">param</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">param</span>-<span class="title">value</span>&gt;<span class="title">zhongfucheng</span>&lt;/<span class="title">param</span>-<span class="title">value</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">init</span>-<span class="title">param</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">servlet</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">servlet</span>-<span class="title">mapping</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">servlet</span>-<span class="title">name</span>&gt;<span class="title">Demo1</span>&lt;/<span class="title">servlet</span>-<span class="title">name</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">url</span>-<span class="title">pattern</span>&gt;/<span class="title">Demo1</span>&lt;/<span class="title">url</span>-<span class="title">pattern</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">servlet</span>-<span class="title">mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200430203421.png" alt="TIM截图20200430203421"></p>
<h3 id="3-ServletContext对象"><a href="#3-ServletContext对象" class="headerlink" title="3. ServletContext对象"></a>3. ServletContext对象</h3><h4 id="3-1-什么是ServletContext对象？"><a href="#3-1-什么是ServletContext对象？" class="headerlink" title="3.1 什么是ServletContext对象？"></a>3.1 什么是ServletContext对象？</h4><p>当Tomcat启动的时候，就会创建⼀个ServletContext对象。它代表着<strong>当前web站点</strong></p>
<h4 id="3-2-ServletContext有什么⽤？"><a href="#3-2-ServletContext有什么⽤？" class="headerlink" title="3.2 ServletContext有什么⽤？"></a>3.2 ServletContext有什么⽤？</h4><ol>
<li>ServletContext既然代表着当前web站点，那么所有Servlet都共享着⼀个ServletContext对象，所以Servlet之间<strong>可以通过ServletContext实现通讯</strong>。</li>
<li><strong>ServletConfig</strong>获取的是配置的是<strong>单个Servlet的参数信息</strong>，<strong>ServletContext</strong>可以获取的是配置<strong>整个web站点的参数信息</strong></li>
<li>利⽤ServletContext<strong>读取web站点的资源⽂件</strong></li>
<li>实现Servlet的转发【不常用】</li>
</ol>
<h4 id="3-3-Servlet之间实现通讯"><a href="#3-3-Servlet之间实现通讯" class="headerlink" title="3.3 Servlet之间实现通讯"></a>3.3 Servlet之间实现通讯</h4><p>ServletContext对象可以被称之为<strong>域对象</strong>，可以简单理解成⼀个容器【类似于Map集合】</p>
<p><strong>通过serAttribute实现通讯</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到ServletContext对象</span></span><br><span class="line">ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line">String value = <span class="string">"lwclick"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MyName作为关键字，value作为值存进 域对象【类型于Map集合】</span></span><br><span class="line">servletContext.setAttribute(<span class="string">"MyName"</span>, value);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取ServletContext对象</span></span><br><span class="line">ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过关键字获取存储在域对象的值</span></span><br><span class="line">String value = (String) servletContext.getAttribute(<span class="string">"MyName"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>



<h4 id="3-4-获取web站点配置的信息"><a href="#3-4-获取web站点配置的信息" class="headerlink" title="3.4 获取web站点配置的信息"></a>3.4 获取web站点配置的信息</h4><ul>
<li>web.xml⽂件⽀持对整个站点进⾏配置参数信息【所有Servlet都可以取到该参数信息】</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>name<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>lwclick<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到ServletContext对象</span></span><br><span class="line">ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过名称获取值</span></span><br><span class="line">String value = servletContext.getInitParameter(<span class="string">"name"</span>);</span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>



<h4 id="3-5-读取资源文件"><a href="#3-5-读取资源文件" class="headerlink" title="3.5 读取资源文件"></a>3.5 读取资源文件</h4><p>⽂件放在web⽬录下，直接通过⽂件名称就能获取（web –&gt; WEB-INF –&gt; 资源文件）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到ServletContext对象</span></span><br><span class="line">ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line"><span class="comment">//调⽤ServletContext⽅法获取到读取⽂件的流</span></span><br><span class="line">InputStream inputStream = servletContext.getResourceAsStream(<span class="string">"2.png"</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Response对象"><a href="#Response对象" class="headerlink" title="Response对象"></a>Response对象</h2><h3 id="1-response、request对象"><a href="#1-response、request对象" class="headerlink" title="1. response、request对象"></a>1. response、request对象</h3><ul>
<li><p>Tomcat收到客户端的http请求，针对每⼀次请求，分别创建⼀个<strong>代表请求的request对象</strong>和<strong>代表响应的response对象</strong></p>
</li>
<li><p><strong>获取浏览器提交过来的数据，找request对象</strong></p>
</li>
<li><p><strong>向浏览器输出数据，找response对象</strong></p>
</li>
</ul>
<p>HttpServletResponse对象封装了http响应的信息。</p>
<h3 id="2-HttpServletResponse的应⽤"><a href="#2-HttpServletResponse的应⽤" class="headerlink" title="2. HttpServletResponse的应⽤"></a>2. HttpServletResponse的应⽤</h3><h4 id="2-1-调⽤getOutputStream-⽅法向浏览器输出数据"><a href="#2-1-调⽤getOutputStream-⽅法向浏览器输出数据" class="headerlink" title="2.1 调⽤getOutputStream()⽅法向浏览器输出数据"></a>2.1 调⽤getOutputStream()⽅法向浏览器输出数据</h4><p>二进制数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">response.getOutputStream().write(<span class="string">"你好呀我是中国"</span>.getBytes(<span class="string">"UTF-8"</span>));</span><br></pre></td></tr></table></figure>



<h4 id="2-2-调⽤getWriter-⽅法向浏览器输出数据"><a href="#2-2-调⽤getWriter-⽅法向浏览器输出数据" class="headerlink" title="2.2 调⽤getWriter()⽅法向浏览器输出数据"></a>2.2 调⽤getWriter()⽅法向浏览器输出数据</h4><p>字符数据，不能输出⼆进制数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取到printWriter对象</span></span><br><span class="line">PrintWriter printWriter = response.getWriter();</span><br><span class="line">printWriter.write(<span class="string">"看完博客点赞！"</span>);</span><br></pre></td></tr></table></figure>



<h4 id="2-3-实现⽂件下载"><a href="#2-3-实现⽂件下载" class="headerlink" title="2.3 实现⽂件下载"></a>2.3 实现⽂件下载</h4><p>在web站点下有⼀个图⽚等文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到资源的路径</span></span><br><span class="line">String path = <span class="keyword">this</span>.getServletContext().getRealPath(<span class="string">"/download/1.png"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取资源</span></span><br><span class="line">FileInputStream fis = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取到⽂件名,路径在电脑上保存是\\形式的。</span></span><br><span class="line">String fileName = path.substring(path.lastIndexOf(<span class="string">"\\"</span>) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置消息头，告诉浏览器，我要下载1.png这个图⽚</span></span><br><span class="line">response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span>+URLEncoder.encode(fileName, <span class="string">"UTF-8"</span>)););</span><br><span class="line"></span><br><span class="line"><span class="comment">//把读取到的资源写给浏览器</span></span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">ServletOutputStream sos = response.getOutputStream();</span><br><span class="line"><span class="keyword">while</span> ((len = fis.read(bytes)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">	sos.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭资源</span></span><br><span class="line">servletOutputStream.close();</span><br><span class="line">fileInputStream.close();</span><br></pre></td></tr></table></figure>



<h4 id="2-4-实现自动刷新"><a href="#2-4-实现自动刷新" class="headerlink" title="2.4 实现自动刷新"></a>2.4 实现自动刷新</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">response.getWriter().write(<span class="string">"3秒后跳转⻚⾯....."</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//三秒后跳转到index.jsp⻚⾯去，web应⽤的映射路径我设置成/，url没有写上应⽤名</span></span><br><span class="line">response.setHeader(<span class="string">"Refresh"</span>, <span class="string">"3;url='/index.jsp'"</span>);</span><br></pre></td></tr></table></figure>



<h4 id="2-5-设置缓存"><a href="#2-5-设置缓存" class="headerlink" title="2.5 设置缓存"></a>2.5 设置缓存</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">【浏览器默认有缓存，对于需要实时更新的数据，取消缓存】</span><br><span class="line"><span class="comment">//浏览器有三消息头设置缓存，为了兼容性！将三个消息头都设置了</span></span><br><span class="line">response.setDateHeader(<span class="string">"Expires"</span>, -<span class="number">1</span>);</span><br><span class="line">response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-cache"</span>);</span><br><span class="line">response.setHeader(<span class="string">"Pragma"</span>, <span class="string">"no-cache"</span>);</span><br></pre></td></tr></table></figure>



<h4 id="2-6-实现数据压缩"><a href="#2-6-实现数据压缩" class="headerlink" title="2.6 实现数据压缩"></a>2.6 实现数据压缩</h4><p>GZIP类来对数据压缩，把压缩后的数据取出来，写给浏览器</p>
<h4 id="2-7-生成随机图⽚"><a href="#2-7-生成随机图⽚" class="headerlink" title="2.7 生成随机图⽚"></a>2.7 生成随机图⽚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在内存中⽣成⼀张图⽚,宽为80,⾼为20，类型是RGB</span></span><br><span class="line">BufferedImage bImg = <span class="keyword">new</span> BufferedImage(<span class="number">80</span>, <span class="number">20</span>, BufferedImage.TYPE_INT_RGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取到这张图⽚</span></span><br><span class="line">Graphics g = bImg.getGraphics();</span><br><span class="line"></span><br><span class="line"><span class="comment">//往图⽚设置颜⾊和字体</span></span><br><span class="line">g.setColor(Color.white);</span><br><span class="line">g.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">80</span>, <span class="number">20</span>);</span><br><span class="line">g.setFont(<span class="keyword">new</span> Font(<span class="keyword">null</span>, Font.BOLD, <span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//往图⽚上写数据，先写个12345，横坐标是0，纵坐标是20【⾼度】</span></span><br><span class="line">graphics.drawString(<span class="string">"12345"</span>, <span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//要往浏览器写⼀张图⽚，那要告诉浏览器回送的类型是⼀张图⽚</span></span><br><span class="line">response.setHeader(<span class="string">"ContentType"</span>, <span class="string">"jpeg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//java提供了图⽚流给我们使⽤，这是⼀个⼯具类</span></span><br><span class="line"><span class="comment">//把图⽚传进去，类型是jpg，写给浏览器</span></span><br><span class="line">ImageIO.write(bImg, <span class="string">"jpg"</span>, response.getOutputStream());</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">makeNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//这样就会⽣成0-7位的随机数，如果不够7位，我们加到7位就⾏了</span></span><br><span class="line">    <span class="keyword">int</span> anInt = random.nextInt(<span class="number">9999999</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将数字转成是字符串</span></span><br><span class="line">    String num = String.valueOf(anInt);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断位数有多少个，不够就加</span></span><br><span class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span> - num.length(); i++) &#123;</span><br><span class="line">    	stringBuffer.append(<span class="string">"0"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> stringBuffer.append(num).toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-8-重定向跳转"><a href="#2-8-重定向跳转" class="headerlink" title="2.8 重定向跳转"></a>2.8 重定向跳转</h4><p>点击⼀个超链接，<strong>通知浏览器</strong>跳转到另外的⼀个⻚⾯就叫重定向跳转。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重定向到index.jsp⻚⾯</span></span><br><span class="line">response.sendRedirect(<span class="string">"/lwclick/index.jsp"</span>);</span><br></pre></td></tr></table></figure>

<p><strong>重定向是通过302状态码和跳转地址实现的</strong></p>
<hr>
<h2 id="Request对象"><a href="#Request对象" class="headerlink" title="Request对象"></a>Request对象</h2><h3 id="1-什么是HttpServletRequest"><a href="#1-什么是HttpServletRequest" class="headerlink" title="1.  什么是HttpServletRequest"></a>1.  什么是HttpServletRequest</h3><p><strong>客户端的请求</strong>，当客户端通过HTTP协议访问服务器时，HTTP请求头中的所有信息都封装在这个对象中，开发⼈员通过这个对象的⽅法，可以获得客户这些信息。</p>
<h3 id="2-常用方法"><a href="#2-常用方法" class="headerlink" title="2. 常用方法"></a>2. 常用方法</h3><ul>
<li>getRequestURL        返回客户端发出请求时的完整URL</li>
<li>getQueryString        返回请求⾏中的参数部分</li>
<li>getRemoteAddr       返回发出请求的客户机的IP地址</li>
<li>getLocalAddr            返回WEB服务器的IP地址</li>
<li>getHeader                 获得客户机请求头</li>
<li><strong>getParameter         获得客户机请求参数(客户端提交的数据)</strong></li>
</ul>
<h3 id="3-应用"><a href="#3-应用" class="headerlink" title="3. 应用"></a>3. 应用</h3><h4 id="3-1-防盗链"><a href="#3-1-防盗链" class="headerlink" title="3.1 防盗链"></a>3.1 防盗链</h4><p>不能使用复制粘贴网址，拿走网站上的资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到⽹⻚是从哪⾥来的</span></span><br><span class="line">String referer = request.getHeader(<span class="string">"Referer"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果不是从我的⾸⻚来或者从地址栏直接访问的，</span></span><br><span class="line"><span class="keyword">if</span> ( referer == <span class="keyword">null</span> || !referer.contains(<span class="string">"localhost:8080/lwclick/index.jsp"</span>) ) &#123;</span><br><span class="line">    <span class="comment">//回到⾸⻚去</span></span><br><span class="line">    response.sendRedirect(<span class="string">"/lwclick/index.jsp"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//能执⾏下⾯的语句，说明是从我的⾸⻚点击进来的，那没问题，照常显示</span></span><br><span class="line">response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">response.getWriter().write(<span class="string">"路⻜做了xx"</span>);</span><br></pre></td></tr></table></figure>



<h4 id="3-2-表单提交数据【通过post⽅式提交数据】"><a href="#3-2-表单提交数据【通过post⽅式提交数据】" class="headerlink" title="3.2 表单提交数据【通过post⽅式提交数据】"></a>3.2 表单提交数据【通过post⽅式提交数据】</h4><p>点击提交按钮的时候，数据封装进了FormData中</p>
<p>http请求中把实体主体带过去了【传输的数据称之为实体主体】</p>
<p>既然request对象封装了http请求，所以request对象可以解析到发送过来的数据</p>
<p>于是只要把编码设置成UTF-8就可以解决乱码问题了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/lwclick/formServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>⽤户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"男"</span>&gt;</span>男</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"⼥"</span>&gt;</span>⼥</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>爱好<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"hobbies"</span> <span class="attr">value</span>=<span class="string">"游泳"</span>&gt;</span>游泳</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"hobbies"</span> <span class="attr">value</span>=<span class="string">"跑步"</span>&gt;</span>跑步</span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"hobbies"</span> <span class="attr">value</span>=<span class="string">"⻜翔"</span>&gt;</span>⻜翔</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"aaa"</span> <span class="attr">value</span>=<span class="string">"my name is lwclick"</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>你的来⾃于哪⾥<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"address"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"⼴州"</span>&gt;</span>⼴州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"深圳"</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"北京"</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>详细说明:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">"30"</span> <span class="attr">rows</span>=<span class="string">"2"</span> <span class="attr">name</span>=<span class="string">"textarea"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">value</span>=<span class="string">"重置"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>在formServlet获取值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置request字符编码的格式</span></span><br><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过html的name属性，获取到值</span></span><br><span class="line">String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line">String gender = request.getParameter(<span class="string">"gender"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//复选框和下拉框有多个值，获取到多个值</span></span><br><span class="line">String[] hobbies = request.getParameterValues(<span class="string">"hobbies"</span>);</span><br><span class="line">String[] address = request.getParameterValues(<span class="string">"address"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取到⽂本域的值</span></span><br><span class="line">String description = request.getParameter(<span class="string">"textarea"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//得到隐藏域的值</span></span><br><span class="line">String hiddenValue = request.getParameter(<span class="string">"aaa"</span>);</span><br><span class="line"></span><br><span class="line">....各种System.out.println().......</span><br></pre></td></tr></table></figure>



<h4 id="3-3-超链接⽅式提交数据-get方式-–-不推荐"><a href="#3-3-超链接⽅式提交数据-get方式-–-不推荐" class="headerlink" title="3.3 超链接⽅式提交数据(get方式) – 不推荐"></a>3.3 超链接⽅式提交数据(get方式) – 不推荐</h4><p>get⽅式不同，它的数据是从消息⾏带过去的，没有封装到request对象⾥⾯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href="/lwclick/formServlet?username=xxx"&gt;使⽤超链接将数据带给浏览器&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">//接收以username为参数名带过来的值</span></span><br><span class="line">String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">System.out.println(username);</span><br></pre></td></tr></table></figure>



<p><strong>sendRedirect()方式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendRedirect(<span class="string">"servlet的地址?参数名="</span>+参数值 &amp;<span class="string">"参数名="</span>+参数值);</span><br></pre></td></tr></table></figure>



<p><strong>中文乱码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此时得到的数据已经是被ISO 8859-1编码后的字符串了，这个是乱码</span></span><br><span class="line">String name = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//乱码通过反向查ISO 8859-1得到原始的数据</span></span><br><span class="line"><span class="keyword">byte</span>[] bytes = name.getBytes(<span class="string">"ISO8859-1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过原始的数据，设置正确的码表，构建字符串</span></span><br><span class="line">String value = <span class="keyword">new</span> String(bytes, <span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure>



<h4 id="3-4-实现转发（不要在转发之前写数据给浏览器）"><a href="#3-4-实现转发（不要在转发之前写数据给浏览器）" class="headerlink" title="3.4 实现转发（不要在转发之前写数据给浏览器）"></a>3.4 实现转发（不要在转发之前写数据给浏览器）</h4><p>使⽤request的<strong>getRequestDispatcher.forward(request,response)</strong>实现转发，做到的功能也是⻚⾯跳转</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调⽤requestDispatcher对象的forward()实现转发,传⼊request和response⽅法</span></span><br><span class="line">request.getRequestDispatcher(<span class="string">"/index.jsp"</span>).forward(request, response);</span><br></pre></td></tr></table></figure>

<p><strong>实现servlet之间的通讯（尽量使用request）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以username为关键字存lwclick值</span></span><br><span class="line">request.setAttribute(<span class="string">"username"</span>, <span class="string">"lwclick"</span>);</span><br><span class="line"></span><br><span class="line">request.getRequestDispatcher(<span class="string">"/reqServlet"</span>).forward(request, response);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取到存进request对象的值</span></span><br><span class="line">String userName = (String) request.getAttribute(<span class="string">"username"</span>);</span><br></pre></td></tr></table></figure>



<h4 id="3-5-转发和重定向的区别（面试题）"><a href="#3-5-转发和重定向的区别（面试题）" class="headerlink" title="3.5 转发和重定向的区别（面试题）"></a>3.5 转发和重定向的区别（面试题）</h4><ul>
<li><p>实际发⽣位置不同，地址栏不同</p>
<ul>
<li><strong>转发</strong>是由<strong>服务器进⾏跳转</strong>的，在转发的时候，<strong>浏览器的地址栏</strong>是<strong>没有发⽣变化</strong>的，实现转发只是⼀次的http请求，⼀次转发中request和response对象都是<strong>同⼀个</strong>。转发是对浏览器透明的。</li>
<li><strong>重定向</strong>是由<strong>浏览器进⾏跳转</strong>的，浏览器的<strong>地址会发⽣变化</strong>的。实现<strong>重定向会发出两个http请求</strong>，request域对象是⽆效的</li>
</ul>
</li>
<li><p>用法不同</p>
<p>​    给<strong>服务器</strong>⽤的直接<strong>从资源名开始写</strong>，给<strong>浏览器</strong>⽤的要<strong>把应⽤名写上</strong></p>
<ul>
<li>request.getRequestDispatcher(“ <strong>/</strong> 资源名 URI”).forward(request,response)<ul>
<li>转发时”/“代表的是本应⽤程序的根⽬录</li>
</ul>
</li>
<li>response.send(“ <strong>/</strong> web应⽤/资源名 URI”)<ul>
<li>重定向时”/“代表的是webapps⽬录</li>
</ul>
</li>
</ul>
</li>
<li><p>能够去往的URL的范围不⼀样</p>
<ul>
<li><strong>转发</strong>是服务器跳转只能去往<strong>当前web应⽤的资源</strong></li>
<li><strong>重定向</strong>是浏览器跳转，可以去往<strong>任何的资源</strong></li>
</ul>
</li>
<li><p>传递数据的类型不同</p>
<ul>
<li>转发的request对象可以传递各种类型的数据，包括对象</li>
<li><strong>重定向</strong>只能传递<strong>字符串</strong></li>
</ul>
</li>
<li><p>跳转的时间不同</p>
<ul>
<li>转发：执⾏到<strong>跳转语句</strong>时就会<strong>⽴刻跳转</strong></li>
<li>重定向：<strong>整个⻚⾯执⾏完之后</strong>才执⾏跳转</li>
</ul>
</li>
<li><p>应⽤场景</p>
<ul>
<li>转发: 访问 Servlet <strong>处理业务逻辑</strong>，然后 forward 到 jsp <strong>显示处理结果</strong>，浏览器⾥ URL 不变</li>
<li>重定向: <strong>提交表单</strong>，处理成功后 redirect 到另⼀个 jsp，<strong>防⽌表单重复提交</strong>，浏览器⾥ URL 变了</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><h3 id="1-会话技术"><a href="#1-会话技术" class="headerlink" title="1. 会话技术"></a>1. 会话技术</h3><p><strong>⽤户开⼀个浏览器，访问⼀个⽹站，只要不关闭该浏览器</strong>，不管该⽤户点击多少个超链接，访问多少资源，直到⽤户关闭浏览器，整个这个过程我们称为<strong>⼀次会话</strong>.</p>
<h3 id="2-Cookie"><a href="#2-Cookie" class="headerlink" title="2. Cookie"></a>2. Cookie</h3><h4 id="2-1-什么是cookie"><a href="#2-1-什么是cookie" class="headerlink" title="2.1 什么是cookie"></a>2.1 什么是cookie</h4><p>⽹⻚之间的交互是通过HTTP协议传输数据的，⽽<strong>Http协议是无状态，不安全的协议</strong>（⼀旦数据提交完后，浏览器和服务器的连接就会关闭，再次交互的时候需要重新建⽴新的连接。）</p>
<p>W3C提出了：给每⼀个⽤户都发⼀个通⾏证，⽆论谁访问的时候都需要携带通⾏证，这样服务器就可以从通⾏证上确认⽤户的信息。<strong>通⾏证就是Cookie</strong></p>
<p><strong>流程：</strong></p>
<ul>
<li>浏览器访问服务器，如果服务器需要记录该⽤户的状态，就<strong>使⽤response</strong>向浏览器发送⼀个Cookie，浏览器会把Cookie保存起来</li>
<li>当浏览器再次访问服务器的时候，浏览器会把请求的⽹址连同Cookie⼀同交给服务器。</li>
</ul>
<h4 id="2-2-常⽤的Cookie⽅法"><a href="#2-2-常⽤的Cookie⽅法" class="headerlink" title="2.2 常⽤的Cookie⽅法"></a>2.2 常⽤的Cookie⽅法</h4><ul>
<li>public Cookie(String name,String value)</li>
<li>setValue与getValue⽅法</li>
<li>setMaxAge与getMaxAge⽅法</li>
<li>setPath与getPath⽅法</li>
<li>setDomain与getDomain⽅法</li>
<li>getName⽅法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置response的编码</span></span><br><span class="line">response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建Cookie对象，指定名称和值</span></span><br><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"username"</span>, <span class="string">"lwclick"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置Cookie的时间</span></span><br><span class="line">cookie.setMaxAge(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//向浏览器给⼀个Cookie</span></span><br><span class="line">response.addCookie(cookie);</span><br><span class="line">response.getWriter().write(<span class="string">"我已经向浏览器发送了⼀个Cookie"</span>);</span><br></pre></td></tr></table></figure>



<h4 id="2-3-Cookie细节"><a href="#2-3-Cookie细节" class="headerlink" title="2.3 Cookie细节"></a>2.3 Cookie细节</h4><h5 id="2-3-1-不可跨域名性"><a href="#2-3-1-不可跨域名性" class="headerlink" title="2.3.1 不可跨域名性"></a>2.3.1 不可跨域名性</h5><p> 浏览器通过<strong>域名</strong>判断⼀个⽹站是否能操作另⼀个⽹站的Cookie。</p>
<p>即使⼀级域名相同，⼆级域名不同，也不能获取到Cookie</p>
<h5 id="2-3-2-Cookie保存中⽂"><a href="#2-3-2-Cookie保存中⽂" class="headerlink" title="2.3.2 Cookie保存中⽂"></a>2.3.2 Cookie保存中⽂</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">PrintWriter printWriter = response.getWriter();</span><br><span class="line"></span><br><span class="line">String name = <span class="string">"中国"</span>;</span><br><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"country"</span>, URLEncoder.encode(name, <span class="string">"UTF-8"</span>));</span><br><span class="line">cookie.setMaxAge(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//⼀定不要忘记添加到浏览器中</span></span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">printWriter.write(<span class="string">"我颁发了⼀个Cookie，值保存的是中⽂数据"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">【取出Cookie】</span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; cookies != <span class="keyword">null</span> &amp;&amp; i &lt; cookies.length; i++) &#123;</span><br><span class="line">    String name = cookies[i].getName();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//经过URLEncoding就要URLDecoding</span></span><br><span class="line">    String value = URLDecoder.decode(cookies[i].getValue(), <span class="string">"UTF-8"</span>);</span><br><span class="line">    printWriter.write(name + <span class="string">"------"</span> + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="2-3-3-Cookie的有效期"><a href="#2-3-3-Cookie的有效期" class="headerlink" title="2.3.3 Cookie的有效期"></a>2.3.3 Cookie的有效期</h5><p>有效期通过setMaxAge()来设置</p>
<ul>
<li><p>MaxAge为<strong>正数</strong>，浏览器将Cookie写到硬盘中，只要还在MaxAge秒之前，登陆⽹站时该Cookie就有效【不论关闭了浏览器还是电脑】</p>
</li>
<li><p>MaxAge为<strong>负数</strong>，Cookie是临时性的，仅在本浏览器内有效</p>
</li>
<li><p>MaxAge为<strong>0</strong>，则表示<strong>删除</strong>该Cookie（<strong>需要添加到浏览器中</strong>）。</p>
</li>
</ul>
<h4 id="2-4-Cookie的应⽤"><a href="#2-4-Cookie的应⽤" class="headerlink" title="2.4 Cookie的应⽤"></a>2.4 Cookie的应⽤</h4><h5 id="2-4-1-显示⽤户上次访问的时间"><a href="#2-4-1-显示⽤户上次访问的时间" class="headerlink" title="2.4.1 显示⽤户上次访问的时间"></a>2.4.1 显示⽤户上次访问的时间</h5><p>用户每次登陆的时候，取到Cookie保存的值，再更新下Cookie的值。</p>
<p>访问Serlvet有两种情况</p>
<ul>
<li>第⼀次访问</li>
<li>已经访问过了</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line">response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">PrintWriter printWriter = response.getWriter();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取⽹⻚上所有的Cookie</span></span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断Cookie的值是否为空</span></span><br><span class="line">String cookieValue = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; cookies != <span class="keyword">null</span> &amp;&amp; i &lt; cookies.length; i++) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取到以time为名的Cookie</span></span><br><span class="line">    <span class="keyword">if</span> (cookies[i].getName().equals(<span class="string">"time"</span>)) &#123;</span><br><span class="line">        printWriter.write(<span class="string">"您上次登陆的时间是："</span>);</span><br><span class="line">        cookieValue = cookies[i].getValue();</span><br><span class="line">        printWriter.write(cookieValue);</span><br><span class="line">        </span><br><span class="line">        cookies[i].setValue(simpleDateFormat.format(<span class="keyword">new</span> Date()));</span><br><span class="line">        response.addCookie(cookies[i]);</span><br><span class="line">        <span class="comment">//既然已经找到了就可以break循环了</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果Cookie的值是空的，那么就是第⼀次访问</span></span><br><span class="line"><span class="keyword">if</span> (cookieValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//创建⼀个Cookie对象，⽇期为当前时间</span></span><br><span class="line">    Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"time"</span>, simpleDateFormat.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置Cookie的⽣命期</span></span><br><span class="line">    cookie.setMaxAge(<span class="number">20000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//response对象回送Cookie给浏览器</span></span><br><span class="line">    response.addCookie(cookie);</span><br><span class="line">    printWriter.write(<span class="string">"您是第⼀次登陆啊！"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="2-4-2-显示上次浏览过商品"><a href="#2-4-2-显示上次浏览过商品" class="headerlink" title="2.4.2 显示上次浏览过商品"></a>2.4.2 显示上次浏览过商品</h5><p>以书籍为例⼦！⾸先设计Book对象</p>
<hr>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>另⼀种记录浏览器状态的机制，<strong>Cookie保存在浏览器中，Session保存在服务器中。</strong></p>
<h3 id="1-Session-API"><a href="#1-Session-API" class="headerlink" title="1. Session API"></a>1. Session API</h3><ul>
<li>String getId();                                                              【获取Session的id】</li>
<li>void setMaxInactiveInterval(int var1);                    【设置Session超时时间】</li>
<li>int getMaxInactiveInterval();                                    【获取Session超时时间】</li>
<li>Object getAttribute(String var1);                             【获取Session属性】</li>
<li>Enumeration getAttributeNames();                        【获取Session所有的属性名】</li>
<li>void setAttribute(String var1, Object var2);          【设置Session属性】</li>
<li>void removeAttribute(String var1);                        【移除Session属性】</li>
<li>void invalidate();                                                       【销毁该Session】</li>
</ul>
<h3 id="2-Session作为域对象"><a href="#2-Session作为域对象" class="headerlink" title="2. Session作为域对象"></a>2. Session作为域对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//得到Session对象</span></span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置Session属性</span></span><br><span class="line">httpSession.setAttribute(<span class="string">"name"</span>, <span class="string">"看完博客就要点赞！！"</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到从上面Servlet的Session存进去的值</span></span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line">String value = (String) httpSession.getAttribute(<span class="string">"name"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>



<h3 id="3-Session的⽣命周期和有效期"><a href="#3-Session的⽣命周期和有效期" class="headerlink" title="3. Session的⽣命周期和有效期"></a>3. Session的⽣命周期和有效期</h3><ul>
<li><p>⽤户第⼀次访问服务器<strong>Servlet</strong>，jsp等动态资源就会被⾃动创建，Session对象保存在内存⾥</p>
</li>
<li><p>Session⽣成后，只要<strong>⽤户继续访问</strong>，服务器就会更新Session的最后访问时间，⽆论是否对Session进⾏读写，服务器都会认为Session活跃了⼀次。</p>
</li>
<li><p>为了防⽌内存溢出，服务器会把⻓时间没有活跃的Session从内存中删除，这个时间也就是Session的超时时间。（默认30分钟）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置Session最⻓超时时间为60秒，这⾥的单位是秒</span></span><br><span class="line">httpSession.setMaxInactiveInterval(<span class="number">60</span>);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="4-Session的实现原理"><a href="#4-Session的实现原理" class="headerlink" title="4. Session的实现原理"></a>4. Session的实现原理</h3><p>Session 之所以可以识别不同的⽤户，依靠的就是Cookie</p>
<p>该Cookie是服务器⾃动颁发给浏览器的，不⽤⼿⼯创建的。该Cookie的maxAge值默认是-1，也就是说仅当前浏览器使⽤，不将该Cookie存在硬盘中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">当我们访问Servlet1的时候，服务器就会创建⼀个Session对象，执⾏我们的程序代码，并⾃动颁发个Cookie给⽤户浏览器</span><br><span class="line"></span><br><span class="line">当我们⽤同⼀个浏览器访问Servlet2的时候，浏览器会把Cookie的值通过http协议带过去给服务器，服务器就知道⽤哪⼀Session。</span><br><span class="line"></span><br><span class="line">⽽当我们使⽤新会话的浏览器访问Servlet2的时候，该新浏览器并没有Cookie，服务器⽆法辨认使⽤哪⼀个Session，所以就获取不到值</span><br></pre></td></tr></table></figure>



<p>禁⽤了Cookie，通过URL地址重写</p>
<ul>
<li>encodeURL(String url)</li>
<li>encodeRedirectURL(String url)</li>
</ul>
<h3 id="5-Session案例"><a href="#5-Session案例" class="headerlink" title="5. Session案例"></a>5. Session案例</h3><h4 id="5-1-使⽤Session完成⽤户简单登陆"><a href="#5-1-使⽤Session完成⽤户简单登陆" class="headerlink" title="5.1 使⽤Session完成⽤户简单登陆"></a>5.1 使⽤Session完成⽤户简单登陆</h4><p>创建User类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String username = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> String password = <span class="keyword">null</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.username = username;</span><br><span class="line">    <span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line">....各种set、get⽅法</span><br></pre></td></tr></table></figure>

<p>集合模拟⼀个数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">//装载些数据进数据库</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    list.add(<span class="keyword">new</span> User(<span class="string">"aaa"</span>,<span class="string">"111"</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> User(<span class="string">"bbb"</span>,<span class="string">"222"</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> User(<span class="string">"ccc"</span>,<span class="string">"333"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通过⽤户名和密码查找⽤户</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">find</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">        <span class="keyword">if</span> (user.getUsername().equals(username) &amp;&amp;</span><br><span class="line">            user.getPassword().equals(password)) &#123;</span><br><span class="line">            	<span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>表单提交</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/ouzicheng/LoginServlet"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    ⽤户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>获取到表单提交的数据，查找数据库是否有相对应的⽤户名和密码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">String username = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">String password = request.getParameter(<span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line">User user = UserDB.find(username, password);</span><br><span class="line"><span class="comment">//如果找不到，就是⽤户名或密码出错了。</span></span><br><span class="line"><span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">    response.getWriter().write(<span class="string">"you can't login"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//标记着该⽤户已经登陆了！</span></span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line">httpSession.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line"><span class="comment">//跳转到其他⻚⾯，告诉⽤户成功登陆了。</span></span><br><span class="line"></span><br><span class="line">response.sendRedirect(response.encodeURL(<span class="string">"index.jsp"</span>));</span><br></pre></td></tr></table></figure>



<h4 id="5-2-利⽤Session防⽌表单重复提交"><a href="#5-2-利⽤Session防⽌表单重复提交" class="headerlink" title="5.2 利⽤Session防⽌表单重复提交"></a>5.2 利⽤Session防⽌表单重复提交</h4><ul>
<li>在session域中存储⼀个token</li>
<li>然后前台⻚⾯的隐藏域获取得到这个token</li>
<li>在第⼀次访问的时候，我们就判断seesion有没有值，如果有就⽐对。对⽐正确后我们就处理请求，接着就把session存储的数据给删除了</li>
<li>等到再次访问的时候，我们session就没有值了，就不受理前台的请求了！</li>
</ul>
<h4 id="5-3-一次性校验码"><a href="#5-3-一次性校验码" class="headerlink" title="5.3 一次性校验码"></a>5.3 一次性校验码</h4><p>⽣成验证码后，把验证码的数据存进Session域对象中，判断⽤户输⼊验证码是否和Session域对象的数据⼀致。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在内存中⽣成图⽚</span></span><br><span class="line">BufferedImage bImg = <span class="keyword">new</span> BufferedImage(<span class="number">80</span>, <span class="number">20</span>,BufferedImage.TYPE_INT_RGB);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取到这张图⽚</span></span><br><span class="line">Graphics2D gp2D = (Graphics2D) bImg.getGraphics();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置背景⾊为⽩⾊</span></span><br><span class="line">gp2D.setColor(Color.white);</span><br><span class="line">gp2D.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">80</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置图⽚的字体和颜⾊</span></span><br><span class="line">gp2D.setFont(<span class="keyword">new</span> Font(<span class="keyword">null</span>, Font.BOLD, <span class="number">20</span>));</span><br><span class="line">gp2D.setColor(Color.BLUE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//⽣成随机数</span></span><br><span class="line">String randomNum = makeNum();</span><br><span class="line"></span><br><span class="line"><span class="comment">//往这张图⽚上写数据,横坐标是0，纵坐标是20</span></span><br><span class="line">gp2D.drawString(randomNum, <span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将随机数存进Session域中</span></span><br><span class="line">request.getSession().setAttribute(<span class="string">"randomNum"</span>, randomNum);</span><br><span class="line"></span><br><span class="line"><span class="comment">//控制浏览器不缓存该图⽚</span></span><br><span class="line">response.setHeader(<span class="string">"Expires"</span>, <span class="string">"-1"</span>);</span><br><span class="line">response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"no-cache"</span>);</span><br><span class="line">response.setHeader(<span class="string">"Pragma"</span>, <span class="string">"no-cache"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通知浏览器以图⽚的⽅式打开</span></span><br><span class="line">response.setHeader(<span class="string">"Content-type"</span>, <span class="string">"image/jpeg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//把图⽚写给浏览器</span></span><br><span class="line">ImageIO.write(bImg, <span class="string">"jpg"</span>, response.getOutputStream());</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">makeNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//⽣成0-6位的随机数(6个9)</span></span><br><span class="line">    <span class="keyword">int</span> num = random.nextInt(<span class="number">999999</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//验证码的数位全都要6位数，于是将该随机数转换成字符串，不够位数就添加</span></span><br><span class="line">    String randomNum = String.valueOf(num);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使⽤StringBuffer来拼凑字符串</span></span><br><span class="line">    StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span> - randomNum.length(); i++) &#123;</span><br><span class="line">    	stringBuffer.append(i);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> stringBuffer.append(randomNum).toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显示页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/ouzicheng/Login2Servlet"</span>&gt;</span></span><br><span class="line">    ⽤户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    验证码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"randomNum"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/ouzicheng/ImageServlet"</span> &gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>处理提交表单数据的<strong>Servlet</strong>，判断⽤户带过来验证码的数据是否和Session的数据相同。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取⽤户输⼊验证码的数据</span></span><br><span class="line">String client_randomNum = request.getParameter(<span class="string">"randomNum"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取Session中的数据</span></span><br><span class="line">String session_randomNum = (String) request.getSession().getAttribute(<span class="string">"randomNum"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断他俩数据是否相等，⽤户是否有输⼊验证码，Session中是否为空</span></span><br><span class="line"><span class="keyword">if</span> (client_randomNum == <span class="keyword">null</span> || session_randomNum == <span class="keyword">null</span> || !client_randomNum.equals(session_randomNum)) &#123;</span><br><span class="line">    System.out.println(<span class="string">"验证码错误了！！！"</span>);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下⾯就是验证⽤户名和密码...................</span></span><br></pre></td></tr></table></figure>



<h3 id="6-Session和Cookie的区别（面试题）"><a href="#6-Session和Cookie的区别（面试题）" class="headerlink" title="6. Session和Cookie的区别（面试题）"></a>6. Session和Cookie的区别（面试题）</h3><ul>
<li>从存储⽅式上⽐较<ul>
<li>Cookie只能存储字符串，如果要存储⾮ASCII字符串还要对其编码。</li>
<li>Session可以存储任何类型的数据，可以把Session看成是⼀个容器</li>
</ul>
</li>
<li>从隐私安全上⽐较<ul>
<li>Cookie存储在浏览器中，对客户端是可⻅的。信息容易泄露出去。如果使⽤Cookie，最好将Cookie加密</li>
<li>Session存储在服务器上，对客户端是透明的。不存在敏感信息泄露问题。</li>
</ul>
</li>
<li>从有效期上⽐较<ul>
<li>Cookie保存在硬盘中，只需要设置maxAge属性为⽐较⼤的正整数，即使关闭浏览器，Cookie还是存在的</li>
<li>Session的保存在服务器中，设置maxInactiveInterval属性值来确定Session的有效期。<ul>
<li>并且Session依赖于名为JSESSIONID的Cookie，该Cookie默认的maxAge属性为-1。</li>
<li>如果关闭了浏览器，该Session虽然没有从服务器中消亡，但也就失效了。</li>
</ul>
</li>
</ul>
</li>
<li>从对服务器的负担⽐较<ul>
<li>Session是保存在服务器的，每个⽤户都会产⽣⼀个Session，如果是并发访问的⽤户⾮常多，是不能使⽤Session的，Session会消耗⼤量的内存。</li>
<li>Cookie是保存在客户端的。不占⽤服务器的资源。像baidu、Sina这样的⼤型⽹站，⼀般都是使⽤Cookie来进⾏会话跟踪。</li>
</ul>
</li>
<li>从浏览器的⽀持上⽐较<ul>
<li>如果浏览器禁⽤了Cookie，那么Cookie是⽆⽤的了！</li>
<li>如果浏览器禁⽤了Cookie，Session可以通过URL地址重写来进⾏会话跟踪。</li>
</ul>
</li>
<li>从跨域名上⽐较<ul>
<li>Cookie可以设置domain属性来实现跨域名</li>
<li>Session只在当前的域名内有效，不可夸域名</li>
</ul>
</li>
</ul>
<h3 id="7-session和cookie共同使用"><a href="#7-session和cookie共同使用" class="headerlink" title="7. session和cookie共同使用"></a>7. session和cookie共同使用</h3><p>把Cookie保存在硬盘中，即使我关闭了浏览器，浏览器再次访问⻚⾯的时候，可以带上Cookie，从⽽服务器识别出Session。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"JSESSIONID"</span>,session.getId());</span><br><span class="line">cookie.setMaxAge(<span class="number">30</span>*<span class="number">60</span>);</span><br><span class="line">cookie.setPath(<span class="string">"/lwclick/"</span>);</span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="1-Tomcat常⻅⾯试题"><a href="#1-Tomcat常⻅⾯试题" class="headerlink" title="1. Tomcat常⻅⾯试题"></a>1. Tomcat常⻅⾯试题</h3><h4 id="1-1-1-1Tomcat的缺省端⼝是多少，怎么修改"><a href="#1-1-1-1Tomcat的缺省端⼝是多少，怎么修改" class="headerlink" title="1.1 1.1Tomcat的缺省端⼝是多少，怎么修改"></a>1.1 1.1Tomcat的缺省端⼝是多少，怎么修改</h4><p>默认8080 </p>
<ol>
<li><p>找到Tomcat⽬录下的conf⽂件夹</p>
</li>
<li><p>进⼊conf⽂件夹⾥⾯找到server.xml⽂件</p>
</li>
<li><p>打开server.xml⽂件</p>
</li>
<li><p>在server.xml⽂件⾥⾯找到下列信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="1-2-Tomcat-有哪⼏种Connector-运⾏模式-优化-？"><a href="#1-2-Tomcat-有哪⼏种Connector-运⾏模式-优化-？" class="headerlink" title="1.2 Tomcat 有哪⼏种Connector 运⾏模式(优化)？"></a>1.2 Tomcat 有哪⼏种Connector 运⾏模式(优化)？</h4><ol>
<li>bio(blocking I/O)</li>
<li>nio(non-blocking I/O)</li>
<li>apr(Apache Portable Runtime/Apache可移植运⾏库)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tomcat将以JNI的形式调⽤Apache HTTP服务器的核⼼动态链接库来处理⽂件读取或⽹络传输操作，从⽽⼤⼤地 提⾼Tomcat对静态⽂件的处理性能</span><br></pre></td></tr></table></figure>



<h3 id="2-Servlet⾯试题"><a href="#2-Servlet⾯试题" class="headerlink" title="2.Servlet⾯试题"></a>2.Servlet⾯试题</h3><h4 id="2-1-get式和post⽅式有何区别"><a href="#2-1-get式和post⽅式有何区别" class="headerlink" title="2.1 get式和post⽅式有何区别"></a>2.1 get式和post⽅式有何区别</h4><p>数据携带上:<br>GET⽅式：在URL地址后附带的参数是有限制的，其数据容量通常不能超过1K。<br>POST⽅式：可以在请求的实体内容中向服务器发送数据，传送的数据量⽆限制。<br>请求参数的位置上:<br>GET⽅式：请求参数放在URL地址后⾯，以?的⽅式来进⾏拼接<br>POST⽅式:请求参数放在HTTP请求包中<br>⽤途上:<br>GET⽅式⼀般⽤来获取数据<br>POST⽅式⼀般⽤来提交数据<br>原因:<br>⾸先是因为GET⽅式携带的数据量⽐较⼩，⽆法带过去很⼤的数量<br>POST⽅式提交的参数后台更加容易解析(使⽤POST⽅式提交的中⽂数据，后台也更加容<br>易解决)<br>GET⽅式⽐POST⽅式要快</p>
<h4 id="2-2-tomcat容器是如何创建servlet类实例？"><a href="#2-2-tomcat容器是如何创建servlet类实例？" class="headerlink" title="2.2 tomcat容器是如何创建servlet类实例？"></a>2.2 tomcat容器是如何创建servlet类实例？</h4><ol>
<li>当容器启动时，会读取在webapps⽬录下所有的web应⽤中的web.xml⽂件，然后对 xml⽂件进⾏解析，并读取servlet注册信息。然后，将每个应⽤中注册的servlet类都进⾏加载，并通过 <strong>反射</strong> 的⽅式实例化。（有时候也是在第⼀次请求时实例化）</li>
<li>在servlet注册时加上<load-on-startup> 1 </load-on-startup> 如果为<strong>正数</strong>，则在⼀开始就实例化，如果不写或为负数，则第⼀次请求实例化。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/Redis/" itemprop="url">redis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:58:28+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/Redis/" class="leancloud_visitors" data-flag-title="redis">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h2><h3 id="1-NoSQL简介"><a href="#1-NoSQL简介" class="headerlink" title="1. NoSQL简介"></a>1. NoSQL简介</h3><p>泛指<strong>非关系型数据库</strong>：</p>
<ul>
<li>键值（key-value）存储数据库：使用到一个<strong>哈希表</strong>，这个表中有一个特定的键和指针指向特定的数据<ul>
<li>Redis，  voldmort，  oracle  BDB</li>
</ul>
</li>
<li>列存储数据库：分布式存储的海量数据。<ul>
<li>Hbase，riak</li>
</ul>
</li>
<li>文档型数据库：数据模型是版本化的文档，半结构化的文档以特定的格式存储，如JSON。 <ul>
<li>MongoDB，  couchDB</li>
</ul>
</li>
<li>图形数据库 ：图形模型，可以扩展到多个服务器上。<ul>
<li>Neo4J， InfoGrid</li>
</ul>
</li>
</ul>
<h3 id="2-非关系型数据库特点"><a href="#2-非关系型数据库特点" class="headerlink" title="2. 非关系型数据库特点"></a>2. 非关系型数据库特点</h3><ul>
<li><strong>数据模型</strong>比较简单，就是一个key对应一个value</li>
<li>对数据库性能要求较高</li>
<li>不需要高度的数据一致性，对ACID的处理非常简单</li>
<li>对于给定的key，比较容易映射复杂值的环境</li>
</ul>
<h3 id="3-Redis简介"><a href="#3-Redis简介" class="headerlink" title="3. Redis简介"></a>3. Redis简介</h3><p>将数据放到  <strong>缓存</strong>  中，<strong>内存级别的读写</strong>，速度快，给数据库降压                 <strong>16个数据库，数据安全，存储不同类型</strong></p>
<ol>
<li><p>以<strong>key - value</strong> 形式存储，放到<strong>内存</strong>中进行读写，可以对数据<strong>高并发读写</strong>，对海量数据的高效率存储和访问，对数据的可扩展性（水平扩展[加主机]，垂直扩展[加硬盘]）和高可用性（多个主节点）</p>
<p><strong>三种策略模式：</strong></p>
<ul>
<li>主从： 主机可读可写，从机只可读</li>
<li>哨兵（2.0）： 一台机器监控另外的主从，当主机出故障时，自动选择一个<strong>从变为主</strong>（每个节点都是所有的数据）</li>
<li>集群（3.0）： 数据均匀分到主节点上，主节点出故障，将数据转移到从节点，并升级为主节点</li>
</ul>
</li>
<li><p>key可以是：字符串(string)、哈希、链表(list)、集合(set)、有序集合(zset)</p>
</li>
<li><p>可靠性理解：数据都是<strong>缓存在内存</strong>中，<strong>定期存到硬盘上（RDB）</strong>   或者<strong>执行DML操作时，就写日志（AOF）</strong> </p>
</li>
</ol>
<p>Redis串行：多实例只能一个个的执行。      Redis结合ssdb实现业务</p>
<p>Memcached并行：多个实例可同时运行。</p>
<h3 id="4-安装Redis（linux）"><a href="#4-安装Redis（linux）" class="headerlink" title="4. 安装Redis（linux）"></a>4. 安装Redis（linux）</h3><ol>
<li><p>下载地址： <a href="http://redis.io/download" target="_blank" rel="noopener">http://redis.io/download</a></p>
</li>
<li><p>安装步骤：</p>
<ul>
<li><p>需要有GCC支持，将redis包放到 user/local/个人文件夹下</p>
</li>
<li><p>解压 <code>tar -zxvf redis-3.0.0-rc2.tar.gz</code></p>
</li>
<li><p>进入到redis-3.0.0目录下，进行编译 <code>make</code></p>
</li>
<li><p>进入到src下进行安装 <code>make install</code> ，在src的目录下，有redis-server(启动) 和 redis-cil(登录)即为安装成功</p>
</li>
<li><p>建立两个文件夹存放redis命令和配置文件</p>
<ul>
<li><code>mkdir -p /lwclick/redis/etc</code></li>
<li><code>mkdir -p /lwclick/redis/bin</code></li>
</ul>
</li>
<li><p>把redis-3.0.0/src下的<strong>redis.conf</strong>移动到/user/local/lwclick/redis/etc下</p>
<ul>
<li><code>cp redis.conf  /user/local/lwclick/redis/etc</code></li>
</ul>
</li>
<li><p>把redis-3.0.0/src下的 文件移动到bin下</p>
<ul>
<li><code>mv  ...  /lwclick/redis/bin</code></li>
</ul>
</li>
<li><p>修改redis.conf配置文件</p>
<ul>
<li>配置成后台启动：redis.conf里的<strong>daemonize</strong>参数为yes（在最开始）</li>
<li>修改文件存放位置：修改<strong>dir</strong>参数为对应目录</li>
<li>AOF模式：<strong>appendonly</strong>参数为yes</li>
</ul>
</li>
<li><p><strong>启动</strong>：<code>/usr/local/lwclick/redis/bin/redis-server  /usr/local/redis/etc/redis.conf</code></p>
<p><strong>进入redis客户端</strong>： redis-cli       退出quit</p>
<p><strong>退出redis服务</strong>：pkill redis-server</p>
</li>
</ul>
</li>
<li><p>linux进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看程序的进程号码</span><br><span class="line">netstat -tunpl | grep 程序</span><br><span class="line">	</span><br><span class="line">杀掉对应的进程</span><br><span class="line">kill -9 进程号</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="Redis-基本数据类型"><a href="#Redis-基本数据类型" class="headerlink" title="Redis 基本数据类型"></a>Redis 基本数据类型</h2><h3 id="1-String类型"><a href="#1-String类型" class="headerlink" title="1. String类型"></a>1. String类型</h3><ul>
<li>设置值：<code>set name lwclick</code>    <strong>name为key值</strong><ul>
<li>设置值：<code>setnx name 111</code>key如果不存在就进行设置，  如果存在就不设置，返回0</li>
</ul>
</li>
<li>获取值：<code>get name</code></li>
<li>删除值：<code>del name</code></li>
<li>设置过期时间：<code>setex name 10 lw</code>         10s后过期，变为nil</li>
<li>替换字符串：<code>setrange email 10 ww</code>    从第10位开始替换，替换为ww（索引从0开始）</li>
<li>设置多个值：<code>mset name1 hello name2 world</code></li>
<li>获取多个值：<code>mget name1 name2 email</code></li>
<li>对值进行自增：<ul>
<li>自增1步：<code>incr age</code></li>
<li>自增n步：<code>incrby age n</code></li>
</ul>
</li>
<li>追加字符串：<code>append name click</code></li>
<li>获取长度：<code>strlen name</code></li>
</ul>
<h3 id="2-Hash类型（重点）"><a href="#2-Hash类型（重点）" class="headerlink" title="2. Hash类型（重点）"></a>2. Hash类型（重点）</h3><p>String的集合（key1 value1    key2 value2 …）,特别<strong>适合存储对象</strong>，占用内存空间少</p>
<p><strong>整存整取：</strong>uuid对应一个jso         <strong>取单独几个字段：</strong>整个hash，里面设置id，name，age….</p>
<ul>
<li><p>设置值：<code>hset  hash的名字  key  value</code>         <strong>也有hsetnx</strong></p>
<ul>
<li><code>hset user id 1</code>      <code>hset user name lw</code></li>
</ul>
</li>
<li><p>获取值：<code>hget hash的名字 key</code></p>
</li>
<li><p>批量设置：<code>hmset user id 2 name z3 age 20</code></p>
</li>
<li><p>批量获取：<code>hmget user id name age</code></p>
</li>
<li><p>判断是否存在key：<code>hexists user age</code></p>
</li>
<li><p>返回hash集合里的所有的键数值：<code>hlen user</code></p>
</li>
<li><p>删除：<code>hdel user age</code></p>
</li>
<li><p>获取所有的key：<code>hkeys user</code></p>
</li>
<li><p>获取所有的value：<code>hvals</code></p>
</li>
</ul>
<h3 id="3-List类型"><a href="#3-List类型" class="headerlink" title="3. List类型"></a>3. List类型</h3><p>链表结构的集合，主要功能有push、pop、获取元素等。 <strong>元素允许重复</strong>   既可以作为<strong>队列</strong>，又可以作为<strong>栈</strong></p>
<ul>
<li><p>查看元素：<code>lrange list1 0 -1</code>    <strong>从头取到末尾</strong></p>
</li>
<li><p>从头部添加元素（<strong>栈</strong>）:<code>lpush list1 hello</code></p>
</li>
<li><p>从尾部添加元素（<strong>队列</strong>）：<code>rpush list2 world</code></p>
</li>
<li><p>插入元素：<code>linsert list2 before world nihao</code></p>
</li>
<li><p>从头部删除元素：<code>lpop</code></p>
</li>
<li><p>从尾部删除：<code>rpop</code></p>
</li>
<li><p>返回名称为key的list中index位置的元素：<code>lindex list2 1</code></p>
</li>
</ul>
<h3 id="4-set类型"><a href="#4-set类型" class="headerlink" title="4. set类型"></a>4. set类型</h3><p>是string类型的<strong>无序集合</strong>，是通过hashtable实现的， <strong>元素不允许重复</strong>     可以取<strong>交集、并集、差集</strong></p>
<ul>
<li>添加元素：<code>sadd set1 aaa</code>          <strong>不允许添加重复的</strong></li>
<li>查看元素：<code>smembers set1</code></li>
<li>删除元素：<code>srem</code></li>
<li>交集：sinter       并集：sunion</li>
<li>元素个数：<code>scard</code></li>
</ul>
<h3 id="5-zset类型"><a href="#5-zset类型" class="headerlink" title="5. zset类型"></a>5. zset类型</h3><p><strong>有序的集合</strong>                可以做  搜索排行 rank（先过滤再排行）</p>
<ul>
<li>添加元素：<code>zadd zset1 序号 值</code></li>
<li>查看元素：<code>zrange zset1 0 -1</code>              … withscores</li>
<li>删除元素：<code>zrem zset1 值</code></li>
<li><strong>找到指定区间范围的数据进行返回</strong>：<code>zrangebyscore</code></li>
<li>返回排序索引：<code>zrank zset1 two</code></li>
<li>元素个数：<code>zcard</code></li>
<li>给定区间中的元素个数：<code>zcount</code></li>
<li>删除指定序号：<code>zremrangebyscore zset [from] [to]</code></li>
</ul>
<hr>
<h2 id="redis高级命令"><a href="#redis高级命令" class="headerlink" title="redis高级命令"></a>redis高级命令</h2><ul>
<li>返回所有key（模糊查找）：         <code>key *</code></li>
<li>是否存在key：                                <code>exists key</code></li>
<li>设置key的过期时间：                     <code>expire key  过期时间</code>      使用 ttl 查看剩余时间</li>
<li>取消过期时间：                               <code>persist key</code></li>
<li>选择数据库：                                   <code>select 0-15</code></li>
<li>转移数据：                                       <code>move key 数据库下标</code></li>
<li>重命名key：                                     <code>rename name name1</code></li>
<li>打印命令：                                       <code>echo</code></li>
<li>查看数据库的key数量：                  <code>dbsize</code></li>
<li>获取数据库信息：                            <code>info</code></li>
<li>清空当前数据库：                            <code>flushdb</code>                清空所有：<code>flushall</code></li>
<li>获取redis.config的信息：               <code>config get *</code></li>
</ul>
<p>安全性：</p>
<ul>
<li>设置密码：     <code>vim /usr/local/lwclick/redis/etc/resdis.config</code><ul>
<li>搜索：  <code>:/requirepass foobared</code></li>
<li>修改： <code>requirepass  密码</code></li>
<li>进入cli端输入密码：<code>redis-cli -a 密码</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>实现<strong>读写</strong>分离，从服务器只读</p>
<ul>
<li>master可以拥有多个slave</li>
<li>多个slave不仅可以连接同一个master，还可以连接到其他的slave</li>
</ul>
<p>过程：</p>
<ul>
<li>slave与master建立连接，发送sync同步命令</li>
<li>master开启一个后台进程，将数据库快照保存到文件中，同时master主进程开始收集新的写命令并缓存</li>
<li>后台完成保存后，将文件发送给slave</li>
<li>slave将此文件保存到硬盘上</li>
</ul>
<p>主从复制的配置：</p>
<ul>
<li>克隆一台服务器：  虚拟机上右击  –&gt;  克隆  –&gt; 修改mac地址</li>
<li>远程复制：  <code>scp -r 文件/ 192.168.191.66:/复制到的位置</code></li>
<li>修改从服务器的配置文件redis.config中的slaveof属性<ul>
<li><code>slaveof   主服务器的ip  主服务器的端口号</code></li>
</ul>
</li>
<li>启动所有服务器的redis</li>
</ul>
<hr>
<h2 id="哨兵"><a href="#哨兵" class="headerlink" title="哨兵"></a>哨兵</h2><p>有了主从复制后，想对主服务器进行监控。</p>
<p>功能：</p>
<ul>
<li>监控主数据库和从数据库是否正常运行</li>
<li>主数据库发生故障时，可以自动将从数据库转换为主数据库</li>
</ul>
<p>步骤（在其中一台从服务器上配置sentinel.conf）：</p>
<ul>
<li><p>copy文件sentinel.conf到 redis/etc下</p>
</li>
<li><p>修改sentinel.conf文件：</p>
<ul>
<li><code>sentinel monitor mymaster 192.168.191.66 6379 1  # 名称  ip  端口  投票选举次数</code></li>
<li><code>sentinel down-after-milliseconds mymaster 5000  #检测间隔</code></li>
<li><code>sentinel failover-timeout mymaster 90000</code></li>
<li><code>sentinel parallel-syncs mymaster 2</code></li>
<li><code>sentinel can-failover mymaster yes</code></li>
</ul>
</li>
<li><p>启动sentinel哨兵</p>
<p><code>redis-server sentinel.config --sentinel &amp;</code></p>
</li>
<li><p>关闭主服务器查看集群信息</p>
<p><code>redis-cli -h 主服务器ip -p 6379 shutdown</code></p>
</li>
</ul>
<hr>
<h2 id="持久化机制"><a href="#持久化机制" class="headerlink" title="持久化机制"></a>持久化机制</h2><p>redis需要经常将内存中的数据同步到硬盘中来保证持久化</p>
<ul>
<li>snapshotting（<strong>RDB</strong>）：默认方式<ul>
<li>将内存中以快照的方式写入到二进制文件中，默认为dump.rdb</li>
<li>可以配置redis在n秒内如果超过m个key就自动做快照<ul>
<li><code>save  多少秒  多少个key</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>append-only file（<strong>AOF</strong>）：类似于oracle的<strong>日志</strong><ul>
<li>redis会将每个收到的写命令通过write追加到命令</li>
<li><strong>aof不是立即写到硬盘上</strong></li>
<li>开启AOF：<code>appendonly yes</code></li>
<li>3种配置方式：<ul>
<li><strong><code>appendfsync always</code>      收到写命令就立即写入到appendonly.aof，效率最慢（结合ssdb解决）</strong></li>
<li><code>appendfsync everysec</code>    每秒写入appendonly.aof一次</li>
<li><code>appendfsync no</code>                完全依赖于os，持久化没保证</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="发布与订阅消息"><a href="#发布与订阅消息" class="headerlink" title="发布与订阅消息"></a>发布与订阅消息</h2><p>订阅监听：                   <code>subscribe  [频道]</code></p>
<p>发布消息广播：            <code>publish  [频道] [发布内容]</code></p>
<h2 id="简单事务"><a href="#简单事务" class="headerlink" title="简单事务"></a>简单事务</h2><p>使用<strong>multi</strong>打开事务，然后进行<strong>set等方法</strong>，最后使用<strong>exec</strong>执行，使用<strong>discard</strong>取消事务</p>
<hr>
<h2 id="redis使用JavaAPI"><a href="#redis使用JavaAPI" class="headerlink" title="redis使用JavaAPI"></a>redis使用JavaAPI</h2><p>jar包：<strong>jedis</strong></p>
<ol>
<li><p>单独连接1台redis服务器</p>
<p><code>Jedis j = new Jedis(&quot;192.168.191.66&quot;, 6379);</code></p>
<p><code>j.mget(&quot;name&quot;, &quot;age&quot;);</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">map.put(<span class="string">"name"</span>, <span class="string">"lwclick"</span>);</span><br><span class="line">map.put(<span class="string">"age"</span>, <span class="string">"22"</span>);</span><br><span class="line">map.put(<span class="string">"qq"</span>, <span class="string">"123"</span>);</span><br><span class="line">j.hmset(<span class="string">"user"</span>, map);</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>主从，哨兵使用shard</p>
</li>
<li><p>连接池</p>
</li>
</ol>
<p>User对象 数据量很大，查询很频繁        需要把user表里的数据都放入缓存中去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">String u1id = UUID.randomUUID().toString();</span><br><span class="line">User u1 = <span class="keyword">new</span> User(u1id, name, age);</span><br><span class="line">map.put(u1id, FastJsonConvert.convertObjectToJSON(u1));</span><br><span class="line"></span><br><span class="line">String u2id = UUID.randomUUID().toString();</span><br><span class="line">User u2 = <span class="keyword">new</span> User(u2id, name, age);</span><br><span class="line">map.put(u2id, FastJsonConvert.convertObjectToJSON(u2));</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">j.hmset(<span class="string">"users"</span>, map);</span><br></pre></td></tr></table></figure>



<p>如果需要搜索，过滤(select * from user where age = 25 and name = lw)，需要多种集合配合使用     <strong>hash和set同时使用</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/MySQL/" itemprop="url">MySQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:58:08+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/MySQL/" class="leancloud_visitors" data-flag-title="MySQL">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  36
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、关系数据库概述"><a href="#一、关系数据库概述" class="headerlink" title="一、关系数据库概述"></a>一、关系数据库概述</h2><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><ul>
<li>层次模型（树状）</li>
<li>网状模型</li>
<li><strong>关系模型（二维表格，重点）</strong></li>
</ul>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/789A12D56B031F0F35F6C850C97E2C83.png" alt="789A12D56B031F0F35F6C850C97E2C83"></p>
<h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4><ol>
<li>INT：整型  4</li>
<li><strong>BIGINT</strong>: 长整型  8    <strong><em>常用</em></strong></li>
<li>REAL: 浮点型  4</li>
<li><strong>DOUBLE</strong>: 浮点型  8</li>
<li><strong>DECIMAL(M, N)</strong>: 高精度小数  共20位，其中小数10位</li>
<li>CHAR: 定长字符串</li>
<li><strong>VARCHAR</strong>: 变长字符串</li>
<li>BOOLEAN</li>
<li><strong>DATE</strong></li>
<li>TIME</li>
<li>DATETIME</li>
</ol>
<h4 id="SQL-Structured-Query-Language"><a href="#SQL-Structured-Query-Language" class="headerlink" title="SQL (Structured Query Language)"></a>SQL (Structured Query Language)</h4><ol>
<li>Oracle把自己扩展的SQL称为 <strong>PL/SQL</strong></li>
<li><strong>DDL(Data Definition Language)</strong>：创建、删除、修改表结构                   <em>数据库管理员</em></li>
<li><strong>DML(Data Manipulation Language)</strong>: 添加、删除、更新数据的能力      <em>应用程序对数据库的操作</em></li>
<li><strong>DQL(Data Query Language)</strong>: 用户查询数据                                                <em>用户</em></li>
</ol>
<h4 id="CRUD：Create、Retrieve、Update、Delete"><a href="#CRUD：Create、Retrieve、Update、Delete" class="headerlink" title="CRUD：Create、Retrieve、Update、Delete"></a>CRUD：Create、Retrieve、Update、Delete</h4><h4 id="良好习惯"><a href="#良好习惯" class="headerlink" title="良好习惯"></a>良好习惯</h4><p><strong>SQL关键字总是大写，表名和列名均使用小写。</strong></p>
<hr>
<h2 id="二、关系模型"><a href="#二、关系模型" class="headerlink" title="二、关系模型"></a>二、关系模型</h2><ol>
<li><strong>记录</strong>：表的每一行</li>
<li><strong>字段</strong>：表的每一列（字段应该避免允许为NULL）</li>
</ol>
<h4 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h4><ol>
<li><p><strong>定义</strong>：能够唯一标识一条记录的某个字段</p>
</li>
<li><p><strong>基本原则</strong>：不使用任何业务相关的字段作为主键，一般使用<strong>id</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INT NOT NULL AUTO_INCREMENT</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="联合主键（不常用）"><a href="#联合主键（不常用）" class="headerlink" title="联合主键（不常用）"></a>联合主键（不常用）</h4><p>通过多个字段唯一标识记录，允许一列有重复，只要不是所有主键列都重复即可</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/A395E4275EB52FC7CA4D380EAE35B825.png" alt="A395E4275EB52FC7CA4D380EAE35B825" style="zoom:80%;" />



<h4 id="外键（也可以不设置约束，仅依靠应用程序的逻辑来保证）"><a href="#外键（也可以不设置约束，仅依靠应用程序的逻辑来保证）" class="headerlink" title="外键（也可以不设置约束，仅依靠应用程序的逻辑来保证）"></a>外键（也可以不设置约束，仅依靠应用程序的逻辑来保证）</h4><ol>
<li><p><strong>一对多关系</strong>（一个班级对应多名学生）</p>
<p>在 <strong>多</strong> 的表里首先添加一个字段</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">创建外键约束：</span><br><span class="line">    ALTER TABLE 多的表名</span><br><span class="line">    ADD CONSTRAINT 外键约束名</span><br><span class="line">    FOREIGN KEY (作为外键的字段)</span><br><span class="line">    REFERENCES 一的表名 (主键);</span><br><span class="line">删除外键约束：</span><br><span class="line">	ALTER TABLE students</span><br><span class="line">	DROP FOREIGN KEY fk_class_id;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p><strong>多对多关系</strong>（一个老师对应多个班级，一个班级对应多个老师）</p>
<p>创建一个中间表（<em>建立两个一对多的关系</em>）</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">teachers表：</span><br><span class="line">	id   name</span><br><span class="line">classes表：</span><br><span class="line">	id   name</span><br><span class="line">teacher_classes表：</span><br><span class="line">	id   teacher_id    class_id</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><strong>一对一关系</strong>（一个表的记录对应到另一个表的唯一一个记录，一个学生对应一个电话号码）</p>
<p>用于将<strong>常读取</strong>和<strong>不常读取</strong>字段分开，提高查询速度</p>
</li>
</ol>
<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><p>关系数据库中对某一列或多个列的值进行<strong>预排序</strong>的数据结构</p>
<p>值越不相同，索引效率越高</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">创建索引：</span><br><span class="line">	ALTER TABLE students</span><br><span class="line">	ADD INDEX 索引名称 (需要创建索引的列);</span><br></pre></td></tr></table></figure>

<p><strong>唯一索引</strong>：不宜作为主键，但具有唯一性约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">唯一索引：</span><br><span class="line">	ALTER TABLE students</span><br><span class="line">	ADD UNIQUE INDEX 唯一索引名称 (建立唯一索引的列);</span><br><span class="line">唯一约束：</span><br><span class="line">	ALTER TABLE students</span><br><span class="line">	ADD CONSTRAINT 唯一约束的名称 UNIQUE (建立唯一约束的列);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、查询数据-DQL"><a href="#三、查询数据-DQL" class="headerlink" title="三、查询数据(DQL)"></a>三、查询数据(DQL)</h2><h4 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">classes表：</span><br><span class="line">    CREATE TABLE classes (</span><br><span class="line">    id BIGINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(100) NOT NULL,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">    ) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">students表：</span><br><span class="line">	CREATE TABLE students(</span><br><span class="line">    id INT NOT NULL AUTO_INCREMENT,</span><br><span class="line">    class_id INT NOT NULL,</span><br><span class="line">    name VARCHAR(10) NOT NULL, </span><br><span class="line">    gender VARCHAR(1) NOT NULL,</span><br><span class="line">    scoure INT NOT NULL,</span><br><span class="line">    PRIMARY KEY(id)</span><br><span class="line">    ) ENGINE&#x3D;INNODB DEFAULT CHARSET&#x3D;UTF8;</span><br></pre></td></tr></table></figure>



<h4 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h4><ol>
<li><p>查询所有</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>测试数据库连接</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 1;</span><br></pre></td></tr></table></figure></code></pre></li>
</ol>
<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><ol>
<li><p>获取成绩在80分以上的</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE score &gt;&#x3D; 80;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>获取成绩在80分以上且是“男生”</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE score &gt;&#x3D; 80 AND gender &#x3D; &#39;M&#39;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>获取成绩在80分以上或者是“男生”</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE score &gt;&#x3D; 80 OR gender &#x3D; &#39;M&#39;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="4">
<li><p>获取班级不为1的</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE class_id &lt;&gt; 1;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="5">
<li><p>获取分数在80以下或者90以上，并且是男生</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE (score &lt; 80 OR score &gt; 90) AND gender &#x3D; &#39;M&#39;;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="6">
<li><p>获取名字带“王”的<strong>（LIKE  ‘%王’）</strong></p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE name LIKE &quot;%王%&quot;;</span><br></pre></td></tr></table></figure></code></pre></li>
</ol>
<ol start="7">
<li><p>获取分数在80到90之间的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students WHERE score Between 80 AND 90;</span><br></pre></td></tr></table></figure>





</li>
</ol>
<h4 id="投影查询"><a href="#投影查询" class="headerlink" title="投影查询"></a>投影查询</h4><ol>
<li><p>获取指定列并将name列改为stuName</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name stuName, score FROM students;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>获取指定列，且是男生</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name stuName, score FROM students WHERE gender &#x3D; &#39;M&#39;;</span><br></pre></td></tr></table></figure></code></pre><p>​    </p>
</li>
</ol>
<h4 id="排序（默认按照主键排序）"><a href="#排序（默认按照主键排序）" class="headerlink" title="排序（默认按照主键排序）"></a>排序（默认按照主键排序）</h4><ol>
<li><p>根据成绩排序（默认从低到高 <strong>ORDER BY</strong>）</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students ORDER BY score;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>根据成绩排序（从高到低）</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, score FROM students ORDER BY score DESC;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>先根据成绩升序排列，如果成绩有相同的，再按性别降序排列排序</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score FROM students ORDER BY score ASC,  gender DESC;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="4">
<li><p>查询一班的学生成绩，并按照倒序排列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score</span><br><span class="line">FROM students</span><br><span class="line">WHERE class_id &#x3D; 1</span><br><span class="line">ORDER BY score DESC;</span><br></pre></td></tr></table></figure>




</li>
</ol>
<h4 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h4><ol>
<li><p>查询学生的成绩，分页显示，从第1条显示，每页最多显示3条(<strong>LIMIT 3 OFFSET 0;</strong>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, gender, score</span><br><span class="line">FROM students</span><br><span class="line">ORDER BY score DESC</span><br><span class="line">LIMIT 3 OFFSET 0;</span><br></pre></td></tr></table></figure>
</li>
<li><p>每页的开始<strong>OFFSET = 每页要显示的条数 * （当前页码 - 1）</strong></p>
</li>
</ol>
<h5 id="从-OFFSET-条开始显示，每页有-LIMIT-条"><a href="#从-OFFSET-条开始显示，每页有-LIMIT-条" class="headerlink" title="从 OFFSET 条开始显示，每页有 LIMIT 条"></a>从 <strong><em>OFFSET</em></strong> 条开始显示，每页有 <strong><em>LIMIT</em></strong> 条</h5><h4 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h4><ol>
<li><p>查询表中共有多少行数据，以num显示</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) num FROM students;</span><br><span class="line">SELECT COUNT(1) num FROM students;     蜜汁快一点</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>查询有多少男生</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(id) boys FROM students WHERE gender &#x3D; &#39;M&#39;;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li>其他聚合函数</li>
</ol>
<p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/EC4CA9781B509E9B97746412D513B6F6.png" alt="EC4CA9781B509E9B97746412D513B6F6"></p>
<ol start="4">
<li><p>使用AVG查询男生的平均成绩（<strong>聚合查询使用WHERE条件</strong>）</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT AVG(score) average FROM students WHERE gender &#x3D; &#39;M&#39;;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="5">
<li><p>每页3条记录，通过聚合查询获得总页数</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CEILING(COUNT(*) &#x2F; 3) FROM students;</span><br></pre></td></tr></table></figure></code></pre><p>​    </p>
</li>
</ol>
<h4 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h4><ol>
<li><p>查询每个班级的人数</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT class_id, COUNT(*) num FROM students GROUP BY class_id;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>每个班级的平均分</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT class_id, AVG(score) ave FROM students GROUP BY class_id;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>每个班级男生女生的平均分，降序排列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT class_id, gender, AVG(score) ave </span><br><span class="line">FROM students </span><br><span class="line">GROUP BY class_id, gender</span><br><span class="line">ORDER BY ave DESC;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="分组过滤查询"><a href="#分组过滤查询" class="headerlink" title="分组过滤查询"></a>分组过滤查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select fieldName</span><br><span class="line">from tbName</span><br><span class="line">where condition_</span><br><span class="line">group by 分组要求</span><br><span class="line">having 过滤规则;         例如，班级为1， 学号为1， 2， 3之中的人的成绩</span><br></pre></td></tr></table></figure>



<h4 id="多表查询-慎用"><a href="#多表查询-慎用" class="headerlink" title="多表查询(慎用)"></a>多表查询(慎用)</h4><ol>
<li><p>查询两个表中的属性（笛卡尔积）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">	s.id sid,</span><br><span class="line">	s.name sname,</span><br><span class="line">	s.score,</span><br><span class="line">	c.name cname</span><br><span class="line">FROM students s, classes c</span><br><span class="line">WHERE s.gender &#x3D; &#39;M&#39; AND c.id &#x3D; 1;</span><br></pre></td></tr></table></figure>




</li>
</ol>
<h4 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h4><p><strong><em>先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上</em></strong></p>
<h5 id="1-内连接（INNER-JOIN）-—-只返回同时存在于两张表的行数据"><a href="#1-内连接（INNER-JOIN）-—-只返回同时存在于两张表的行数据" class="headerlink" title="1.内连接（INNER JOIN） —  只返回同时存在于两张表的行数据"></a>1.<strong>内连接（INNER JOIN）</strong> —  只返回同时存在于两张表的行数据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1&gt; 先确定主表                    FROM 表1</span><br><span class="line">2&gt; 再确定需要连接的表             INNER JOIN &lt;表2&gt;</span><br><span class="line">3&gt; 确定连接条件                   ON &lt;条件。。。&gt;</span><br><span class="line">4&gt; 根据情况再加WHERE 或者 ORDER BY</span><br><span class="line">	SELECT ... </span><br><span class="line">	FROM &lt;表1&gt; </span><br><span class="line">	INNER JOIN &lt;表2&gt; </span><br><span class="line">	INNER JOIN &lt;表3&gt; </span><br><span class="line">	ON &lt;条件...&gt;</span><br></pre></td></tr></table></figure>

<p>查询所有学生，同时返回班级名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.id, s.name, c.name class_name, s.gender, s.score</span><br><span class="line">FROM students s</span><br><span class="line">INNER JOIN classes c</span><br><span class="line">ON s.class_id &#x3D; c.id;</span><br></pre></td></tr></table></figure>

<h5 id="2-外连接（OUTER-JOIN）"><a href="#2-外连接（OUTER-JOIN）" class="headerlink" title="2.外连接（OUTER JOIN）"></a>2.外连接（OUTER JOIN）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">右外连接： ---  返回右表都存在的行，若一行仅在右表有，那么以 NULL 填充剩余字段</span><br><span class="line">	SELECT s.id, s.name, c.name class_name, s.gender, s.score</span><br><span class="line">    FROM students s</span><br><span class="line">    RIGHT OUTER JOIN classes c</span><br><span class="line">    ON s.class_id &#x3D; c.id;</span><br><span class="line">左外连接： ---  返回左表都存在的行</span><br><span class="line"></span><br><span class="line">全外连接： ---  把两张表的所有记录全部选择出来，并且，自动把对方不存在的列填充为NULL</span><br></pre></td></tr></table></figure>



<h4 id="分支结构查询"><a href="#分支结构查询" class="headerlink" title="分支结构查询"></a>分支结构查询</h4><p><strong>从case开始，到end结束。满足条件对应一个结果，类似于Java中的switch case</strong></p>
<p>查询姓名，成绩以及成绩对应的等级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT name, score,</span><br><span class="line">CASE</span><br><span class="line">	WHEN score &gt;&#x3D; 90 THEN &#39;A&#39;</span><br><span class="line">	WHEN score &gt;&#x3D; 80 AND score &lt; 90 THEN &#39;B&#39;</span><br><span class="line">	WHEN score &gt;&#x3D; 70 AND score &lt; 80 THEN &#39;C&#39;</span><br><span class="line">	WHEN score &lt; 70 THEN &#39;D&#39;</span><br><span class="line">END AS &#39;level&#39;</span><br><span class="line">from students;</span><br></pre></td></tr></table></figure>



<h4 id="时间查询"><a href="#时间查询" class="headerlink" title="时间查询"></a>时间查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select sysdate();                          当前系统时间(年，月，日, 时，分，秒)</span><br><span class="line">select curdate();                          当前日期</span><br><span class="line">select curtime();                          当前时间</span><br><span class="line">select week();                             指定日期是这一年的第几周</span><br></pre></td></tr></table></figure>



<h4 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h4><ol>
<li>查询成绩高于小明的学生id和姓名</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT score</span><br><span class="line">FROM students</span><br><span class="line">WHERE name &#x3D; &#39;小明&#39;;</span><br><span class="line"></span><br><span class="line">SELECT id, name</span><br><span class="line">FROM students</span><br><span class="line">WHERE score &gt; 90;</span><br><span class="line"></span><br><span class="line">整合一下：</span><br><span class="line">	SELECT id, name</span><br><span class="line">    FROM students</span><br><span class="line">    WHERE score &gt; (SELECT score</span><br><span class="line">        FROM students</span><br><span class="line">        WHERE name &#x3D; &#39;小明&#39;);</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>查询学生成绩前5名的信息（子查询结果作为一张表，从表内查询指定数据）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, score         与下面的select语句一样</span><br><span class="line">FROM (SELECT id, name, score</span><br><span class="line">			FROM students</span><br><span class="line">			ORDER BY score DESC) as tmp</span><br><span class="line">LIMIT 5;</span><br></pre></td></tr></table></figure>



<h2 id="四、修改数据（DML）"><a href="#四、修改数据（DML）" class="headerlink" title="四、修改数据（DML）"></a>四、修改数据（DML）</h2><h4 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &lt;表名&gt; (字段1, 字段2, ...) VALUES (值1, 值2, ...);</span><br></pre></td></tr></table></figure>

<p>向学生表中插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students (class_id, name, gender, score) </span><br><span class="line">VALUES</span><br><span class="line">  (1, &#39;大宝&#39;, &#39;M&#39;, 87),</span><br><span class="line">  (2, &#39;二宝&#39;, &#39;M&#39;, 81);</span><br></pre></td></tr></table></figure>



<h4 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE &lt;表名&gt; SET 字段1&#x3D;值1, 字段2&#x3D;值2, ... WHERE ...;</span><br></pre></td></tr></table></figure>

<ol>
<li>更新id为1的学生的信息</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE students </span><br><span class="line">SET name&#x3D;&#39;大牛&#39;, score&#x3D;66 </span><br><span class="line">WHERE id&#x3D;1;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>把所有60分以下的同学的成绩加10分</p>
</li>
<li><pre><code class="MYSQL">UPDATE students 
SET score=score+10 
WHERE score&lt;80;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   可以根据返回受影响行数判断是否更新成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### DELETE</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;MYSQL</span><br><span class="line">DELETE FROM &lt;表名&gt; WHERE ...;</span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><p>删除id=5，6，7的记录</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM students </span><br><span class="line">WHERE id&gt;&#x3D;5 AND id&lt;&#x3D;7;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>删除id=1，4，9的记录</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM students </span><br><span class="line">WHERE id IN (1, 4, 9);</span><br></pre></td></tr></table></figure>

<p><strong>清空整表数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate table students;</span><br></pre></td></tr></table></figure>



<h2 id="五、MySQL"><a href="#五、MySQL" class="headerlink" title="五、MySQL"></a>五、MySQL</h2><p>命令行程序 <strong>mysql *<em>实际上是MySQL客户端，真正的MySQL服务器程序是 *</em>mysqld</strong> ，在后台运行。</p>
<p><strong>命令行的方式运行，一般用于SSH操作远程服务器，注意语句后面加 ；</strong></p>
<p>默认编码集 <strong>Latin1</strong></p>
<h4 id="数据库管理"><a href="#数据库管理" class="headerlink" title="数据库管理"></a>数据库管理</h4><ol>
<li><p>创建数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE test character set utf8;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE test;</span><br></pre></td></tr></table></figure>
</li>
<li><p>切换到某一个数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE test;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看所有数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据库连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&gt; mysql -u root -p</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="数据表管理"><a href="#数据表管理" class="headerlink" title="数据表管理"></a>数据表管理</h4><ol>
<li>列出数据库的所有表</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看一个表的结构</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC students;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>查看创建表的SQL语句</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE TABLE students;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>删除表</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE students;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>给students表新增一列birth</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students ADD COLUMN birth VARCHAR(10) NOT NULL;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>修改birth列名为birthday</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students CHANGE COLUMN birth birthday VARCHAR(20) NOT NULL;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>删除列</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE students DROP COLUMN birthday;</span><br></pre></td></tr></table></figure>

<h4 id="数据约束"><a href="#数据约束" class="headerlink" title="数据约束"></a>数据约束</h4><ol>
<li><p>默认值 default</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table person1(</span><br><span class="line">    id int,</span><br><span class="line">    name varchar(50),</span><br><span class="line">    country varchar(50) default &#39;PRC&#39; -- 默认值字段</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>非空 not null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table person1(</span><br><span class="line">    id int,</span><br><span class="line">    name varchar(50) not null,   -- 非空</span><br><span class="line">    country varchar(50) default &#39;PRC&#39; -- 默认值字段</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>唯一 unique（当前字段中保存的数据在当前表内不可以重复）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table person1(</span><br><span class="line">    id int unique,</span><br><span class="line">    name varchar(50) not null,   -- 非空</span><br><span class="line">    country varchar(50) default &#39;PRC&#39; -- 默认值字段</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>主键 primary key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table person1(</span><br><span class="line">    id int primary key,</span><br><span class="line">    name varchar(50) not null,   -- 非空</span><br><span class="line">    country varchar(50) default &#39;PRC&#39; -- 默认值字段</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>自增长 auto_increment（从1开始）</p>
<p><strong>自增长可以指定数值，而且存在影响自增长计数情况</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table person1(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,   -- 非空</span><br><span class="line">    country varchar(50) default &#39;PRC&#39; -- 默认值字段</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>外键约束（一般不用）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-- 外键声明约束</span><br><span class="line">    -- constraint 声明使用关键字</span><br><span class="line">    -- fk_emp_dept 外键名称 fk &#x3D;&#x3D;&gt; foreign key emp &#x3D;&#x3D;&gt; employee dept &#x3D;&#x3D;&gt; 部门表</span><br><span class="line">	-- foreign key 外键声明关键字(从表外键字段)  deptId   employee表内的外键是deptId</span><br><span class="line">	-- references 选择当前外键关联的主表字段关键字 主表(字段) dept(id)</span><br><span class="line"></span><br><span class="line">-- 部门表 【主表】</span><br><span class="line">create table dept(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    deptName varchar(50) not null</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 员工表，员工表中存在字段和部门表有直接联系，deptId &#x3D;&#x3D;&gt; dept表内的id</span><br><span class="line">-- 【从表】</span><br><span class="line">create table employee(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    deptId int,</span><br><span class="line">    </span><br><span class="line">	constraint fk_emp_dept foreign key (deptId)</span><br><span class="line">	references nzgp2001.dept(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>级联操作</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-- 在外键约束的情况下，操作主表和从表都有很多约束</span><br><span class="line">-- SQL中引入的级联操作</span><br><span class="line">    -- 级联删除 on delete cascade</span><br><span class="line">    -- 级联修改 on update cascade</span><br><span class="line">    </span><br><span class="line">-- 部门表 【主表】</span><br><span class="line">create table dept(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    deptName varchar(50) not null</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 员工表，员工表中存在字段和部门表有直接联系，deptId &#x3D;&#x3D;&gt; dept表内的id</span><br><span class="line">-- 【从表】</span><br><span class="line">create table employee(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    deptId int,</span><br><span class="line">    </span><br><span class="line">	constraint fk_emp_dept foreign key (deptId)</span><br><span class="line">	references nzgp2001.dept(id)</span><br><span class="line">    on delete cascade -- 级联删除</span><br><span class="line">	on update cascade -- 级联修改</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 主表中有外键约束的字段数据发生修改，从表中对于字段同时发生修改，级联修改</span><br><span class="line">update dept set id &#x3D; 10 where id &#x3D; 3;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="实用SQL语句"><a href="#实用SQL语句" class="headerlink" title="实用SQL语句"></a>实用SQL语句</h4><ol>
<li><strong>插入或替换（REPLACE）</strong>  —   不存在则插入，存在则删除再插入</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REPLACE INTO students </span><br><span class="line">VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>插入或更新（INSERT INTO … ON DUPLICATE KEY UPDATE …）</strong>  —   不存在则插入，存在则更新</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students </span><br><span class="line">VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99) </span><br><span class="line">ON DUPLICATE KEY UPDATE name&#x3D;&#39;小明&#39;, gender&#x3D;&#39;F&#39;, score&#x3D;99;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>插入或忽略（INSERT IGNORE INTO…）</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT IGNORE INTO students </span><br><span class="line">VALUES (1, 1, &#39;小明&#39;, &#39;F&#39;, 99);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>快照</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE students_of_class1 </span><br><span class="line">SELECT * FROM students </span><br><span class="line">WHERE class_id&#x3D;1;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>将查询结果集写入表中</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">创建结果集表：</span><br><span class="line">	CREATE TABLE statistics (</span><br><span class="line">    id BIGINT NOT NULL AUTO_INCREMENT,</span><br><span class="line">    class_id BIGINT NOT NULL,</span><br><span class="line">    average DOUBLE NOT NULL,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">	);</span><br><span class="line">插入数据：</span><br><span class="line">	INSERT INTO statistics (class_id, average) </span><br><span class="line">	SELECT class_id, AVG(score) </span><br><span class="line">	FROM students </span><br><span class="line">	GROUP BY class_id;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><strong>强制使用索引（索引必须存在）</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM students </span><br><span class="line">FORCE INDEX (idx_class_id) </span><br><span class="line">WHERE class_id &#x3D; 1 </span><br><span class="line">ORDER BY id DESC;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、事务管理"><a href="#六、事务管理" class="headerlink" title="六、事务管理"></a>六、事务管理</h2><h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><ol>
<li><p>数据库事务：把多条语句作为一个整体进行操作的功能</p>
</li>
<li><p>ACID特性：</p>
<ol>
<li><strong>A：Atomic，原子性</strong>，要么全部执行，要么全部不执行；</li>
<li><strong>C：Consistent，一致性</strong>，事务完成后，所有数据的状态都是一致的</li>
<li><strong>I：Isolation，隔离性</strong>，如果有多个事务并发执行，每个事务作出的修改必须与其他事务隔离</li>
<li><strong>D：Duration，持久性</strong>，即事务完成后，对数据库数据的修改被持久化存储</li>
</ol>
</li>
<li><p>隐式事务：单条SQL语句，数据库系统自动将其作为一个事务执行</p>
</li>
<li><p>显式事务：</p>
<ol>
<li><p>开启事务： <strong>BEGIN；</strong></p>
</li>
<li><p>提交数据： <strong>COMMIT；</strong></p>
</li>
<li><p>回滚事务： <strong>ROLLBACK；</strong></p>
</li>
<li><p>设置事务的隔离级别：<strong>SET  TRANSACTION  ISOLATION  LEVEL 级别</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">BEGIN;</span><br><span class="line">UPDATE accounts SET balance &#x3D; balance - 100 WHERE id &#x3D; 1;</span><br><span class="line">SELECT * FROM accounts;</span><br><span class="line"></span><br><span class="line">UPDATE accounts SET balance &#x3D; balance + 100 WHERE id &#x3D; 2;</span><br><span class="line">SELECT * FROM accounts;</span><br><span class="line"></span><br><span class="line">-- 没有问题</span><br><span class="line">COMMIT;</span><br><span class="line"></span><br><span class="line">-- 发现问题</span><br><span class="line">ROLLBACK;</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ol>
<h4 id="隔离级别（从低到高）"><a href="#隔离级别（从低到高）" class="headerlink" title="隔离级别（从低到高）"></a>隔离级别（从低到高）</h4><ol>
<li><p><strong>Read Uncommitted</strong>【级别最低，什么都避免不了】</p>
<p><strong>脏读</strong>：<em>事务A</em> 读到 <em>事务B</em> 更新后但未提交的数据</p>
<p><em>事务B</em> 回滚，那么 <em>事务A</em> 读到的数据就是脏数据（和上一次读到的数据不一致）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRANSACTION_SERIALIZABLE       &#x2F;&#x2F; 对应常量</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p><strong>Read Committed</strong>【可避免脏读】</p>
<p><strong>不可重复读（Non Repeatable Read）</strong>：在事务A内，多次读同一数据，若在这个事务没结束前，事务B恰好修改了这个数据，那么事务A中，两次读取的数据可能就不一致，<strong>也就是说一个事务可以看到其他事务所做的修改</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRANSACTIONREPEATABLEREAD</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p><strong>Repeatable Read</strong>【可避免脏读，不可重复读】</p>
<p><strong>幻读（Phantom Read）</strong>：在一个事务内读取到了别的事务插入的数据，导致前后读取不一致。</p>
<ul>
<li>在一个事务中，第一次查询某条记录，没有</li>
<li>但是，当试图更新这条不存在的记录时，竟然能成功</li>
<li>并且，再次读取同一条记录，它就神奇地出现了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRANSACTIONREADCOMMITTED</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="4">
<li><p><strong>Serializable</strong>【可避免脏读，不可重复读，幻读】</p>
<p>最严格的隔离级别，所有事务按照次序依次执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRANSACTIONREADUNCOMMITTED</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="5">
<li><strong>MySQL中，如果使用InnoDB，默认的隔离级别是Repeatable Read</strong></li>
</ol>
<hr>
<h2 id="七、权限管理"><a href="#七、权限管理" class="headerlink" title="七、权限管理"></a>七、权限管理</h2><ol>
<li><p>创建用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 用户名 saolei 密码 123456</span><br><span class="line">create user &#39;lwclick&#39; identified by &#39;123456&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>授权用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 授权操作所有nzgp2001库权限</span><br><span class="line">grant all on nzgp2001.* to &#39;lwclick&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>撤销授权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 撤销saolei用户所有nzgp2001数据库权限</span><br><span class="line">revoke all on nzgp2001.* from &#39;lwclick&#39;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 删除用户</span><br><span class="line">drop user &#39;lwclick&#39;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="八、索引"><a href="#八、索引" class="headerlink" title="八、索引"></a>八、索引</h2><p>索引分<strong>单列索引</strong>和<strong>组合索引</strong></p>
<p>创建索引时，你需要确保该索引是应用在 <strong>SQL 查询语句</strong>的条件(一般作为 WHERE 子句的条件)</p>
<p>索引也是一张表，该表保存了<strong>主键</strong>与<strong>索引字段</strong>，并指向实体表的记录。</p>
<h4 id="1-普通索引"><a href="#1-普通索引" class="headerlink" title="1. 普通索引"></a>1. 普通索引</h4><ul>
<li><p><strong>创建索引</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX indexName ON mytable(username(length));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加索引</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER table tableName ADD INDEX indexName(columnName)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除索引</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX [indexName] ON mytable;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建表的时候直接指定</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE mytable(</span><br><span class="line">    ID INT NOT NULL,</span><br><span class="line">    username VARCHAR(16) NOT NULL,  </span><br><span class="line"></span><br><span class="line">    INDEX [indexName] (username(length))  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM table_name; \G</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="2-唯一索引"><a href="#2-唯一索引" class="headerlink" title="2. 唯一索引"></a>2. 唯一索引</h4><p>索引列的值必须唯一，但允许有空值。</p>
<ul>
<li><p><strong>创建索引</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE UNIQUE INDEX indexName ON mytable(username(length))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加索引</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE mytable ADD UNIQUE [indexName] (username(length))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建表的时候直接指定</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE mytable(</span><br><span class="line">    ID INT NOT NULL,</span><br><span class="line">    username VARCHAR(16) NOT NULL,  </span><br><span class="line"></span><br><span class="line">    UNIQUE [indexName] (username(length))  </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h2 id="九、视图"><a href="#九、视图" class="headerlink" title="九、视图"></a>九、视图</h2><p>为了保障数据安全性，提高查询效率。数据独立（源表和视图）</p>
<h3 id="1-视图是什么？"><a href="#1-视图是什么？" class="headerlink" title="1. 视图是什么？"></a>1. 视图是什么？</h3><p>视图（view）是一种<strong>虚拟存在的表</strong>，是一个逻辑表，<strong>本身并不包含数据</strong>。作为<strong>一个select语句</strong>保存在数据字典中的。</p>
<p>基表：用来创建视图的表叫做基表base table</p>
<p>通过视图，可以展现<strong>基表的部分数据</strong>；视图数据来自定义视图的查询中使用的表，使用视图动态生成。</p>
<h3 id="2-视图的操作"><a href="#2-视图的操作" class="headerlink" title="2. 视图的操作"></a>2. 视图的操作</h3><h4 id="2-1-创建视图"><a href="#2-1-创建视图" class="headerlink" title="2.1 创建视图"></a>2.1 创建视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE [OR REPLACE]</span><br><span class="line">	[ALGORITHM &#x3D; &#123;UNDEFINED | MERGE | TEMPTABLE&#125;]</span><br><span class="line">    VIEW view_name [(column_list)]</span><br><span class="line">    AS select语句</span><br><span class="line">   [WITH [CASCADED | LOCAL] CHECK OPTION]</span><br></pre></td></tr></table></figure>

<ul>
<li>OR REPLACE：表示<strong>替换已有视图</strong></li>
<li>ALGORITHM：表示<strong>视图选择算法</strong>。<ul>
<li>UNDEFINED  默认，MySQL将<strong>自动选择所要使用的算法</strong></li>
<li>merge  合并，将视图的<strong>语句</strong>与视图<strong>定义</strong>合并起来，使得视图定义的某一部分取代语句的对应部分</li>
<li>temptable  临时表，将视图的<strong>结果存入临时表</strong>，然后<strong>使用临时表执行语句</strong></li>
</ul>
</li>
<li>[WITH [CASCADED | LOCAL] CHECK OPTION] ：视图在<strong>更新时</strong>保证<strong>在视图的权限范围之内</strong><ul>
<li>cascade默认值：更新视图的时候，<strong>检查所有的视图</strong>(嵌套视图及其底层的视图)</li>
<li>local：更新视图的时候，<strong>只检查将要更新的视图本身</strong></li>
</ul>
</li>
</ul>
<p><strong>单表创建视图</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create view v_F_players(编号,名字,性别,电话)    -- 指定显示列的姓名</span><br><span class="line">              -- 视图名后面的列的数量必须匹配select子句中的列的数量。</span><br><span class="line">as</span><br><span class="line">select id, name, sex, phone from players</span><br><span class="line">where sex&#x3D;&#39;F&#39;</span><br><span class="line">with check option;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from  v_F_players;</span><br></pre></td></tr></table></figure>



<p><strong>多表创建视图</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create view v_match</span><br><span class="line">as </span><br><span class="line">select a.id, a.name, sex, c.teamId, c.div</span><br><span class="line">from player a, mat b, teams c</span><br><span class="line">where a.id &#x3D; b.id and b.teamId &#x3D; c.teamId;</span><br></pre></td></tr></table></figure>



<h4 id="2-2-查看视图"><a href="#2-2-查看视图" class="headerlink" title="2.2 查看视图"></a>2.2 查看视图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create view v_F_players\G;</span><br></pre></td></tr></table></figure>



<h4 id="2-3-更改视图"><a href="#2-3-更改视图" class="headerlink" title="2.3 更改视图"></a>2.3 更改视图</h4><ol>
<li><p>CREATE OR REPLACE VIEW语句修改视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 在视图存在的情况下可对视图进行修改，视图不在的情况下可创建视图</span><br><span class="line">create or replace view view_name as select语句;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ALTER语句修改视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 修改数据库中已存在的表的定义，当基表的某些字段发生改变时，可以通过修改视图来保持视图和基本表之间一致</span><br><span class="line">ALTER</span><br><span class="line">    [ALGORITHM &#x3D; &#123;UNDEFINED | MERGE | TEMPTABLE&#125;]</span><br><span class="line">    [DEFINER &#x3D; &#123; user | CURRENT_USER &#125;]</span><br><span class="line">    [SQL SECURITY &#123; DEFINER | INVOKER &#125;]</span><br><span class="line">VIEW view_name [(column_list)]</span><br><span class="line">AS select_statement</span><br><span class="line">    [WITH [CASCADED | LOCAL] CHECK OPTION]</span><br></pre></td></tr></table></figure>
</li>
<li><p>DML操作更新视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 因为视图本身没有数据，因此对视图进行的dml操作最终都体现在基表中</span><br><span class="line">create view v_student as select * from student;</span><br><span class="line"></span><br><span class="line">update v_student set name&#x3D;&#39;钱六&#39; where 学号&#x3D;&#39;1&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>不能做DML操作</strong></p>
<ul>
<li>select子句中<strong>包含distinct</strong></li>
<li>select子句中<strong>包含组函数</strong></li>
<li>select语句中<strong>包含group by子句</strong></li>
<li>select语句中<strong>包含order by子句</strong></li>
<li>select语句中<strong>包含union 、union all等集合运算符</strong></li>
<li>where子句中<strong>包含相关子查询</strong></li>
<li>from子句中<strong>包含多个表</strong></li>
<li>如果视图中<strong>有计算列</strong>，则不能更新</li>
<li>如果基表中<strong>有某个具有非空约束的列未出现在视图定义中</strong>，则不能做insert操作</li>
</ul>
</li>
<li><p>删除视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view v_student;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="2-4-使用WITH-CHECK-OPTION约束"><a href="#2-4-使用WITH-CHECK-OPTION约束" class="headerlink" title="2.4 使用WITH CHECK OPTION约束"></a>2.4 使用WITH CHECK OPTION约束</h4><p>可以执行DML操作的视图，定义时可以带上WITH CHECK OPTION约束</p>
<p>作用：<strong>对视图所做的DML操作的结果，不能违反视图的WHERE条件的限制。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create view v_veterans</span><br><span class="line">as</span><br><span class="line">select * from players</span><br><span class="line">where birth_date &lt; &#39;1960-01-01&#39;</span><br><span class="line">with check option;</span><br><span class="line"></span><br><span class="line">-- 使用update对视图进行修改，抛出异常，违反了视图中的where条件</span><br><span class="line">update v_veterans</span><br><span class="line">set BIRTH_DATE&#x3D;&#39;1970-09-01&#39;</span><br><span class="line">where PLAYERNO&#x3D;39;</span><br></pre></td></tr></table></figure>



<h4 id="2-5-嵌套视图"><a href="#2-5-嵌套视图" class="headerlink" title="2.5 嵌套视图"></a>2.5 嵌套视图</h4><p>定义在另一个视图的上面的视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create view v_ear_veterans</span><br><span class="line">    -&gt; as</span><br><span class="line">    -&gt; select * from v_veterans</span><br><span class="line">　　 -&gt; where JOINED &lt; 1980;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="1-什么是存储过程？有哪些优缺点？"><a href="#1-什么是存储过程？有哪些优缺点？" class="headerlink" title="1. 什么是存储过程？有哪些优缺点？"></a>1. 什么是存储过程？有哪些优缺点？</h3><p><strong>存储过程就像我们编程语言中的函数一样，封装了我们的代码(PLSQL、T-SQL)</strong></p>
<p>优点：</p>
<ul>
<li>能够将代码封装起来，保存在数据库之中，让编程语言进行调用</li>
<li>存储过程是一个预编译的代码块，执行效率比较高</li>
<li>一个存储过程替代大量T_SQL语句 ，可以降低网络通信量，提高通信速率</li>
</ul>
<p>缺点：</p>
<ul>
<li>每个数据库的存储过程语法几乎都不一样，十分难以维护（不通用）</li>
<li>业务逻辑放在数据库上，难以迭代</li>
</ul>
<h3 id="2-三个范式是什么"><a href="#2-三个范式是什么" class="headerlink" title="2. 三个范式是什么"></a>2. 三个范式是什么</h3><p>第一范式：<strong>字段是最小的的单元不可再分</strong></p>
<p>第二范式：满足第一范式，<strong>表中的字段必须完全依赖于全部主键而非部分主键。</strong>（消除部分函数依赖）</p>
<p>第三范式：满足第二范式，<strong>非主键外的所有字段必须互不依赖</strong>）（消除传递函数依赖）</p>
<h3 id="3-什么是视图？以及视图的使用场景有哪些？"><a href="#3-什么是视图？以及视图的使用场景有哪些？" class="headerlink" title="3. 什么是视图？以及视图的使用场景有哪些？"></a>3. 什么是视图？以及视图的使用场景有哪些？</h3><p>视图是一种基于数据表的一种<strong>虚表</strong></p>
<ul>
<li><p>视图建立在已有表的基础上, 视图赖以建立的这些表称为基表</p>
</li>
<li><p><strong>向视图提供数据内容的语句为 SELECT 语句,可以将视图理解为    存储起来的 SELECT 语句</strong></p>
</li>
<li><p>视图没有存储真正的数据，真正的数据还是存储在基表中，操作的还是基表</p>
</li>
<li><p>一个基表可以有0个或多个视图</p>
</li>
</ul>
<p><strong>视图可以将查询出来的数据进行封装，让我们专注于 逻辑，但不提高查询效率</strong></p>
<h3 id="4-drop、delete与truncate分别在什么场景之下使用？"><a href="#4-drop、delete与truncate分别在什么场景之下使用？" class="headerlink" title="4. drop、delete与truncate分别在什么场景之下使用？"></a>4. drop、delete与truncate分别在什么场景之下使用？</h3><p>drop table（<strong>不再需要一张表的时候</strong>）</p>
<ul>
<li>1)属于DDL</li>
<li>2)不可回滚</li>
<li>3)不可带where</li>
<li>4)表内容和结构删除</li>
<li>5)删除速度快</li>
</ul>
<p>truncate table（<strong>保留表而删除所有数据的时候</strong>）</p>
<ul>
<li>1)属于DDL</li>
<li>2)不可回滚</li>
<li>3)不可带where</li>
<li>4)表内容删除</li>
<li>5)删除速度快</li>
</ul>
<p>delete from（<strong>想删除部分数据行时候，带上where子句</strong>）</p>
<ul>
<li>1)属于DML</li>
<li>2)可回滚</li>
<li>3)可带where</li>
<li>4)表结构在，表内容要看where执行的情况</li>
<li>5)删除速度慢,需要逐行删除</li>
</ul>
<h3 id="5-索引是什么？有什么作用以及优缺点？"><a href="#5-索引是什么？有什么作用以及优缺点？" class="headerlink" title="5. 索引是什么？有什么作用以及优缺点？"></a>5. 索引是什么？有什么作用以及优缺点？</h3><p>索引表把数据变成是有序的，快速定位到硬盘中的数据文件</p>
<ul>
<li>是一种快速查询表中内容的机制，类似于<strong>新华字典的目录</strong></li>
<li><strong>运用在表中某个些字段上，但存储时，独立于表之外</strong></li>
</ul>
<p><strong>一张表最多可以建16个索引</strong></p>
<p><strong>特点：</strong></p>
<ol>
<li>索引一旦建立,<strong>Oracle管理系统会对其进行自动维护</strong>, 而且由Oracle管理系统决定何时使用索引</li>
<li>用户不用在查询语句中指定使用哪个索引</li>
<li><strong>在定义primary  key或unique约束后系统 自动 在相应的列上创建索引</strong></li>
<li>用户也能按自己的需求，对指定单个字段或多个字段，添加索引</li>
<li>可以加快检索速度，但是也降低了其他的速度，需要占用空间</li>
</ol>
<p>【要】创建索引</p>
<ul>
<li>表经常进行 SELECT 操作</li>
<li>表很大(记录超多)，记录内容分布范围很广</li>
<li>列名经常在 WHERE 子句或连接条件中出现</li>
</ul>
<p>【不要】创建索引</p>
<ul>
<li>表经常进行 INSERT/UPDATE/DELETE 操作</li>
<li>表很小，不经常出现</li>
</ul>
<p><strong>分类：</strong></p>
<ul>
<li><strong>唯一索引</strong>：唯一索引不允许两行具有相同的索引值</li>
<li><strong>主键索引</strong>：为表定义一个<strong>主键将自动创建主键索引</strong>，主键索引是唯一索引的特殊类型。主键索引要求主键中的每个值是唯一的，并且不能为空</li>
<li><strong>聚集索引</strong>(Clustered)：表中各行的物理顺序与键值的逻辑（索引）顺序相同，每个表只能有一个</li>
<li><strong>非聚集索引</strong>(Non-clustered)：非聚集索引指定表的逻辑顺序。数据存储在一个位置，索引存储在另一个位置，索引中包含指向数据存储位置的指针。可以有多个，小于249个</li>
</ul>
<h3 id="6-rowid特点"><a href="#6-rowid特点" class="headerlink" title="6. rowid特点"></a>6. rowid特点</h3><ul>
<li>（1）位于每个表中，但表面上看不见，     例如：desc emp是看不见的</li>
<li>（2）只有在select中，显示写出rowid，方可看见</li>
<li>（3）它与每个表绑定在一起，表亡，该表的rowid亡，二张表rownum可以相同，但rowid必须是唯一的</li>
<li>（4）rowid是18位大小写加数字混杂体，唯一表代该条记录在DBF文件中的位置</li>
<li>（5）rowid可以参与=/like比较时，用’’单引号将rowid的值包起来，且区分大小写</li>
<li>（6）rowid是联系表与DBF文件的桥梁</li>
</ul>
<h3 id="7-事务"><a href="#7-事务" class="headerlink" title="7. 事务"></a>7. 事务</h3><p>事务简单来说：<strong>一个Session中所进行所有的操作，要么同时成功，要么同时失败</strong></p>
<p><strong>ACID — 数据库事务正确执行的四个基本要素</strong></p>
<ul>
<li>包含：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。</li>
</ul>
<p><strong>一个支持事务（Transaction）中的数据库系统，必需要具有这四种特性，否则在事务过程（Transaction processing）当中无法保证数据的正确性，交易过程极可能达不到交易。</strong></p>
<p><strong>隔离级别</strong></p>
<ol>
<li>Serializable【可避免脏读，不可重复读，虚读】</li>
<li>Repeatable read【可避免脏读，不可重复读】</li>
<li>Read committed【可避免脏读】</li>
<li>Read uncommitted【级别最低，什么都避免不了】</li>
</ol>
<p>分别对应Connection类中的4个常量</p>
<ol>
<li><strong>TRANSACTION_READ_UNCOMMITTED</strong></li>
<li><strong>TRANSACTION_READ_COMMITTED</strong></li>
<li><strong>TRANSACTION_REPEATABLE_READ</strong></li>
<li><strong>TRANSACTION_SERIALIZABLE</strong></li>
</ol>
<p>脏读：<strong>一个事务读取到另外一个事务未提交的数据</strong></p>
<p>不可重复读：<strong>一个事务读取到另外一个事务已经提交的数据，也就是说一个事务可以看到其他事务所做的修改</strong></p>
<p>虚读(幻读)：<strong>是指在一个事务内读取到了别的事务插入的数据，导致前后读取不一致。</strong></p>
<h3 id="8-数据库的乐观锁和悲观锁是什么？"><a href="#8-数据库的乐观锁和悲观锁是什么？" class="headerlink" title="8. 数据库的乐观锁和悲观锁是什么？"></a>8. 数据库的乐观锁和悲观锁是什么？</h3><p><strong>并发控制主要采用的技术手段</strong>，确保在<strong>多个事务</strong>同时存取数据库中<strong>同一数据</strong>时不破坏事务的隔离性和统一性以及数据库的统一性</p>
<ul>
<li><p>悲观锁：假定<strong>会发生</strong>并发冲突，屏蔽一切可能违反数据完整性的操作</p>
</li>
<li><ul>
<li><strong>在查询完数据的时候就把事务锁起来，直到提交事务</strong></li>
<li>实现方式：使用数据库中的锁机制</li>
</ul>
</li>
<li><p><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM%E6%88%AA%E5%9B%BE20200507180648.png" alt="TIM截图20200507180648"></p>
</li>
<li><p>乐观锁：假设<strong>不会发生</strong>并发冲突，只在<strong>提交操作时</strong>检查是否违反数据完整性。</p>
</li>
<li><ul>
<li><strong>在修改数据的时候把事务锁起来，通过version的方式来进行锁定</strong></li>
<li>实现方式：使用version版本或者时间戳</li>
</ul>
</li>
<li><img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200507180716.png" alt="TIM截图20200507180716" style="zoom:80%;" />



</li>
</ul>
<h3 id="9-超键、候选键、主键、外键分别是什么？"><a href="#9-超键、候选键、主键、外键分别是什么？" class="headerlink" title="9. 超键、候选键、主键、外键分别是什么？"></a>9. 超键、候选键、主键、外键分别是什么？</h3><ul>
<li>超键：<strong>在关系中能唯一标识元组的 属性集 称为关系模式的超键</strong>。<ul>
<li>一个属性可以为作为一个超键，多个属性组合在一起也可以作为一个超键。</li>
<li><strong>超键包含候选键和主键</strong>。</li>
</ul>
</li>
<li><strong>候选键(候选码)：是最小超键，即没有冗余元素的超键</strong>。</li>
<li><strong>主键(主码)：数据库表中对储存数据对象予以唯一和完整标识的数据列或属性的组合</strong>。<ul>
<li>一个数据列只能有一个主键，且主键的取值不能缺失，即不能为空值（Null）。</li>
</ul>
</li>
<li><strong>外键：在一个表中存在的另一个表的主键称此表的外键</strong>。</li>
</ul>
<p>例子：邮寄地址（城市名，街道名，邮政编码，单位名，收件人）</p>
<ul>
<li><strong>它有两个候选键:{城市名，街道名} 和 {街道名，邮政编码}</strong></li>
<li>如果我选取{城市名，街道名}作为唯一标识实体的属性，那么{城市名，街道名} 就是主码(主键)</li>
</ul>
<h3 id="10-SQL-约束有哪几种？"><a href="#10-SQL-约束有哪几种？" class="headerlink" title="10. SQL 约束有哪几种？"></a>10. SQL 约束有哪几种？</h3><ul>
<li><p>NOT NULL:        用于控制字段的内容一定不能为空（NULL）。</p>
</li>
<li><p>UNIQUE:            控件字段内容不能重复，一个表允许有多个 Unique 约束。</p>
</li>
<li><p>PRIMARY KEY:   也是用于控件字段内容不能重复，但它在一个表只允许出现一个。</p>
</li>
<li><p>FOREIGN KEY:   用于预防破坏表之间连接的动作，也能防止非法数据插入外键列</p>
<p>​                            因为它必须是它指向的那个表中的值之一。</p>
</li>
<li><p>CHECK: 用于控制字段的值范围。</p>
</li>
</ul>
<h3 id="11-数据库运行于哪种状态下可以防止数据的丢失？"><a href="#11-数据库运行于哪种状态下可以防止数据的丢失？" class="headerlink" title="11. 数据库运行于哪种状态下可以防止数据的丢失？"></a>11. 数据库运行于哪种状态下可以防止数据的丢失？</h3><p>在<strong>archivelog mode(归档模式)</strong>只要其归档日志文件不丢失，就可以有效地防止数据丢失。</p>
<h3 id="12-Mysql存储引擎"><a href="#12-Mysql存储引擎" class="headerlink" title="12. Mysql存储引擎"></a>12. Mysql存储引擎</h3><ul>
<li><strong>Innodb引擎（修改要求比较高的事务处理）</strong>，Innodb引擎提供了对数据库<strong>ACID事务</strong>的支持。并且还提供了行级锁和外键的约束。它的设计的目标就是处理大数据容量的数据库系统。</li>
<li><strong>MyIASM引擎（查询要求比较高的表）</strong>不提供事务的支持，也不支持行级锁和外键。(原本Mysql的默认引擎)</li>
<li><strong>MEMORY引擎（数据库需要一个用于查询的临时表）</strong>：所有的数据都在内存中，数据的处理速度快，但是安全性不高。</li>
</ul>
<h3 id="13-MyIASM和Innodb两种引擎所使用的索引的数据结构是什么？"><a href="#13-MyIASM和Innodb两种引擎所使用的索引的数据结构是什么？" class="headerlink" title="13. MyIASM和Innodb两种引擎所使用的索引的数据结构是什么？"></a>13. MyIASM和Innodb两种引擎所使用的索引的数据结构是什么？</h3><p>都是B+树!</p>
<ul>
<li>MyIASM引擎：B+树的数据结构中存储的内容实际上是实际数据的地址值。<ul>
<li>它的索引和实际数据是分开的</li>
<li><strong>使用索引指向了实际数据。这种索引的模式被称为非聚集索引。</strong></li>
</ul>
</li>
<li>Innodb引擎：<strong>数据结构中存储的都是实际的数据，这种索引有被称为聚集索引</strong>。</li>
</ul>
<h4 id="为什么MySQL数据库索引选择使用B-树？"><a href="#为什么MySQL数据库索引选择使用B-树？" class="headerlink" title="为什么MySQL数据库索引选择使用B+树？"></a>为什么MySQL数据库索引选择使用B+树？</h4><h5 id="一、二叉查找树"><a href="#一、二叉查找树" class="headerlink" title="一、二叉查找树"></a>一、二叉查找树</h5><p>1、任意节点左子树不为空,则左子树的值均小于根节点的值；</p>
<p>2、任意节点右子树不为空,则右子树的值均大于于根节点的值；</p>
<p>3、任意节点的左右子树也分别是二叉查找树；</p>
<p>4、没有键值相等的节点；</p>
<p><strong>一个二叉查找树是由n个节点随机构成，所以，对于某些情况，二叉查找树会退化成一个有n个节点的线性链</strong></p>
<h5 id="二、AVL树"><a href="#二、AVL树" class="headerlink" title="二、AVL树"></a>二、AVL树</h5><p>AVL树是带有平衡条件的二叉查找树，一般是用平衡因子差值判断是否平衡并通过旋转来实现平衡，左右子树树高不超过1</p>
<h5 id="三、红黑树"><a href="#三、红黑树" class="headerlink" title="三、红黑树"></a>三、红黑树</h5><p> 1、每个节点非红即黑；<br> 2、<strong>根节点</strong>是黑的；<br> 3、每个<strong>叶节点</strong>(叶节点即树尾端NULL指针或NULL节点)都是黑的；<br> 4、如果<strong>一个节点是红的</strong>,那么它的<strong>两儿子都是黑</strong>的；<br> 5、对于<strong>任意节点</strong>而言，<strong>其到叶子点树NULL指针</strong>的每条路径都包含<strong>相同数目的黑节点；</strong><br> 6、每条路径都包含相同的黑节点</p>
<p>​    相同的节点情况下，AVL树的高度低于红黑树</p>
<p><strong>Map和Set都是用红黑树实现的</strong></p>
<h5 id="四、B-B-树"><a href="#四、B-B-树" class="headerlink" title="四、B/B+树"></a>四、B/B+树</h5><p>B+树是应文件系统所需而产生的一种B树的变形树（文件的目录一级一级索引，只有最底层的叶子节点（文件）保存数据）非叶子节点只保存索引，不保存实际的数据，数据都保存在叶子节点中，这不就是文件系统文件的查找吗?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有3个文件夹a、b、c， a包含b，b包含c，一个文件yang.c，a、b、c就是索引（存储在非叶子节点）， a、b、c只是要找到的yang.c的key，而实际的数据yang.c存储在叶子节点上。</span><br></pre></td></tr></table></figure>

<p>B类树是平衡树，每个结点到叶子结点的高度都是相同，这也保证了每个查询是稳定的。</p>
<p>B/B+树是为了磁盘或其它存储设备而设计的一种平衡多路查找树</p>
<p>​     在相同的的节点的情况下，一颗B/B+树的高度远远小于红黑树的高度</p>
<h5 id="五、B-树"><a href="#五、B-树" class="headerlink" title="五、B+树"></a>五、B+树</h5><p> 1、非叶子节点的子树指针与关键字个数相同；<br> 2、非叶子节点的子树指针p[i],指向关键字值属于[k[i],k[i+1]]的子树.(B树是开区间,也就是说B树不允许关键字重复,B+树允许重复)；<br> 3、为所有叶子节点增加一个链指针；<br> 4、所有关键字都在叶子节点出现(稠密索引). (且链表中的关键字恰好是有序的)；<br> 5、非叶子节点相当于是叶子节点的索引(稀疏索引),叶子节点相当于是存储(关键字)数据的数据层；<br> 6、更适合于文件系统</p>
<h4 id="为什么说B-树比B树更适合数据库索引？"><a href="#为什么说B-树比B树更适合数据库索引？" class="headerlink" title="为什么说B+树比B树更适合数据库索引？"></a>为什么说B+树比B树更适合数据库索引？</h4><p>B树在提高了IO性能的同时并没有解决元素遍历的效率低下的问题</p>
<p>正是为了解决这个问题，B+树应用而生。</p>
<p>B+树<strong>只需要去遍历叶子节点</strong>就可以实现<strong>整棵树的遍历。</strong></p>
<p>而且在数据库中基于范围的查询是非常频繁的，而B树不支持这样的操作或者说效率太低。</p>
<p>1、 <strong>B+树的磁盘读写代价更低</strong>：</p>
<ul>
<li>B+树的内部节点并没有指向关键字具体信息的指针，因此其内部节点相对B树更小</li>
<li>如果把所有同一内部节点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多</li>
<li>一次性读入内存的需要查找的关键字也就越多，相对IO读写次数就降低了。</li>
</ul>
<p>2、<strong>B+树的查询效率更加稳定</strong>：</p>
<ul>
<li>由于非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。</li>
<li>所以任何关键字的查找必须走一条从根结点到叶子结点的路。</li>
<li>所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。</li>
</ul>
<p>3、由于B+树的数据都存储在叶子结点中，<strong>分支结点均为索引，方便扫库</strong>，只需要扫一遍叶子结点即可</p>
<p>B树因为其分支结点同样存储着数据，我们要找到具体的数据，需要进行一次中序遍历按序来扫</p>
<p>所以B+树更加适合在区间查询的情况，所以通常B+树用于数据库索引。</p>
<h3 id="14-varchar和char的区别"><a href="#14-varchar和char的区别" class="headerlink" title="14. varchar和char的区别"></a>14. varchar和char的区别</h3><p>char是一种固定长度的类型，varchar是一种可变长度的类型</p>
<h3 id="15-mysql有关权限的表都有哪几个"><a href="#15-mysql有关权限的表都有哪几个" class="headerlink" title="15. mysql有关权限的表都有哪几个"></a>15. mysql有关权限的表都有哪几个</h3><p>权限表存放在mysql数据库里，由mysql_install_db脚本初始化</p>
<ul>
<li>user权限表：记录允许连接到服务器的用户帐号信息，里面的权限是全局级的。</li>
<li>db权限表：记录各个帐号在各个数据库上的操作权限。</li>
<li>table_priv权限表：记录数据表级的操作权限。</li>
<li>columns_priv权限表：记录数据列级的操作权限。</li>
<li>host权限表：配合db权限表对给定主机上数据库级操作权限作更细致的控制。这个权限表不受GRANT和REVOKE语句的影响。</li>
</ul>
<h3 id="16-数据表损坏的修复方式有哪些？"><a href="#16-数据表损坏的修复方式有哪些？" class="headerlink" title="16. 数据表损坏的修复方式有哪些？"></a>16. 数据表损坏的修复方式有哪些？</h3><p>使用 myisamchk 来修复，具体步骤：</p>
<ul>
<li>1）修复前将mysql服务停止。</li>
<li>2）打开命令行方式，然后进入到mysql的/bin目录。</li>
<li>3）执行myisamchk –recover 数据库所在路径/*.MYI</li>
</ul>
<p>使用repair table <strong>(修复被破坏的表)</strong>或者 OPTIMIZE table<strong>(回收闲置的数据库空间)</strong>命令来修复</p>
<h3 id="17-MySQL中InnoDB引擎的行锁是通过加在什么上完成"><a href="#17-MySQL中InnoDB引擎的行锁是通过加在什么上完成" class="headerlink" title="17. MySQL中InnoDB引擎的行锁是通过加在什么上完成"></a>17. MySQL中InnoDB引擎的行锁是通过加在什么上完成</h3><p><strong>InnoDB是基于索引来完成行锁</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tab_with_index where id &#x3D; 1 for update</span><br></pre></td></tr></table></figure>

<p><code>for update</code> 可以根据条件来完成行锁锁定,<strong>并且 id 是有索引键的列</strong></p>
<h3 id="18-数据库优化的思路"><a href="#18-数据库优化的思路" class="headerlink" title="18. 数据库优化的思路"></a>18. 数据库优化的思路</h3><h4 id="SQL优化："><a href="#SQL优化：" class="headerlink" title="SQL优化："></a>SQL优化：</h4><p>①选择最有效率的表名顺序（<strong>从右到左的顺序处理FROM子句中的表名</strong>）</p>
<ul>
<li><p><strong>选择记录条数最少的表放在最后</strong></p>
</li>
<li><p><strong>被其他表所引用的表放在最后</strong></p>
</li>
</ul>
<p>②WHERE子句中的连接顺序（<strong>自右而左的顺序解析WHERE子句</strong>）</p>
<ul>
<li><strong>可以过滤掉最大数量记录的条件必须写在WHERE子句的之右</strong></li>
</ul>
<p>③SELECT子句中避免使用*号</p>
<p>④用TRUNCATE替代DELETE（<strong>删除表的全部记录，除了表结构才这样做</strong>）</p>
<p>⑤多使用内部函数提高SQL效率</p>
<p><strong>例如使用mysql的concat()函数会比使用||来进行拼接快</strong></p>
<p>⑥使用表或列的别名（表或列的名字太长时）</p>
<p>⑦多使用commit</p>
<p>⑧善用索引</p>
<p><strong>当表的记录量非常大的时候，我们就可以使用索引</strong></p>
<p>⑨SQL语句用大写</p>
<p>⑩避免在索引列上使用NOT</p>
<p>避免在索引列上使用计算</p>
<p>用 <code>&gt;=</code> 替代 <code>&gt;</code></p>
<p>用IN替代OR （   sal = 100 or sal = 120  –&gt;  sal in (100, 120)   ）</p>
<p>总是使用索引的第一个列</p>
<h4 id="数据库结构优化"><a href="#数据库结构优化" class="headerlink" title="数据库结构优化"></a>数据库结构优化</h4><ul>
<li>1）范式优化： 比如消除冗余（节省空间。。）</li>
<li>2）反范式优化：比如适当加冗余等（减少join）</li>
<li>3）拆分表： 垂直拆分和水平拆</li>
</ul>
<h3 id="19-Oracle和Mysql的区别"><a href="#19-Oracle和Mysql的区别" class="headerlink" title="19. Oracle和Mysql的区别"></a>19. Oracle和Mysql的区别</h3><p>Mysql中，<strong>一个用户下可以创建多个库</strong></p>
<p>oracle中<strong>一个数据库实例可拥有多个用户，一个用户默认拥有一个表空间。</strong></p>
<p><strong>表空间是存储我们数据库表的地方，表空间内可以有多个文件。</strong></p>
<p><strong>我们需要指定用户、表空间来存储我们所需要的数据</strong>！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/mybatis/" itemprop="url">mybatis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:57:50+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/mybatis/" class="leancloud_visitors" data-flag-title="mybatis">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  25
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="mybatis入门"><a href="#mybatis入门" class="headerlink" title="mybatis入门"></a>mybatis入门</h2><p>⼀个基于Java的持久层框架，原名iBatis，ORM的⼀种实现框架，对JDBC的⼀种封装！</p>
<img src="https://gitee.com/lwclick/blogImg/raw/master/img/TIM截图20200503193720.png" alt="TIM截图20200503193720" style="zoom:60%;" />

<h3 id="1-Mybatis快速入门"><a href="#1-Mybatis快速入门" class="headerlink" title="1. Mybatis快速入门"></a>1. Mybatis快速入门</h3><h4 id="1-1-导入坐标"><a href="#1-1-导入坐标" class="headerlink" title="1.1 导入坐标"></a>1.1 导入坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mysql --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- junit --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- log4j --&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-2-准备测试工作"><a href="#1-2-准备测试工作" class="headerlink" title="1.2 准备测试工作"></a>1.2 准备测试工作</h4><h5 id="1-2-1-创建表"><a href="#1-2-1-创建表" class="headerlink" title="1.2.1 创建表"></a>1.2.1 创建表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table students(</span><br><span class="line">    id int(5) primary key,</span><br><span class="line">    name varchar(10),</span><br><span class="line">    sal double(8,2)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h5 id="1-2-2-创建实体类"><a href="#1-2-2-创建实体类" class="headerlink" title="1.2.2 创建实体类"></a>1.2.2 创建实体类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double sal;</span><br><span class="line">    getter/setter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-2-3-创建持久层接口-IStudentDao-书写CRUD方法"><a href="#1-2-3-创建持久层接口-IStudentDao-书写CRUD方法" class="headerlink" title="1.2.3 创建持久层接口 IStudentDao,书写CRUD方法"></a>1.2.3 创建持久层接口 IStudentDao,书写CRUD方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IStudentDao</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">crud</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="1-2-4-创建实体类的映射配置文件，需要和IUserDao相同的目录结构（若使用注解，在crud方法上添加注解）"><a href="#1-2-4-创建实体类的映射配置文件，需要和IUserDao相同的目录结构（若使用注解，在crud方法上添加注解）" class="headerlink" title="1.2.4 创建实体类的映射配置文件，需要和IUserDao相同的目录结构（若使用注解，在crud方法上添加注解）"></a>1.2.4 创建实体类的映射配置文件，需要和IUserDao相同的目录结构（若使用注解，在crud方法上添加注解）</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- namespace 确定方法在哪一个接口--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- id 代表是接口中crud哪一个方法--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- resultType 代表返回的结果封装到哪里去--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.lwclick.dao.IUserDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.lwclick.domain.User"</span>&gt;</span></span><br><span class="line">        select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  parameterType   方法含有参数，设置参数的类型</span></span><br><span class="line"><span class="comment">    	  #&#123;&#125; 代表占位符，由于此处是基本类型，可以随便写  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultType</span>=<span class="string">"com.lwclick.domain.User"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;uid&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ① parameterType   由于传入的参数是 User对象且配置了别名 所以此处使用user</span></span><br><span class="line"><span class="comment">    	 ② #&#123;&#125;  此处是User对象，所以写User对象中的属性名称,使用ONGL表达式【#&#123;对象.对象&#125;】</span></span><br><span class="line"><span class="comment">    	 ③ 【【【插入方法需要事务的提交 session.commit()】】】</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveUser"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置保存时获取插入的id --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyColumn</span>=<span class="string">"id"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">            select last_insert_id();</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into user(username, birthday, sex, address)</span><br><span class="line">        values(#&#123;username&#125;, #&#123;birthday&#125;, #&#123;sex&#125;, #&#123;address&#125;)  </span><br><span class="line">        <span class="comment">&lt;!-- 此处的username相当于User.username --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 模糊查询：  ··· like #&#123;username&#125; ——&gt;  userDao.findByName("%王%") --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="1-2-5-创建主配置文件（SqlMapConfig-xml）"><a href="#1-2-5-创建主配置文件（SqlMapConfig-xml）" class="headerlink" title="1.2.5 创建主配置文件（SqlMapConfig.xml）"></a>1.2.5 创建主配置文件（SqlMapConfig.xml）</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">   <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">   <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置外部环境连接数据库的jdbcConfig.properties文件放在resource下--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbcConfig.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置实体类的别名      配置之后，在映射文件中就可以直接写  user --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.lwclick.domain"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置mysql的环境--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置事务--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--配置连接池--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--  &lt;property name="driver" value="com.mysql.jdbc.Driver"/&gt; --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置映射文件的位置（实体类接口的）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此处的package是指定dao接口所在的包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.lwclick.dao"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="1-2-6-创建测试文件-Test-使用-before-after"><a href="#1-2-6-创建测试文件-Test-使用-before-after" class="headerlink" title="1.2.6 创建测试文件   @Test         使用@before     @after"></a>1.2.6 创建测试文件   @Test         使用@before     @after</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.读取配置文件，生成字节输入流</span></span><br><span class="line">InputStream in = Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.获取SqlSessionFactory工厂</span></span><br><span class="line">SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.获取SqlSession对象</span></span><br><span class="line">SqlSession sqlSession = factory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.获取dao的代理对象（动态代理）</span></span><br><span class="line">IUserDao userDao = sqlSession.getMapper(IUserDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.执行查询所有用户的方法</span></span><br><span class="line">List&lt;User&gt; users = userDao.findAll();</span><br><span class="line"><span class="keyword">for</span>(User user : users)&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.释放资源</span></span><br><span class="line">sqlSession.close();</span><br><span class="line">in.close();</span><br></pre></td></tr></table></figure>



<h4 id="1-3-mybatis工作流程"><a href="#1-3-mybatis工作流程" class="headerlink" title="1.3 mybatis工作流程"></a>1.3 mybatis工作流程</h4><ul>
<li>通过Reader对象读取Mybatis映射⽂件</li>
<li>通过SqlSessionFactoryBuilder对象创建SqlSessionFactory对象</li>
<li>获取当前线程的SQLSession</li>
<li>事务默认开启</li>
<li>通过SQLSession读取映射⽂件中的操作编号，从⽽读取SQL语句</li>
<li>提交事务</li>
<li>关闭资源</li>
</ul>
<h4 id="1-4-resultMap"><a href="#1-4-resultMap" class="headerlink" title="1.4 resultMap"></a>1.4 resultMap</h4><p>使⽤resultMap将<strong>列名</strong>和<strong>pojo的属性名</strong>做⼀个对应关系</p>
<p><strong>XML方式</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userListResultMap"</span> <span class="attr">type</span>=<span class="string">"user"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 列名</span></span><br><span class="line"><span class="comment">        id_, username_, birthday_</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        id：要映射结果集的唯⼀标识，称为主键</span></span><br><span class="line"><span class="comment">        column：结果集的列名</span></span><br><span class="line"><span class="comment">        property：type指定的哪个属性中</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id_"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- result就是普通列的映射配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username_"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday_"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注解方式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(id=<span class="string">"userMap"</span>,</span><br><span class="line">		value = &#123;</span><br><span class="line">            <span class="meta">@Result</span>(id=<span class="keyword">true</span>, cloumn=<span class="string">"id"</span>, property=<span class="string">"userId"</span>)</span><br><span class="line">            <span class="meta">@Result</span>(cloumn=<span class="string">"username"</span>, property=<span class="string">"userName"</span>)      属性名 和 列名 不相同时</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="动态SQL语句"><a href="#动态SQL语句" class="headerlink" title="动态SQL语句"></a>动态SQL语句</h2><p>自动拼接SQL语句，多个条件</p>
<h3 id="1-动态查询"><a href="#1-动态查询" class="headerlink" title="1. 动态查询"></a>1. 动态查询</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Mybatis简化编写SQL片段                    </span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"defaultSQL"</span>&gt;</span>                     </span><br><span class="line">	select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">引用</span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"defaultSQL"</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &lt;if&gt;标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByUser"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">	select * from user where 1=1</span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null and username != '' "</span>&gt;</span></span><br><span class="line">		and username like #&#123;username&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address != null"</span>&gt;</span></span><br><span class="line">		and address like #&#123;address&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &lt;where&gt;标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByUser"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">	select * from user </span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null and username != '' "</span>&gt;</span></span><br><span class="line">			and username like #&#123;username&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address != null"</span>&gt;</span></span><br><span class="line">			and address like #&#123;address&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-动态更新"><a href="#2-动态更新" class="headerlink" title="2. 动态更新"></a>2. 动态更新</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 动态更新 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不要忘了逗号 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updById"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    update user</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span></span><br><span class="line">        	username = #&#123;username&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address != null"</span>&gt;</span></span><br><span class="line">        	address = #&#123;address&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where userId = #&#123;userId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-动态删除"><a href="#3-动态删除" class="headerlink" title="3. 动态删除"></a>3. 动态删除</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 封装实体类QueryVo --&gt;</span></span><br><span class="line">private List<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> ids;   getter/setter</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- foreach⽤于迭代数组元素</span></span><br><span class="line"><span class="comment">	open表示开始符号</span></span><br><span class="line"><span class="comment">	删除编号为2，3，4的记录</span></span><br><span class="line"><span class="comment">	close表示结束符合</span></span><br><span class="line"><span class="comment">	separator表示元素间的分隔符</span></span><br><span class="line"><span class="comment">	item表示迭代的数组，属性值可以任意，但提倡与⽅法的数组名相同</span></span><br><span class="line"><span class="comment">	#&#123;ids&#125;表示数组中的每个元素值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">delete from user</span><br><span class="line"><span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ids != null and ids.size() &gt; 0"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">open</span>=<span class="string">" and id in ("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span>		#&#123;id&#125;</span><br><span class="line">     <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="主键生成策略UUID"><a href="#主键生成策略UUID" class="headerlink" title="主键生成策略UUID"></a>主键生成策略UUID</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mysql的uuid⽣成主键 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span> <span class="attr">resultType</span>=<span class="string">"string"</span>&gt;</span></span><br><span class="line">    	select uuid()</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    INSERT INTO USER(id,username,birthday,sex,address) VALUES(#&#123;id&#125;,#</span><br><span class="line">    &#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Mapper代理方式"><a href="#Mapper代理方式" class="headerlink" title="Mapper代理方式"></a>Mapper代理方式</h2><p>只用写dao，不用写daoImpl</p>
<ul>
<li>mapper的namespace 要与mapper接口的<strong>全限定类名</strong>相同</li>
<li>sql⽚段语句的 <strong>id ** 要与Dao接⼝的 **⽅法名</strong> 相同</li>
<li><strong>方法的参数和返回值</strong>要与SQL⽚段的<strong>接收参数类型</strong>（parameterType）和<strong>返回类型</strong>（resultType）相同。</li>
</ul>
<hr>
<h2 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h2><p><strong>需求： 查询账户信息，同时查询用户信息【一对一】</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">①账户的Dao接口</span><br><span class="line">	List<span class="tag">&lt;<span class="name">Account</span>&gt;</span> findAll();</span><br><span class="line">②账户的映射配置文件</span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"accountUserMap"</span> <span class="attr">type</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 账户信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- select:我们要调用的select映射的id </span></span><br><span class="line"><span class="comment">			 column:我们要传递给select映射的参数--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">javaType</span>=<span class="string">"user"</span> <span class="attr">select</span>=<span class="string">"com.lwclick.dao.IUserDao.findById"</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"accountUserMap"</span>&gt;</span></span><br><span class="line">        select * from account</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">③用户的持久层接口</span><br><span class="line">	User findById(Integer userId);</span><br><span class="line">④用户的映射配置文件</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        select * from user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">⑤在SqlMapConfig.xml中添加配置</span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">⑥测试文件</span><br><span class="line">	List<span class="tag">&lt;<span class="name">Account</span>&gt;</span> accounts = accountDao.findAll();</span><br></pre></td></tr></table></figure>



<p><strong>需求：完成加载用户对象时，查询该用户所拥有的账户信息</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">①User实体类中，加入账户的集合引用，还有getter/setter</span><br><span class="line">②用户和账户持久层接口中</span><br><span class="line">	List<span class="tag">&lt;<span class="name">User</span>&gt;</span> findAll();</span><br><span class="line">	List<span class="tag">&lt;<span class="name">Account</span>&gt;</span> findByUid(Integer uid);</span><br><span class="line">③用户的映射配置文件</span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userAccMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置user对象中accounts集合的映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"account"</span> <span class="attr">select</span>=<span class="string">"com.lwclick.dao.IAccountDao.findAccByUid"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userAccMap"</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">④账户的映射配置文件</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAccByUid"</span> <span class="attr">resultType</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">        select * from account where uid = #&#123;uid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">⑤在SqlMapConfig.xml中添加配置</span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">⑥测试文件</span><br><span class="line">	List<span class="tag">&lt;<span class="name">User</span>&gt;</span> users = userDao.findAll();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h3 id="1-什么是缓存"><a href="#1-什么是缓存" class="headerlink" title="1. 什么是缓存?"></a>1. 什么是缓存?</h3><p>​        存在于内存中的临时数据。</p>
<h3 id="2-为什么使用缓存"><a href="#2-为什么使用缓存" class="headerlink" title="2.为什么使用缓存?"></a>2.为什么使用缓存?</h3><p>​        减少和数据库的交互次数，提高执行效率。</p>
<h3 id="3-什么样的数据能使用缓存，什么样的数据不能使用"><a href="#3-什么样的数据能使用缓存，什么样的数据不能使用" class="headerlink" title="3. 什么样的数据能使用缓存，什么样的数据不能使用?"></a>3. 什么样的数据能使用缓存，什么样的数据不能使用?</h3><ul>
<li>适用于缓存：<ul>
<li>经常查询并且不经常改变的。</li>
<li>数据的正确与否对最终结果影响不大的。</li>
</ul>
</li>
<li>不适用于缓存：<ul>
<li>经常改变的数据</li>
<li>数据的正确与否对最终结果影响很大的。<ul>
<li>例如：商品的库存，银行的汇率，股市的牌价。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-Mybatis中的一级缓存和二级缓存"><a href="#4-Mybatis中的一级缓存和二级缓存" class="headerlink" title="4. Mybatis中的一级缓存和二级缓存?"></a>4. Mybatis中的一级缓存和二级缓存?</h3><h4 id="4-1-一级缓存（存储作用域为session）："><a href="#4-1-一级缓存（存储作用域为session）：" class="headerlink" title="4.1 一级缓存（存储作用域为session）："></a>4.1 一级缓存（<strong>存储作用域为session</strong>）：</h4><ul>
<li><strong>默认开启的</strong></li>
<li>它指的是Mybatis中SqlSession对象的缓存。</li>
<li>当我们执行查询之后，查询的结果会同时存入到SqlSession为我们提供一块区域中。</li>
<li>该区域的结构是一个<strong>perpetualCache  HashMap</strong>。当我们再次查询同样的数据，mybatis会先去sqlsession中查询是否有，有的话直接拿出来用。</li>
<li><strong>当SqlSession对象消失时(调用SqlSession的修改，添加，删除，commit()，close())，mybatis的一级缓存也就消失了。</strong></li>
</ul>
<h4 id="4-2-二级缓存（存储作用域为Mapper）"><a href="#4-2-二级缓存（存储作用域为Mapper）" class="headerlink" title="4.2 二级缓存（存储作用域为Mapper）"></a>4.2 二级缓存（存储作用域为Mapper）</h4><ul>
<li><p><strong>默认未开启</strong></p>
</li>
<li><p>它指的是Mybatis中SqlSessionFactory对象的缓存。由同一个SqlSessionFactory对象创建的SqlSession共享其缓存。    </p>
</li>
<li><p>二级缓存的使用步骤：</p>
<ul>
<li>第一步：让Mybatis框架支持二级缓存（在SqlMapConfig.xml中配置）默认开启</li>
<li>第二步：让当前的映射文件支持二级缓存（在IUserDao.xml中配置）<pre><code>&lt;cache&gt;&lt;/cache&gt;即支持</code></pre></li>
<li>第三步：让当前的操作支持二级缓存（在select标签中配置）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">useCache</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">	sql语句</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>进行CUD操作后，如果开启了二级缓存，只根据配置判断是否刷新</p>
</li>
</ul>
<hr>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p><strong>一对一映射【一个账户对应一个用户】（从表实体  包含一个主表实体的引用）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">①从表(账户)实体类中  包含  private User user;</span><br><span class="line">	包含getter/setter方法</span><br><span class="line"></span><br><span class="line">②在 账户类 的映射配置文件(从表的)中，定义返回的封装【单一的无法满足】   resultMap</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"accountUserMap"</span> <span class="attr">type</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 封装account的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"aid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span>    <span class="comment">&lt;!--id对应账户实体类中的，aid是数据库中别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 封装user的，一对一的关系映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">javaType</span>=<span class="string">"user"</span>&gt;</span>   </span><br><span class="line">        <span class="comment">&lt;!-- 用uid去确定user javaType:封装到哪个对象， 起了别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">③select语句</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"accountUserMap"</span>&gt;</span></span><br><span class="line">    select u.*, a.id as aid, a.uid, a.money from account a, user u where u.id = a.uid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">④Account测试类中</span><br><span class="line">List<span class="tag">&lt;<span class="name">Account</span>&gt;</span> accounts = accountDao.findAll();</span><br><span class="line">    for(Account account : accounts)&#123;</span><br><span class="line">        sout(account);</span><br><span class="line">        sout(account.getUser());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><strong>2.一对多映射【一个用户对应多个账户】（主表实体  包含从表实体的集合引用）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">①主表(用户)实体类中  </span><br><span class="line">	包含 private List<span class="tag">&lt;<span class="name">Account</span>&gt;</span> accounts;    getter/setter方法</span><br><span class="line"></span><br><span class="line">②在 用户类 映射配置文件中定义resultMap</span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userAccountMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- 封装user的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 封装account集合的，一对多的关系映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"account"</span>&gt;</span>    </span><br><span class="line">            <span class="comment">&lt;!-- ofType:集合中元素的类型，别名 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"aid"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span>     <span class="comment">&lt;!-- aid实体类中的别名 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"money"</span> <span class="attr">column</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">③select语句</span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userAccountMap"</span>&gt;</span></span><br><span class="line">    	select * form user u left outer join account a on u.id = a.uid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">④Account测试类中</span><br><span class="line">   List<span class="tag">&lt;<span class="name">User</span>&gt;</span> users = userDao.findAll();</span><br><span class="line">   for(User user : users)&#123;</span><br><span class="line">        sout(user);</span><br><span class="line">        sout(user.getAccounts());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p><strong>多对多映射【一个用户有多个角色，一个角色可以被赋予多个用户】（各自包含对方的一个集合引用）</strong></p>
<ol>
<li><p>建立两张表：用户，角色</p>
<ul>
<li>多对多关系需要使用中间表，其内包含各自的主键，在中间表中是外键。</li>
</ul>
</li>
<li><p>建立两个实体类：用户，角色</p>
<ul>
<li>体现多对多关系，各自包含一个集合引用</li>
</ul>
</li>
<li><p>建立两个配置文件：用户，角色</p>
</li>
<li><p>实现配置</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`role`</span> () <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user_role`</span> () <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">IRoleDao.xml</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"roleMap"</span> <span class="attr">type</span>=<span class="string">"role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleId"</span> <span class="attr">column</span>=<span class="string">"rid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleDesc"</span> <span class="attr">column</span>=<span class="string">"role_desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置多对多的映射，集合配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"users"</span> <span class="attr">ofType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询角色对应的用户  多对多--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">    SELECT u.*,r.id as rid,r.ROLE_NAME,r.ROLE_DESC FROM role r</span><br><span class="line">    left outer join user_role ur on r.id = ur.RID</span><br><span class="line">    left outer join user u on u.id = ur.uid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">IUserDao.xml</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置  角色集合  的映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roles"</span> <span class="attr">ofType</span>=<span class="string">"role"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleId"</span> <span class="attr">column</span>=<span class="string">"rid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleDesc"</span> <span class="attr">column</span>=<span class="string">"role_desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询所有用户--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">    SELECT u.*,r.id as rid,r.ROLE_NAME,r.ROLE_DESC FROM user u</span><br><span class="line">    left outer join user_role ur on u.id = ur.uid</span><br><span class="line">    left outer join role r on r.id = ur.rid</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="1-和-的区别是什么？"><a href="#1-和-的区别是什么？" class="headerlink" title="1. #{}和${}的区别是什么？"></a>1. #{}和${}的区别是什么？</h3><ul>
<li>#{}    （可以有效的防⽌SQL注⼊，提⾼系统安全性）<ul>
<li><strong>解析</strong>传递进来的参数数据</li>
<li><strong>预编译</strong>处理</li>
</ul>
</li>
<li>${}<ul>
<li>对传递进来的参数<strong>原样拼接</strong>在SQL中</li>
<li><strong>字符串替换</strong></li>
</ul>
</li>
</ul>
<h3 id="2-当实体类中的属性名和表中的字段名不一样-，怎么办-？"><a href="#2-当实体类中的属性名和表中的字段名不一样-，怎么办-？" class="headerlink" title="2.当实体类中的属性名和表中的字段名不一样 ，怎么办 ？"></a>2.当实体类中的属性名和表中的字段名不一样 ，怎么办 ？</h3><p>通过<resultMap> 来映射字段名和实体类属性名的⼀⼀对应的关系</p>
<h3 id="3-如何获取自动生成的-主-键值"><a href="#3-如何获取自动生成的-主-键值" class="headerlink" title="3. 如何获取自动生成的(主)键值?"></a>3. 如何获取自动生成的(主)键值?</h3><p>通过LAST_INSERT_ID()获取刚插⼊记录的⾃增主键值</p>
<p>在insert语句执⾏后，执⾏select  LAST_INSERT_ID()就可以获取⾃增主键。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"cn.itcast.mybatis.po.User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">    	select LAST_INSERT_ID()</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    INSERT INTO USER(username,birthday,sex,address) VALUES(#&#123;username&#125;,#</span><br><span class="line">    &#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="4-在mapper中如何传递多个参数"><a href="#4-在mapper中如何传递多个参数" class="headerlink" title="4. 在mapper中如何传递多个参数?"></a>4. 在mapper中如何传递多个参数?</h3><ul>
<li>使⽤占位符的思想<ul>
<li>在映射⽂件中使⽤<strong>#{0},#{1}</strong>代表传递进来的<strong>第⼏个参数</strong></li>
<li>使⽤<strong>@param注解</strong>:来命名参数</li>
</ul>
</li>
</ul>
<h3 id="5-Mybatis动态sql是做什么的？都有哪些动态sql？能简述⼀下动态sql的执行原理不？"><a href="#5-Mybatis动态sql是做什么的？都有哪些动态sql？能简述⼀下动态sql的执行原理不？" class="headerlink" title="5. Mybatis动态sql是做什么的？都有哪些动态sql？能简述⼀下动态sql的执行原理不？"></a>5. Mybatis动态sql是做什么的？都有哪些动态sql？能简述⼀下动态sql的执行原理不？</h3><ul>
<li>动态sql可以在Xml映射⽂件内，以标签的形式编写动态sql，完成<strong>逻辑判断</strong>和<strong>动态拼接sql</strong>的功能。</li>
<li>Mybatis提供了9种动态sql标签：trim| where| set| foreach| if| choose| when| otherwise| bind。</li>
<li><strong>执行原理</strong>：使⽤OGNL从sql参数对象中计算表达式的值，<strong>根据表达式的值动态拼接sql</strong>，以此来完成动态sql</li>
</ul>
<h3 id="6-Mybatis的Xml映射文件中，不同的Xml映射文件，id是否可以重复？"><a href="#6-Mybatis的Xml映射文件中，不同的Xml映射文件，id是否可以重复？" class="headerlink" title="6. Mybatis的Xml映射文件中，不同的Xml映射文件，id是否可以重复？"></a>6. Mybatis的Xml映射文件中，不同的Xml映射文件，id是否可以重复？</h3><ul>
<li>配置了namespace，  可以重复的，因为我们的Statement实际上就是namespace+id</li>
<li>如果没有配置namespace的话，那么相同的id就会导致覆盖了。</li>
</ul>
<h3 id="7-为什么说Mybatis是半自动ORM映射工具？它与全自动的区别？"><a href="#7-为什么说Mybatis是半自动ORM映射工具？它与全自动的区别？" class="headerlink" title="7. 为什么说Mybatis是半自动ORM映射工具？它与全自动的区别？"></a>7. 为什么说Mybatis是半自动ORM映射工具？它与全自动的区别？</h3><ul>
<li>Hibernate属于全⾃动ORM映射⼯具，查询关联对象或者关联集合对象时，可以<strong>根据对象关系模型直接获取</strong></li>
<li>Mybatis在查询关联对象或关联集合对象时，需要<strong>手动编写sql来完成</strong>，所以，称之为半⾃动ORM映射⼯具。</li>
</ul>
<h3 id="8-通常⼀个Xml映射文件，都会写⼀个Dao接口与之对应，请问，这个Dao接口的工作原理是什么？Dao接口里的方法，参数不同时，方法能重载吗？"><a href="#8-通常⼀个Xml映射文件，都会写⼀个Dao接口与之对应，请问，这个Dao接口的工作原理是什么？Dao接口里的方法，参数不同时，方法能重载吗？" class="headerlink" title="8. 通常⼀个Xml映射文件，都会写⼀个Dao接口与之对应，请问，这个Dao接口的工作原理是什么？Dao接口里的方法，参数不同时，方法能重载吗？"></a>8. 通常⼀个Xml映射文件，都会写⼀个Dao接口与之对应，请问，这个Dao接口的工作原理是什么？Dao接口里的方法，参数不同时，方法能重载吗？</h3><ul>
<li>Dao接⼝，就是⼈们常说的Mapper接⼝<ul>
<li>接⼝的全限名，就是映射⽂件中的namespace的值</li>
<li>接⼝的⽅法名，就是映射⽂件中MappedStatement的id值</li>
<li>接⼝⽅法内的参数，就是传递给sql的参数。</li>
</ul>
</li>
<li>Mapper接⼝是没有实现类的，当调⽤接⼝⽅法时，接⼝全限名+⽅法名拼接字符串作为key值，可唯⼀定位⼀个MappedStatement</li>
<li>Dao接⼝⾥的⽅法，是不能重载的，因为是全限名+⽅法名的保存和寻找策略。</li>
<li>Dao接⼝的⼯作原理是<strong>JDK动态代理</strong>，Mybatis运⾏时会使⽤JDK动态代理为Dao接⼝⽣成代理proxy对象，代理对象proxy会拦截接⼝⽅法，转⽽执⾏MappedStatement所代表的sql，然后将sql执⾏结果返回。</li>
</ul>
<h3 id="9-Mybatis⽐IBatis比较大的几个改进是什么"><a href="#9-Mybatis⽐IBatis比较大的几个改进是什么" class="headerlink" title="9. Mybatis⽐IBatis比较大的几个改进是什么"></a>9. Mybatis⽐IBatis比较大的几个改进是什么</h3><ul>
<li>有<strong>接口绑定</strong>,包括注解绑定sql和xml绑定Sql ,</li>
<li>动态sql由原来的节点配置变成<strong>OGNL表达式</strong>,</li>
<li>在⼀对⼀,⼀对多的时候<strong>引进了association</strong>,在⼀对多的时候<strong>引入了collection</strong>,不过都是在resultMap⾥⾯配置</li>
</ul>
<h3 id="10-接口绑定有几种实现方式-分别是怎么实现的"><a href="#10-接口绑定有几种实现方式-分别是怎么实现的" class="headerlink" title="10.  接口绑定有几种实现方式,分别是怎么实现的?"></a>10.  接口绑定有几种实现方式,分别是怎么实现的?</h3><p>​       接口绑定就是在mybatis中任意定义接口，然后把接口里面的方法和SQL语句绑定，然后直接调用方法</p>
<ul>
<li><strong>注解绑定</strong>,就是在接⼝的⽅法上⾯加上@Select@Update等注解⾥⾯包含Sql语句来绑定</li>
<li><strong>通过xml里面写SQL来绑定</strong>,在这种情况下,要指定xml映射⽂件⾥⾯的namespace必须为接⼝的全路径名.</li>
</ul>
<h3 id="11-Mybatis是如何进行分页的？分页插件的原理是什么？"><a href="#11-Mybatis是如何进行分页的？分页插件的原理是什么？" class="headerlink" title="11. Mybatis是如何进行分页的？分页插件的原理是什么？"></a>11. Mybatis是如何进行分页的？分页插件的原理是什么？</h3><ul>
<li>Mybatis使⽤<strong>RowBounds对象</strong>进⾏分⻚，它是针对ResultSet结果集执⾏的内存分⻚，⽽⾮物理分⻚，可以在sql内直接书写带有物理分⻚的参数来完成物理分⻚功能，也可以使⽤分⻚插件来完成物理分⻚。</li>
<li>分⻚插件的基本原理是使⽤Mybatis提供的插件接⼝，实现⾃定义插件，在插件的拦截⽅法内拦截待执⾏的sql，然后重写sql，根据dialect⽅⾔，添加对应的物理分⻚语句和物理分⻚参数。</li>
</ul>
<h3 id="12-简述Mybatis的插件运行原理，以及如何编写⼀个插件"><a href="#12-简述Mybatis的插件运行原理，以及如何编写⼀个插件" class="headerlink" title="12. 简述Mybatis的插件运行原理，以及如何编写⼀个插件"></a>12. 简述Mybatis的插件运行原理，以及如何编写⼀个插件</h3><ul>
<li>Mybatis仅可以编写针对ParameterHandler、ResultSetHandler、StatementHandler、Executor这4种接⼝的插件，Mybatis使⽤JDK的动态代理，为需要拦截的接⼝⽣成代理对象以实现接⼝⽅法拦截功能，每当执⾏这4种接⼝对象的⽅法时，就会进⼊拦截⽅法，具体就是InvocationHandler的invoke()⽅法，当然，只会拦截那些你指定需要拦截的⽅法。</li>
<li>实现Mybatis的Interceptor接⼝并复写intercept()⽅法，然后在给插件编写注解，指定要拦截哪⼀个接⼝的哪些⽅法即可，记住，别忘了在配置⽂件中配置你编写的插件。</li>
</ul>
<h3 id="13-Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？"><a href="#13-Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？" class="headerlink" title="13. Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？"></a>13. Mybatis是否支持延迟加载？如果支持，它的实现原理是什么？</h3><ul>
<li><p>Mybatis仅⽀持association关联对象和collection关联集合对象的延迟加载</p>
<ul>
<li>association指的就是⼀对⼀，collection指的就是⼀对多查询。</li>
<li>在Mybatis配置⽂件中，可以配置是否启⽤延迟加载<pre><code>lazyLoadingEnabled=true|false。</code></pre></li>
</ul>
</li>
<li><p>原理是，使⽤CGLIB创建⽬标对象的代理对象</p>
<ul>
<li><p>当调⽤⽬标⽅法时，进⼊拦截器⽅法，⽐如调⽤a.getB().getName()</p>
<p>拦截器invoke()⽅法发现a.getB()是null值，那么就会单独发送事先保存好的查询关联B对象的sql</p>
<p>把B查询上来，然后调⽤a.setB(b)，于是a的对象b属性就有值了，接着完成a.getB().getName()⽅法调⽤</p>
</li>
</ul>
</li>
</ul>
<h3 id="14-Mybatis都有哪些Executor执行器？它们之间的区别是什么？"><a href="#14-Mybatis都有哪些Executor执行器？它们之间的区别是什么？" class="headerlink" title="14. Mybatis都有哪些Executor执行器？它们之间的区别是什么？"></a>14. Mybatis都有哪些Executor执行器？它们之间的区别是什么？</h3><p>Mybatis有三种基本的Executor执⾏器，<strong>SimpleExecutor、ReuseExecutor、BatchExecutor。</strong></p>
<ul>
<li><strong>SimpleExecutor</strong>：每执⾏⼀次update或select，就开启⼀个Statement对象，<strong>用完立刻关闭</strong></li>
<li><strong>ReuseExecutor</strong>：执⾏update或select，以sql作为key查找Statement对象，存在就使⽤，不存在就创建，⽤完后，不关闭Statement对象，⽽是放置于Map&lt;String, Statement&gt;内，供下⼀次使⽤。简⾔之，就是<strong>重复使⽤Statement对象。</strong></li>
<li><strong>BatchExecutor</strong>：执⾏update（没有select，JDBC批处理不⽀持select），将所有sql都添加到批处理中（addBatch()），等待统⼀执⾏（executeBatch()），它缓存了多个Statement对象，每个Statement对象都是addBatch()完毕后，等待逐⼀执⾏executeBatch()批处理。<strong>与JDBC批处理相同。</strong></li>
</ul>
<h3 id="15-MyBatis与Hibernate有哪些不同？"><a href="#15-MyBatis与Hibernate有哪些不同？" class="headerlink" title="15. MyBatis与Hibernate有哪些不同？"></a>15. MyBatis与Hibernate有哪些不同？</h3><ul>
<li>Mybatis不完全是⼀个ORM框架，因为MyBatis需要程序员⾃⼰编写Sql语句。<ul>
<li>Mybatis直接编写<strong>原⽣态sql</strong>，可严格控制sql执⾏性能，⾮常<strong>适合对关系数据模型要求不⾼</strong>的软件开发，例如<strong>互联⽹软件、企业运营类软件</strong>等，因为这类软件<strong>需求变化频繁</strong>，⼀但需求变化要求成果输出迅速。</li>
<li>但是灵活的前提是mybatis⽆法做到数据库⽆关性，如果需要实现⽀持多种数据库的软件则需要⾃定义多套sql映射⽂件，⼯作量⼤。</li>
</ul>
</li>
<li>Hibernate对象/关系映射能⼒强，<strong>数据库无关性好</strong>，对于关系模型要求⾼的软件（例如<strong>需求固定的定制化软件</strong>）如果⽤hibernate开发可以节省很多代码，提⾼效率。</li>
</ul>
<h3 id="16-什么是mybatis"><a href="#16-什么是mybatis" class="headerlink" title="16. 什么是mybatis"></a>16. 什么是mybatis</h3><ul>
<li>mybatis是一个半ORM（对象关系映射）框架，内部封装了JDBC，开发时只关注SQL语句本身，其他驱动，连接等都不需要关注。</li>
<li>mybatis可以使用XML或注解来配置和映射原生信息，将POJO映射成数据库中的记录</li>
<li>通过XML文件或注解的方式将要执行的各种statement配置起来，并通过java对象和statement中sql的动态参数进行映射，生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射为java对象并返回。</li>
</ul>
<h3 id="17-mybatis的优点"><a href="#17-mybatis的优点" class="headerlink" title="17. mybatis的优点"></a>17. mybatis的优点</h3><ul>
<li>基于sql语句编程，不会对程序或数据库的现有设计造成影响</li>
<li>sql写在XML中，解除了SQL与程序代码的耦合，便于统一管理</li>
<li>提供XML标签，支持编写动态的SQL语句</li>
<li>与JDBC相比，减少了50%以上的代码量</li>
<li>能够与spring很好的集成，与数据库的兼容性好</li>
<li>提供映射标签，支持对象与数据库的ORM字段关系映射</li>
</ul>
<p>缺点：</p>
<ul>
<li>SQL语句的编写工作量较大</li>
<li>SQL语句依赖于数据库，不能随意更换数据库</li>
</ul>
<h3 id="18-mybatis是如何将sql执行结果封装为目标对象并返回的？"><a href="#18-mybatis是如何将sql执行结果封装为目标对象并返回的？" class="headerlink" title="18. mybatis是如何将sql执行结果封装为目标对象并返回的？"></a>18. mybatis是如何将sql执行结果封装为目标对象并返回的？</h3><ul>
<li>第一种：使用<resultMap>标签，逐一定义数据库列名和对象属性名之间的映射关系</li>
<li>第二种：使用sql列的别名功能，将列的别名书写为对象属性名</li>
</ul>
<p>有了映射关系之后，mybatis 通过反射创建对象，同时使用反射给对象的属性逐一赋值并返回，找不到映射关系的，无法赋值</p>
<h3 id="19-mybatis实现一对一（一对多）有几种方式？"><a href="#19-mybatis实现一对一（一对多）有几种方式？" class="headerlink" title="19. mybatis实现一对一（一对多）有几种方式？"></a>19. mybatis实现一对一（一对多）有几种方式？</h3><ul>
<li>联合查询：几个表联合查询，只查询一次，通过在resultMap里面配置association节点配置一对一</li>
<li>嵌套查询：先查询一个表，再根据这个表里的结果的外键id，去另一个表中查询数据，也是通过association配置，但是另一个表的查询通过select属性配置。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/JSP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xCoding">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="绝对领域">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/15/JSP/" itemprop="url">JSP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-15T20:57:27+08:00">
                2020-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fighting/" itemprop="url" rel="index">
                    <span itemprop="name">fighting</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2020/05/15/JSP/" class="leancloud_visitors" data-flag-title="JSP">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  17
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="JSP入门"><a href="#JSP入门" class="headerlink" title="JSP入门"></a>JSP入门</h2><ol>
<li><p>JSP全名为Java Server Pages，java服务器⻚⾯。JSP是⼀种基于⽂本的程序，其特点就是<strong>HTML和Java</strong><br><strong>代码共同存在！</strong></p>
</li>
<li><p>JSP本身就是⼀种Servlet，Tomcat访问任何的资源都是在访问Servlet！</p>
<p><strong>JSP就是封装了Servlet的java程序</strong></p>
</li>
<li><p>编译原理：</p>
<p>浏览器第⼀次请求1.jsp时，Tomcat会将1.jsp转化成1_jsp.java这么⼀个类，并<br>将该⽂件编译成class⽂件。编译完毕后再运⾏class⽂件来响应浏览器的请求。</p>
</li>
<li><p>生命周期：</p>
<p>运⾏时只有⼀个实例，JSP初始化和销毁时也会调⽤Servlet的init()和destroy()⽅法</p>
</li>
<li><p>JSP脚本（java代码）</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用 &lt;% %&gt; 括起来</span><br><span class="line"></span><br><span class="line">表达式输出（各种类型的变量）：&lt;%=%&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>JSP指令</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@指令 属性名=<span class="string">"值"</span> %&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>page指令</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>中⽂乱码问题</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在page指令中指定contentType=<span class="string">"text/html;charset=UTF-8"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>跳转到错误页面（404， NullPointerException）</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;error-page&gt;</span><br><span class="line">    &lt;error-code&gt;404&lt;/error-code&gt;</span><br><span class="line">    &lt;location&gt;/error.jsp&lt;/location&gt;</span><br><span class="line">&lt;/error-page&gt;</span><br><span class="line">&lt;error-page&gt;</span><br><span class="line">    &lt;exception-type&gt;java.lang.NullPointerException&lt;/exception-type&gt;</span><br><span class="line">    &lt;location&gt;/error.jsp&lt;/location&gt;</span><br><span class="line">&lt;/error-page&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>include指令，静态包含页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"head.jsp"</span> %&gt;</span><br><span class="line"></span><br><span class="line">把⽂件的代码内容都包含进来，再编译</span><br></pre></td></tr></table></figure>

<p>include行为，动态包含</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:include page=<span class="string">"head.jsp"</span>/&gt;</span><br><span class="line"></span><br><span class="line">先编译被包含的⻚⾯，再将⻚⾯的结果写⼊到包含的⻚⾯中</span><br></pre></td></tr></table></figure>
</li>
<li><p>param行为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">当使⽤ jsp:include 和 jsp:forward⾏为 引⼊或将请求转发给其它资源时</span><br><span class="line">可以使⽤jsp:param⾏为向这个资源传递参数。</span><br><span class="line"></span><br><span class="line">&lt;jsp:include page="head.jsp"&gt; &lt;jsp:param&gt;&lt;/jsp:param&gt; &lt;jsp:include&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>forward行为</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:forward page=<span class="string">"head.jsp"</span>&gt;</span><br><span class="line">	&lt;jsp:param name=<span class="string">"username"</span> value=<span class="string">"lwclick"</span>/&gt;</span><br><span class="line">&lt;/jsp:forward&gt;</span><br><span class="line"></span><br><span class="line">访问<span class="number">1</span>.jsp⻚⾯就跳转到head.jsp⻚⾯中</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">	String ss = request.getParameter(<span class="string">"username"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">获取到的参数是：</span><br><span class="line">&lt;%=ss%&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="内置对象、属性范围"><a href="#内置对象、属性范围" class="headerlink" title="内置对象、属性范围"></a>内置对象、属性范围</h2><h3 id="1-九个内置对象："><a href="#1-九个内置对象：" class="headerlink" title="1. 九个内置对象："></a>1. 九个内置对象：</h3><ul>
<li><p>pageContext</p>
<ul>
<li>pageContext.getSession。。。。。()       获取其他8个内置对象</li>
<li>set/get/removeAttribute（多了一个scope），多了一个find</li>
</ul>
<p>page —&gt; request –&gt; session  –&gt;  application</p>
</li>
<li><p>page</p>
<ul>
<li>page是HttpJasPage对象</li>
<li>page对象相当于普通java类的this</li>
</ul>
</li>
</ul>
<ul>
<li><p>config</p>
<ul>
<li>config其实就是ServletConfig</li>
</ul>
</li>
</ul>
<ul>
<li><p>request</p>
<ul>
<li><p>request其实就是HttpServletRequest</p>
</li>
<li><p>set/get/removeAttribute</p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>response</p>
<ul>
<li>response其实就是HttpServletResponse</li>
</ul>
</li>
</ul>
<ul>
<li><p>session</p>
<ul>
<li>session其实就是HttpSession</li>
<li>page指令配置如下信息，session将不可使⽤          &lt;%@page session=”false” %&gt;</li>
<li>set/get/removeAttribute</li>
</ul>
</li>
</ul>
<ul>
<li><p>application</p>
<ul>
<li>application其实就是ServletContext对象</li>
<li>set/get/removeAttribute</li>
</ul>
</li>
</ul>
<ul>
<li><p>exception</p>
<ul>
<li>exception是java.lang.Exception类的对象</li>
</ul>
</li>
</ul>
<ul>
<li><p>out</p>
<ul>
<li>out对象⽤于向浏览器输出数据，与之对应的是Servlet的PrintWriter对象。（out带缓存）</li>
<li>在JSP⻚⾯输出都是⽤<strong>表达式（&lt;%=%&gt;)</strong></li>
</ul>
</li>
</ul>
<h3 id="2-四种属性范围（set-get-removeAttribute）"><a href="#2-四种属性范围（set-get-removeAttribute）" class="headerlink" title="2. 四种属性范围（set/get/removeAttribute）"></a>2. 四种属性范围（set/get/removeAttribute）</h3><ul>
<li>page【只在⼀个⻚⾯中保存属性，跳转⻚⾯⽆效】</li>
<li>requet【只在⼀次请求中保存属性，服务器跳转有效，浏览器跳转⽆效】<ol start="2">
<li>⽤户看完就没⽤了</li>
</ol>
</li>
<li>session【在⼀个会话范围中保存属性，⽆论何种跳转均有效，关闭浏览器后⽆效】<ol start="3">
<li>⽤户⽤完了等⼀会⼉还有⽤</li>
</ol>
</li>
<li>application【在整个服务器中保存，所有⽤户都可以使⽤】<ol start="4">
<li>⽤户⽤完了，还要给其它⽤户⽤</li>
</ol>
</li>
</ul>
<hr>
<h2 id="JavaBean"><a href="#JavaBean" class="headerlink" title="JavaBean"></a>JavaBean</h2><ol>
<li><p>实体类</p>
</li>
<li><p>⼀张表使⽤一个bean类</p>
<p>规则：</p>
<ul>
<li>有<strong>无参的构造函数</strong></li>
<li>成员属性<strong>私有化</strong></li>
<li>封装的属性如果需要被外所操作，必须编写public类型的<strong>setter、getter⽅法</strong></li>
</ul>
</li>
<li><p><strong>jsp:useBean</strong></p>
<p><strong>在指定的域范围内查找指定名称的JavaBean对象</strong></p>
<ul>
<li><p>存在则直接返回该JavaBean对象的引⽤</p>
</li>
<li><p>不存在则实例化⼀个新的JavaBean对象并将它以指定的名称存储到指定的域范围中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id&#x3D;&quot;实例化对象的名称&quot; class&#x3D;&quot;类的全名&quot; scope&#x3D;&quot;保存范围&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;jsp:useBean id=<span class="string">"person"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"domain.Person"</span> scope=<span class="string">"page"</span>/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    person.setName(<span class="string">"lwclick"</span>);</span><br><span class="line">    System.out.println(person.getName());</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>jsp:setProperty</strong></p>
<p><strong>获取表单的信息，然后导入到javaBean对象</strong>               设置属性的值</p>
<ul>
<li><p>&lt;jsp:setProperty name=”对象名称” property=”*”/&gt;                   ⾃动匹配</p>
</li>
<li><p>&lt;jsp:setProperty name=”对象名称” property=”属性名称”/&gt;        指定属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/zhongfucheng/1.jsp"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    ⽤户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text "</span> <span class="attr">name</span>=<span class="string">"age"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">"person"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"domain.Person"</span> scope=<span class="string">"page"</span>/&gt;</span><br><span class="line">&lt;%--指定属性名称为age--%&gt;</span><br><span class="line">&lt;jsp:setProperty name=<span class="string">"person"</span> property=<span class="string">"age"</span>/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	System.out.println(person.getAge());</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>JavaBean属性名要和表单的name的名称⼀致</strong></p>
</li>
</ul>
</li>
<li><p><strong>jsp:getProperty</strong></p>
<p><strong>输出内容</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:getProperty name=<span class="string">"对象名"</span> property=<span class="string">"属性名"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--使⽤&lt;jsp:getProperty&gt;输出--%&gt;</span><br><span class="line">&lt;jsp:getProperty name=<span class="string">"person"</span> property=<span class="string">"username"</span>/&gt;</span><br><span class="line">&lt;jsp:getProperty name=<span class="string">"person"</span> property=<span class="string">"age"</span>/&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h2 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h2><ul>
<li><p><strong>EL表达式是用 “${}” 括起来的脚本，主要用来读取数据，进行内容的显示！</strong></p>
</li>
<li><p><strong>如果找不到相应的对象属性，返回的的空白字符串“”，而不是null</strong></p>
</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">demo1.jsp</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">//向session设置⼀个属性</span></span><br><span class="line">    session.setAttribute(<span class="string">"name"</span>, <span class="string">"aaa"</span>);</span><br><span class="line">    System.out.println(<span class="string">"向session设置了⼀个属性"</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">demo2.jsp</span><br><span class="line">$&#123;name&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>获取域对象的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">application.setAttribute(&quot;name&quot;, &quot;aaa&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;name&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取JavaBean的属性</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">"person"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"domain.Person"</span> scope=<span class="string">"session"</span>/&gt;</span><br><span class="line">&lt;jsp:setProperty name=<span class="string">"person"</span> property=<span class="string">"age"</span> value=<span class="string">"22"</span>/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;person.age&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取集合的数据–list</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    List&lt;Person&gt; list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    </span><br><span class="line">    Person person1 = <span class="keyword">new</span> Person();</span><br><span class="line">    person1.setUsername(<span class="string">"lwclick"</span>);</span><br><span class="line">    </span><br><span class="line">    Person person2 = <span class="keyword">new</span> Person();</span><br><span class="line">    person2.setUsername(<span class="string">"hello"</span>);</span><br><span class="line">    </span><br><span class="line">    list.add(person1);</span><br><span class="line">    list.add(person2);</span><br><span class="line">    </span><br><span class="line">    session.setAttribute(<span class="string">"list"</span>,list);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;list[<span class="number">0</span>].username&#125;</span><br></pre></td></tr></table></figure>

<p>获取集合的数据–map</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    Map&lt;String, Person&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    Person person1 = <span class="keyword">new</span> Person();</span><br><span class="line">    person1.setUsername(<span class="string">"lwclick"</span>);</span><br><span class="line"></span><br><span class="line">    Person person2 = <span class="keyword">new</span> Person();</span><br><span class="line">    person2.setUsername(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line">    map.put(<span class="string">"aa"</span>,person1);</span><br><span class="line">    map.put(<span class="number">1</span>,person2);</span><br><span class="line"></span><br><span class="line">    session.setAttribute(<span class="string">"map"</span>,map);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;map.aa.username&#125;</span><br><span class="line">$&#123;map[<span class="string">"1"</span>].username&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>简单运算</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	List&lt;Person&gt; list = <span class="keyword">null</span>;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;list==<span class="keyword">null</span>?<span class="string">"list集合为空"</span>:<span class="string">"list集合不为空"</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果获取到的数据为null，输出空⽩字符串””！这个特点可以让我们数据回显</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setGender(<span class="string">"male"</span>);</span><br><span class="line">    <span class="comment">//数据回显</span></span><br><span class="line">    request.setAttribute(<span class="string">"user"</span>,user);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;input type=<span class="string">"radio"</span> name=<span class="string">"gender"</span> value=<span class="string">"male"</span></span><br><span class="line">$&#123;user.gender==<span class="string">'male'</span>?<span class="string">'checked'</span>:<span class="string">''</span> &#125;&gt;男</span><br><span class="line">&lt;input type=<span class="string">"radio"</span> name=<span class="string">"gender"</span> value=<span class="string">"female"</span></span><br><span class="line">$&#123;user.gender==<span class="string">'female'</span>?<span class="string">'checked'</span>:<span class="string">''</span> &#125;&gt;⼥</span><br></pre></td></tr></table></figure>
</li>
<li><p>fn⽅法库全都是跟字符串有关的</p>
<ul>
<li>导⼊开发包（jstl.jar、standard.jar)</li>
<li>&lt;%@taglib prefix=”fn” uri=”<a href="http://java.sun.com/jsp/jstl/functions&quot;" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/functions&quot;</a> %&gt;</li>
</ul>
</li>
</ol>
<hr>
<h2 id="JSTL"><a href="#JSTL" class="headerlink" title="JSTL"></a>JSTL</h2><p>JSP Standard Tag Library 即JSP标准标签库。</p>
<p>集合的遍历、数据的输出、字符串的处理、数据的格式化</p>
<ul>
<li>导⼊开发包（jstl.jar、standard.jar)</li>
<li>&lt;%@taglib prefix=”fn” uri=”<a href="http://java.sun.com/jsp/jstl/functions&quot;" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/functions&quot;</a> %&gt;</li>
</ul>
<h3 id="core标签库"><a href="#core标签库" class="headerlink" title="core标签库"></a>core标签库</h3><p>流程控制、迭代输出，前缀⼀般是c</p>
<ul>
<li><h4 id="c-out"><a href="#c-out" class="headerlink" title="c:out"></a>c:out</h4><ul>
<li>value属性：指定要输出的内容</li>
<li>escapeXml：将特殊字符进行HTML编码后再输出，默认true</li>
</ul>
</li>
<li><p>default：如果value的值为null时输出的默认值</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	session.setAttribute(<span class="string">"name"</span>, <span class="string">"zhongfucheng"</span>);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:out value=<span class="string">"$&#123;name&#125;"</span> <span class="keyword">default</span>=<span class="string">"您要的数据找不着"</span> escapeXml=<span class="string">"true"</span>/&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-set"><a href="#c-set" class="headerlink" title="c:set"></a>c:set</h4><ul>
<li>value：指定属性值</li>
<li>var：指定要设置的web域属性的名称（Integer、Double、String等类型的数据）</li>
<li>scope：指定属性所在的web域</li>
<li>target：执行要设置属性的对象（JavaBean或Map对象的数据）</li>
<li>property：当前要为对象设置的属性名称</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> scope=<span class="string">"page"</span>&gt;         【存在<span class="keyword">var</span>就不存在property】</span><br><span class="line">	lwclick</span><br><span class="line">&lt;/c:set&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;name&#125;</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">【计数器效果】</span><br><span class="line">&lt;%</span><br><span class="line">    Integer sessionCount = <span class="number">0</span>;</span><br><span class="line">    Integer applicationCount = <span class="number">0</span>;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"sessionCount"</span> value=<span class="string">"$&#123;sessionCount+1&#125;"</span> scope=<span class="string">"session"</span>/&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"applicationCount"</span> value=<span class="string">"$&#123;applicationCount+1&#125;"</span></span><br><span class="line">scope=<span class="string">"application"</span>/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">                                        【target属性，结合property，不能有<span class="keyword">var</span>】</span><br><span class="line">&lt;%--创建出JavaBean对象，设置为session范围的属性--%&gt;</span><br><span class="line">&lt;jsp:useBean id=<span class="string">"person"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"domain.Person"</span> scope=<span class="string">"session"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--获取到person对象，设置age属性的值为<span class="number">32</span>--%&gt;</span><br><span class="line">&lt;c:set target=<span class="string">"$&#123;person&#125;"</span> property=<span class="string">"age"</span> value=<span class="string">"32"</span>/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;person.age&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-remove"><a href="#c-remove" class="headerlink" title="c:remove"></a>c:remove</h4><p>删除域范围</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--创建出JavaBean对象，设置为session范围的属性--%&gt;</span><br><span class="line">&lt;jsp:useBean id=<span class="string">"person"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"domain.Person"</span> scope=<span class="string">"session"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--获取到person对象，设置age属性的值为<span class="number">32</span>--%&gt;</span><br><span class="line">&lt;c:set target=<span class="string">"$&#123;person&#125;"</span> property=<span class="string">"age"</span> value=<span class="string">"32"</span>/&gt;</span><br><span class="line"></span><br><span class="line">$&#123;person.age&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;%--删除session属性--%&gt;</span><br><span class="line">&lt;c:remove var="person" scope="session"&gt;&lt;/c:remove&gt;</span><br><span class="line"></span><br><span class="line">$&#123;person.age==<span class="keyword">null</span>?<span class="string">"存在session的person对象被删除了！"</span>:<span class="string">"我还在呢！"</span>&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-catch"><a href="#c-catch" class="headerlink" title="c:catch"></a>c:catch</h4><p>处理程序中产⽣的异常</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--创建出JavaBean对象，设置为session范围的属性--%&gt;</span><br><span class="line">&lt;jsp:useBean id=<span class="string">"person"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"domain.Person"</span> scope=<span class="string">"session"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:<span class="keyword">catch</span> <span class="keyword">var</span>=<span class="string">"message"</span>&gt;</span><br><span class="line">    &lt;%--target属性只能是EL表达式，现在是字符串，获取不到对象，肯定会抛出异常的--%&gt;</span><br><span class="line">    &lt;c:set target=<span class="string">"person"</span> property=<span class="string">"age"</span> value=<span class="string">"32"</span>/&gt;</span><br><span class="line">&lt;/c:catch&gt;</span><br><span class="line"></span><br><span class="line">$&#123;message&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-if"><a href="#c-if" class="headerlink" title="c:if"></a>c:if</h4><ul>
<li><strong>test</strong>：决定是否处理标签体中的内容的条件表达式</li>
<li>var：用于指定test属性的执行结果保存到某个web域中的某个属性的名称</li>
<li>scope：指定将test属性的执行结果保存到哪个web域中</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--如果带过来的名字是lwclick，那么可以登陆--%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;param.name=='lwclick'&#125;"</span>&gt;</span><br><span class="line">    ⽤户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;&lt;br&gt;</span><br><span class="line">    密码：&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt;&lt;br&gt;</span><br><span class="line">	&lt;input type=<span class="string">"submit"</span> value=<span class="string">"登陆"</span>&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;%--如果带过来的名字是ouzicheng，那么就是注册--%&gt;</span><br><span class="line">&lt;c:<span class="keyword">if</span> test=<span class="string">"$&#123;param.name=='ouzicheng'&#125;"</span>&gt;</span><br><span class="line">    ⽤户名：&lt;input type=<span class="string">"text"</span> name=<span class="string">"username"</span>&gt;&lt;br&gt;</span><br><span class="line">    密码：&lt;input type=<span class="string">"password"</span> name=<span class="string">"password"</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"注册"</span>&gt;</span><br><span class="line">&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-choose（if-else）"><a href="#c-choose（if-else）" class="headerlink" title="c:choose（if-else）"></a>c:choose（if-else）</h4><p><strong>if else流程</strong>就需要使⽤choose标签,<strong>choose标签需要联合when和otherwise标签⼀起使⽤</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">"$&#123;param.name=='lwclick'&#125;"</span>&gt;</span><br><span class="line">    	你好啊，lwclick</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;c:when test=<span class="string">"$&#123;param.name=='ouzicheng'&#125;"</span>&gt;</span><br><span class="line">    	你好啊，ouzicheng</span><br><span class="line">    &lt;/c:when&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;c:otherwise&gt;</span><br><span class="line">    	你是谁啊？别随便过来！</span><br><span class="line">    &lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-forEach"><a href="#c-forEach" class="headerlink" title="c:forEach"></a>c:forEach</h4><ul>
<li><p>var：指定将当前迭代到的 <strong>元素</strong> 保存到page这个web域中的<strong>属性名称</strong></p>
</li>
<li><p>items：将要<strong>迭代的集合对象</strong></p>
</li>
<li><p>begin：如果指定items属性，就从集合的第begin个元素开始迭代（从0开始编号）</p>
<p>​              如果没有指定，就从begin指定的值开始迭代，直到end值结束</p>
</li>
<li><p>end</p>
</li>
<li><p>step：迭代的步长</p>
</li>
<li><p>varStatus：当前被遍历对象的信息</p>
<ul>
<li><p>index【返回当前是第⼏个对象，从0开始计数】</p>
</li>
<li><p>count【已经遍历多少个对象了，从1开始计数】</p>
</li>
<li><p>current【当前被迭代的对象】</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"list"</span> items=<span class="string">"$&#123;list&#125;"</span> varStatus=<span class="string">"varStatus"</span> &gt;</span><br><span class="line">	$&#123;list&#125;您的下标是:$&#123;varStatus.index&#125;&lt;br&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">设置值--list</span><br><span class="line">&lt;%</span><br><span class="line">    List list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">"zhongfucheng"</span>);</span><br><span class="line">    list.add(<span class="string">"ouzicheng"</span>);</span><br><span class="line">    list.add(<span class="string">"xiaoming"</span>);</span><br><span class="line">    </span><br><span class="line">    session.setAttribute(<span class="string">"list"</span>, list);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">设置值--map</span><br><span class="line">&lt;%</span><br><span class="line">    Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">    map.put(<span class="string">"1"</span>, <span class="string">"zhongfucheng"</span>);</span><br><span class="line">    map.put(<span class="string">"2"</span>, <span class="string">"xiaohong"</span>);</span><br><span class="line">    map.put(<span class="string">"3"</span>, <span class="string">"xiaoming"</span>);</span><br><span class="line"></span><br><span class="line">    session.setAttribute(<span class="string">"map"</span>,map);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">【items：即将要迭代的集合。<span class="keyword">var</span>：当前迭代到的元素】</span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"index"</span> items=<span class="string">"$&#123;list&#125;"</span> &gt;</span><br><span class="line">	$&#123;index&#125;&lt;br&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">"m"</span> items=<span class="string">"$&#123;map&#125;"</span> &gt;</span><br><span class="line">	$&#123;m.key&#125;  $&#123;m.value&#125;&lt;br&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-forTokens"><a href="#c-forTokens" class="headerlink" title="c:forTokens"></a>c:forTokens</h4><p>类似于String类的split()  和  for循环的⼀种集合，<strong>items属性⾥⾯是字符串</strong>，这个字符串会被<strong>delims属性的内容</strong>分割成多个字符串</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forTokens items=<span class="string">"lwclick,lw,lr,xiaoming"</span> <span class="keyword">var</span>=<span class="string">"name"</span> delims=<span class="string">","</span> &gt;</span><br><span class="line">	$&#123;name&#125;</span><br><span class="line">&lt;/c:forTokens&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-import"><a href="#c-import" class="headerlink" title="c:import"></a>c:import</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类似于JSP⾏为&lt;jsp:include&#x2F;&gt; 和JSP指令&lt;%include&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>url【指定要包含的路径，<strong>Internet所有的url都可以</strong>】</li>
<li>context【访问同⼀个web容器的其他资源，以”/“开头】</li>
<li>var【保存导⼊的⽂件的内容，以String类型存储】</li>
<li>socpe【保存的范围，默认是page】</li>
<li>charEncoding【字符编码】</li>
<li>varReader【保存导⼊⽂件的内容，以Reader类型存储】</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:<span class="keyword">import</span> url=<span class="string">"http://www.csdn.net"</span> charEncoding=<span class="string">"UTF-8"</span> /&gt;</span><br><span class="line"></span><br><span class="line">CSDN的源码是：&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;c:out value="$&#123;net&#125;" escapeXml="true"&gt;&lt;/c:out&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-param"><a href="#c-param" class="headerlink" title="c:param"></a>c:param</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:param标签可以嵌套在c:import、c:url或c:redirect标签内，为这些标签所使⽤的URL地址附加参数。</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-url"><a href="#c-url" class="headerlink" title="c:url"></a>c:url</h4><ul>
<li>value：指定要构造的URL</li>
<li>var：指定将要构造的URL结果保存到web域中的<strong>属性名称</strong></li>
<li>scope：指定将构造出的URL结果<strong>保存到哪个web域中</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:url value=<span class="string">"2.jsp"</span> <span class="keyword">var</span>=<span class="string">"url"</span>&gt;</span><br><span class="line">    &lt;c:param name=<span class="string">"name"</span> value=<span class="string">"中国！"</span>&gt;</span><br><span class="line">    &lt;/c:param&gt;</span><br><span class="line">&lt;/c:url&gt;</span><br><span class="line"></span><br><span class="line">&lt;a href="$&#123;url&#125;"&gt;我经过了URL地址重写！&lt;/a&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><h4 id="c-redirect"><a href="#c-redirect" class="headerlink" title="c:redirect"></a>c:redirect</h4><p>用于实现Redirect功能，当然了，此标签也能够配合param标签使⽤！</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">重定向到<span class="number">2</span>.jsp，带了⼀个参数：</span><br><span class="line"></span><br><span class="line">&lt;c:redirect url=<span class="string">"2.jsp"</span> &gt;</span><br><span class="line">	&lt;c:param name=<span class="string">"name"</span> value=<span class="string">"zhongfucheng"</span>&gt;</span><br><span class="line">	&lt;/c:param&gt;</span><br><span class="line">&lt;/c:redirect&gt;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="自定义标签"><a href="#自定义标签" class="headerlink" title="自定义标签"></a>自定义标签</h2><p>某些复杂类型转换，或者逻辑处理的时候，JSTL标签库完成不了，需要⾃定义标签!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 编写⼀个实现Tag接⼝的Java类【标签处理器类】</span><br><span class="line"></span><br><span class="line">2. 在WEB-INF⽬录下创建tld(Tag Library Descriptor)⽂件，在tld⽂件中对标签处理类（实现Tag接⼝的Java类）进⾏描述</span><br></pre></td></tr></table></figure>



<h2 id="简单标签"><a href="#简单标签" class="headerlink" title="简单标签"></a>简单标签</h2><p>实现了SimpeTag接⼝的标签</p>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="1-jsp静态包含和动态包含的区别"><a href="#1-jsp静态包含和动态包含的区别" class="headerlink" title="1. jsp静态包含和动态包含的区别"></a>1. jsp静态包含和动态包含的区别</h3><ul>
<li><p><strong>include指令</strong>是静态包含。静态包含的意思就是：<strong>把⽂件的代码内容都包含进来，再编译！</strong></p>
</li>
<li><p><strong>include⾏为</strong>是动态包含。其实include⾏为就是封装了request.getRequestDispatcher(String url).include(request,response)，<strong>先编译被包含的页面，再将页面的结果写⼊到包含的页面中</strong></p>
</li>
</ul>
<h3 id="2-jsp有哪些内置对象-作⽤分别是什么"><a href="#2-jsp有哪些内置对象-作⽤分别是什么" class="headerlink" title="2. jsp有哪些内置对象?作⽤分别是什么?"></a>2. jsp有哪些内置对象?作⽤分别是什么?</h3><ol>
<li>request ⽤户端请求，此请求会包含来⾃GET/POST请求的参数</li>
<li>response ⽹⻚传回⽤户端的回应</li>
<li>pageContext ⽹⻚的属性是在这⾥管理，代表的编译后JSP内容</li>
<li>session 与请求有关的会话期</li>
<li>application servlet 正在执⾏的内容</li>
<li>out ⽤来传送回应的输出</li>
<li>config servlet的构架部件</li>
<li>page JSP⽹⻚本身</li>
<li>exception 针对错误⽹⻚，未捕捉的例外</li>
</ol>
<h3 id="3-jsp和servlet的区别、共同点、各⾃应⽤的范围？"><a href="#3-jsp和servlet的区别、共同点、各⾃应⽤的范围？" class="headerlink" title="3. jsp和servlet的区别、共同点、各⾃应⽤的范围？"></a>3. jsp和servlet的区别、共同点、各⾃应⽤的范围？</h3><ol>
<li>JSP是Servlet技术的扩展，本质上就是Servlet的简易⽅式。JSP编译后是“类servlet”。</li>
<li>Servlet和JSP最主要的不同点在于：Servlet的应⽤逻辑是在Java⽂件中，并且完全从表示层中的<br>HTML⾥分离开来。⽽JSP的情况是Java和HTML可以组合成⼀个扩展名为.jsp的⽂件。</li>
<li>JSP侧重于视图，Servlet主要⽤于控制逻辑。</li>
</ol>
<h3 id="4-属性作用域范围"><a href="#4-属性作用域范围" class="headerlink" title="4. 属性作用域范围"></a>4. 属性作用域范围</h3><ol>
<li>page【只在⼀个⻚⾯中保存属性，跳转⻚⾯⽆效】</li>
<li>requet【只在⼀次请求中保存属性，服务器跳转有效，浏览器跳转⽆效】</li>
<li>session【在⼀个会话范围中保存属性，⽆论何种跳转均有效，关闭浏览器后⽆效】</li>
<li>application【在整个服务器中保存，所有⽤户都可以使⽤】</li>
</ol>
<h3 id="5-五种JSTL常⽤标签"><a href="#5-五种JSTL常⽤标签" class="headerlink" title="5. 五种JSTL常⽤标签"></a>5. 五种JSTL常⽤标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:if&gt;，&lt;c:item&gt;，&lt;c:foreach&gt;，&lt;c:out&gt;，&lt;c:set&gt;</span><br></pre></td></tr></table></figure>



<h3 id="6-JSP是如何被执⾏的？执⾏效率⽐SERVLET低吗？"><a href="#6-JSP是如何被执⾏的？执⾏效率⽐SERVLET低吗？" class="headerlink" title="6. JSP是如何被执⾏的？执⾏效率⽐SERVLET低吗？"></a>6. JSP是如何被执⾏的？执⾏效率⽐SERVLET低吗？</h3><ul>
<li>当客户端向⼀个jsp⻚⾯发送请求时，Web Container将jsp转化成servlet的源代码（只在第⼀次请求时），然后编译转化后的servlet并加载到内存中执⾏，执⾏的结果response到客户端</li>
<li>jsp只在第⼀次执⾏的时候会转化成servlet，以后每次执⾏，web容器都是直接执⾏编译后的servlet，所以<strong>jsp和servlet只是在第⼀次执⾏的时候不⼀样，jsp慢⼀点</strong>，以后的执⾏都是相同的</li>
</ul>
<h3 id="7-说出Servlet和CGI的区别？"><a href="#7-说出Servlet和CGI的区别？" class="headerlink" title="7. 说出Servlet和CGI的区别？"></a>7. 说出Servlet和CGI的区别？</h3><ul>
<li>Servlet处于服务器进程中，只会有⼀个servlet实例，每个请求都会产⽣⼀个新的线程，⽽且servlet实例⼀般不会销毁</li>
<li>CGI：来⼀个请求就创建⼀个进程，⽤完就销毁，效率低于servlet</li>
</ul>
<h3 id="8-避免jsp页面自动生成session"><a href="#8-避免jsp页面自动生成session" class="headerlink" title="8. 避免jsp页面自动生成session"></a>8. 避免jsp页面自动生成session</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page session&#x3D;&quot;false&quot; %&gt;</span><br></pre></td></tr></table></figure>



<h3 id="9-jsp的设计模式"><a href="#9-jsp的设计模式" class="headerlink" title="9. jsp的设计模式"></a>9. jsp的设计模式</h3><p>模式⼀指的就是在开发中将显示层、控制层、数据层的操作统⼀交给JSP或者JavaBean来进⾏处理！</p>
<p>Mode II 中所有的开发都是以Servlet为主体展开的，由Servlet接收所有的客户端请求，然后根据请求调⽤相对应的JavaBean，并所有的显示结果交给JSP完成！，也就是俗称的MVC设计模式！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;&#x3D;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://gitee.com/lwclick/blogImg/raw/master/img/959e5d02246fb23f5d5f613f7767eeac.jpeg"
                alt="xCoding" />
            
              <p class="site-author-name" itemprop="name">xCoding</p>
              <p class="site-description motion-element" itemprop="description">change the world by code</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/LwClick" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:Liu17663883288@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.baidu.com/" title="Baidu" target="_blank">Baidu</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.google.com.hk/" title="Google" target="_blank">Google</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xCoding</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i>
<span id="busuanzi_container_site_uv">
    总访问量：<span id="busuanzi_value_site_uv"></span>
</span>
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("6FvwPSgS2qi2N65NMEAkPoh2-gzGzoHsz", "S8r7yFHoBqgsyT8MP9bTGC1R");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
